-- Mixed test for local directory table
-- setup for temp tablespace
! rm -rf '@testtablespace@/local_directory_table_mixed/';

! mkdir -p '@testtablespace@/local_directory_table_mixed/';

DROP TABLESPACE IF EXISTS directory_tblspc;
DROP
CREATE TABLESPACE directory_tblspc LOCATION '@testtablespace@/local_directory_table_mixed/';
CREATE

CREATE EXTENSION IF NOT EXISTS gp_inject_fault;
CREATE

-- Test create directory table and create directory table
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: CREATE DIRECTORY TABLE dir_table1 TABLESPACE directory_tblspc;
CREATE
2: CREATE DIRECTORY TABLE dir_table2 TABLESPACE directory_tblspc;
CREATE
1: COMMIT;
COMMIT
2: COMMIT;
COMMIT

1: COPY BINARY dir_table1 FROM '@abs_srcdir@/data/nation.csv' 'nation1';
COPY 1
2: COPY BINARY dir_table2 FROM '@abs_srcdir@/data/nation.csv' 'nation2';
COPY 1
3: COPY BINARY dir_table1 FROM '@abs_srcdir@/data/nation.csv' 'nation3';
COPY 1
4: COPY BINARY dir_table2 FROM '@abs_srcdir@/data/nation.csv' 'nation4';
COPY 1

-- Test copy binary from the same directory table in parallel session is allowed
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: COPY BINARY dir_table1 FROM '@abs_srcdir@/data/nation.csv' 'nation5';
COPY 1
2: COPY BINARY dir_table1 FROM '@abs_srcdir@/data/nation.csv' 'nation6';
COPY 1
1: COMMIT;
COMMIT
2: COMMIT;
COMMIT

-- Test copy binary from and select directory table
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: COPY BINARY dir_table2 FROM '@abs_srcdir@/data/nation.csv' 'nation5';
COPY 1
2: SELECT relative_path, size, tag, md5 FROM dir_table2 ORDER BY 1;
 relative_path | size | tag | md5                              
---------------+------+-----+----------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
(2 rows)
1: COMMIT;
COMMIT
2: COMMIT;
COMMIT

1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: COPY BINARY dir_table2 FROM '@abs_srcdir@/data/nation.csv' 'nation6';
COPY 1
2: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table2') ORDER BY 1;
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(3 rows)
1: COMMIT;
COMMIT
2: COMMIT;
COMMIT

-- Test copy binary from and remove_file()
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: COPY BINARY dir_table1 FROM '@abs_srcdir@/data/nation.csv' 'nation7';
COPY 1
2&: SELECT remove_file('dir_table1', 'nation6');  <waiting ...>
1: COMMIT;
COMMIT
2<:  <... completed>
 remove_file 
-------------
 t           
(1 row)
2: COMMIT;
COMMIT

-- Test select and select
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: SELECT relative_path, size, tag, md5 FROM dir_table1 ORDER BY 1;
 relative_path | size | tag | md5                              
---------------+------+-----+----------------------------------
 nation1       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation3       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation7       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
(4 rows)
2: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table2') ORDER BY 1;
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation6       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(4 rows)
1: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table2') ORDER BY 1;
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation6       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(4 rows)
2: SELECT relative_path, size, tag, md5 FROM dir_table1 ORDER BY 1;
 relative_path | size | tag | md5                              
---------------+------+-----+----------------------------------
 nation1       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation3       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation7       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
(4 rows)
2: COMMIT;
COMMIT
1: COMMIT;
COMMIT

-- Test select and remove_file()
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: SELECT gp_inject_fault('directory_table_inject', 'suspend', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1&: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table1') ORDER BY 1;  <waiting ...>
2&: SELECT remove_file('dir_table1', 'nation7');  <waiting ...>
3: SELECT gp_wait_until_triggered_fault('directory_table_inject', 1, dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_wait_until_triggered_fault 
-------------------------------
 Success:                      
 Success:                      
 Success:                      
(3 rows)
3: SELECT gp_inject_fault('directory_table_inject', 'resume', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1<:  <... completed>
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation1       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation3       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation7       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(4 rows)
1: COMMIT;
COMMIT
2<:  <... completed>
 remove_file 
-------------
 t           
(1 row)
2: COMMIT;
COMMIT

1: SELECT gp_inject_fault('directory_table_inject', 'reset', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)

1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: SELECT gp_inject_fault('remove_file_inject', 'suspend', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1&: SELECT remove_file('dir_table1', 'nation5');  <waiting ...>
2&: SELECT relative_path, size, tag, md5 FROM dir_table1 ORDER BY 1;  <waiting ...>
3: SELECT gp_wait_until_triggered_fault('remove_file_inject', 1, dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_wait_until_triggered_fault 
-------------------------------
 Success:                      
 Success:                      
 Success:                      
(3 rows)
3: SELECT gp_inject_fault('remove_file_inject', 'resume', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1<:  <... completed>
 remove_file 
-------------
 t           
(1 row)
1: COMMIT;
COMMIT
2<:  <... completed>
 relative_path | size | tag | md5                              
---------------+------+-----+----------------------------------
 nation1       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
 nation3       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 
(2 rows)
2: COMMIT;
COMMIT

1: SELECT gp_inject_fault('remove_file_inject', 'reset', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)

1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: SELECT gp_inject_fault('remove_file_inject', 'suspend', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1&: SELECT remove_file('dir_table2', 'nation6');  <waiting ...>
2&: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table2') ORDER BY 1;  <waiting ...>
3: SELECT gp_wait_until_triggered_fault('remove_file_inject', 1, dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_wait_until_triggered_fault 
-------------------------------
 Success:                      
 Success:                      
 Success:                      
(3 rows)
3: SELECT gp_inject_fault('remove_file_inject', 'resume', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1<:  <... completed>
 remove_file 
-------------
 t           
(1 row)
1: COMMIT;
COMMIT
2<:  <... completed>
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(3 rows)
2: COMMIT;
COMMIT

1: SELECT gp_inject_fault('remove_file_inject', 'reset', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)

1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: SELECT gp_inject_fault('directory_table_inject', 'suspend', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1&: SELECT relative_path, size, tag, md5, content FROM directory_table('dir_table2') ORDER BY 1;  <waiting ...>
2&: SELECT remove_file('dir_table2', 'nation5');  <waiting ...>
3: SELECT gp_wait_until_triggered_fault('directory_table_inject', 1, dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_wait_until_triggered_fault 
-------------------------------
 Success:                      
 Success:                      
 Success:                      
(3 rows)
3: SELECT gp_inject_fault('directory_table_inject', 'resume', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)
1<:  <... completed>
 relative_path | size | tag | md5                              | content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
---------------+------+-----+----------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 nation2       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation4       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
 nation5       | 2199 |     | 01ab9bc150261c9918ce9636be80ea15 | b'0|ALGERIA|0| haggle. carefully final deposits detect slyly agai\n1|ARGENTINA|1|al foxes promise slyly according to the regular accounts. bold requests alon\n2|BRAZIL|1|y alongside of the pending deposits. carefully special packages are about the ironic forges. slyly special \n3|CANADA|1|eas hang ironic, silent packages. slyly regular packages are furiously over the tithes. fluffily bold\n4|EGYPT|4|y above the carefully unusual theodolites. final dugouts are quickly across the furiously regular d\n5|ETHIOPIA|0|ven packages wake quickly. regu\n6|FRANCE|3|refully final requests. regular, ironi\n7|GERMANY|3|l platelets. regular accounts x-ray: unusual, regular acco\n8|INDIA|2|ss excuses cajole slyly across the packages. deposits print aroun\n9|INDONESIA|2| slyly express asymptotes. regular deposits haggle slyly. carefully ironic hockey players sleep blithely. carefull\n10|IRAN|4|efully alongside of the slyly final dependencies. \n11|IRAQ|4|nic deposits boost atop the quickly final requests? quickly regula\n12|JAPAN|2|ously. final, express gifts cajole a\n13|JORDAN|4|ic deposits are blithely about the carefully regular pa\n14|KENYA|0| pending excuses haggle furiously deposits. pending, express pinto beans wake fluffily past t\n15|MOROCCO|0|rns. blithely bold courts among the closely regular packages use furiously bold platelets?\n16|MOZAMBIQUE|0|s. ironic, unusual asymptotes wake blithely r\n17|PERU|1|platelets. blithely pending dependencies use fluffily across the even pinto beans. carefully silent accoun\n18|CHINA|2|c dependencies. furiously express notornis sleep slyly regular accounts. ideas sleep. depos\n19|ROMANIA|3|ular asymptotes are about the furious multipliers. express dependencies nag above the ironically ironic account\n20|SAUDI ARABIA|4|ts. silent requests haggle. closely express packages sleep across the blithely\n21|VIETNAM|2|hely enticingly express accounts. even, final \n22|RUSSIA|3| requests against the platelets use never according to the quickly regular pint\n23|UNITED KINGDOM|3|eans boost carefully special requests. accounts are. carefull\n24|UNITED STATES|1|y final packages. slow foxes cajole quickly. quickly silent platelets breach ironic accounts. unusual pinto be\n' 
(3 rows)
1: COMMIT;
COMMIT
2<:  <... completed>
 remove_file 
-------------
 t           
(1 row)
2: COMMIT;
COMMIT

1: SELECT gp_inject_fault('directory_table_inject', 'reset', dbid) FROM gp_segment_configuration WHERE role='p' and content >= 0;
 gp_inject_fault 
-----------------
 Success:        
 Success:        
 Success:        
(3 rows)

-- Test create directory table and drop directory table
1: BEGIN;
BEGIN
2: BEGIN;
BEGIN
1: CREATE DIRECTORY TABLE dir_table3 TABLESPACE directory_tblspc;
CREATE
2: DROP DIRECTORY TABLE dir_table2;
DROP
2: CREATE DIRECTORY TABLE dir_table2 TABLESPACE directory_tblspc;
CREATE
1: COMMIT;
COMMIT
2: COMMIT;
COMMIT

DROP TABLESPACE directory_tblspc;
ERROR:  tablespace "directory_tblspc" cannot be dropped because some objects depend on it
DETAIL:  tablespace for directory table dir_table1
tablespace for directory table dir_table3
tablespace for directory table dir_table2
DROP DIRECTORY TABLE dir_table1;
DROP
DROP DIRECTORY TABLE dir_table2;
DROP
DROP DIRECTORY TABLE dir_table3;
DROP
! rm -rf '@testtablespace@/local_directory_table_mixed/';

DROP TABLESPACE directory_tblspc;
DROP
