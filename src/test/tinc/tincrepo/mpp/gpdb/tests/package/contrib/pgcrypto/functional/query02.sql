-- start_ignore
drop table testuserscards;
drop table data;
drop table keys;
-- end_ignore

create table keys (key bytea);
insert into keys values (
dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

lQHhBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcopv4DAwJaXAvDPA1o
s2A0Encf5JVA2jILVqzm41ex3ceYOmf3xQZKkCCclD1dcuhsY7gX/XhOKBZOu5qA
mDHevbQhZ3B0ZXN0ZXIxICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAF
Ak2Q3ccCGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94
QEdKX2Un4m0yZo86xGXer1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2KdAmMETZDd
yhAIANXr5ArAFTm2iR6GWDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT
5xx4/g/bVZRiJX54oq2GeF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqw
mz9yari+14t8wnrbJMMgL92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q
1BY8SmmUtnluDO+crsGXF9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahp
usWFbmRvihYxdgZA4Km9m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/
JIXihwYrc6a0oj6dG72fcTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78
tG9HgWqL59nfYPkKDLQKwsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV
6haK8RwQg+b3RltWa6YR3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jG
vs3fUCtAIKd/8qyQcBLcEQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQ
E0SvQKmkSfl5uLBAR63c8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SB
EWAkdI2HRdN/8weB31d0ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDr+AwMCWlwL
wzwNaLNgWXkD0eFQXi8+67tcAeUhd0eB0BhDFLxLVAOWMqYuWiLh5kcsyr2gNcAc
qAewVfCCdNfXKM5AduTeiND+APSCaZO3iO+UQEIQPYhJBBgRAgAJBQJNkN3KAhsM
AAoJEAHzTYUvFlqd4GwAniL/PoAQ0rJeGM+x100PzEVmOgNSAKCftPbHq5spunYC
M8v8Ms4t5Zd3mQ==
=yhw+
-----END PGP PRIVATE KEY BLOCK-----'
));

create table data (data bytea);
insert into data values ('aadfasdfasdfasdfds');


CREATE TABLE testuserscards(card_id SERIAL PRIMARY KEY, username varchar(100), cc bytea); 

INSERT INTO testuserscards(username, cc)
SELECT robotccs.username, pgp_pub_encrypt(robotccs.cc, keys.pubkey) As cc
FROM (VALUES ('robby', '41111111111111111'),
    ('artoo', '41111111111111112') ) As robotccs(username, cc)
     CROSS JOIN (SELECT dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----') As pubkey) As keys;

SELECT robotccs.username, count(pgp_pub_encrypt(robotccs.cc, keys.pubkey, 'compress-algo=1, cipher-algo=aes256')) As cc
FROM (VALUES ('robby', '41111111111111111'),
    ('artoo', '41111111111111112') ) As robotccs(username, cc)
     CROSS JOIN (SELECT dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----') As pubkey) As keys group by username,cc;

Select count( pgp_pub_encrypt_bytea(dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----'), dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----'), 'compress-algo=1, cipher-algo=aes256'));


Select count(pgp_pub_encrypt_bytea(dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----'), dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----')));


SELECT pgp_key_id(dearmor('-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

mQGiBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcoprQhZ3B0ZXN0ZXIx
ICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAFAk2Q3ccCGwMGCwkIBwMC
BBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94QEdKX2Un4m0yZo86xGXe
r1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2K5Ag0ETZDdyhAIANXr5ArAFTm2iR6G
WDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT5xx4/g/bVZRiJX54oq2G
eF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqwmz9yari+14t8wnrbJMMg
L92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q1BY8SmmUtnluDO+crsGX
F9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahpusWFbmRvihYxdgZA4Km9
m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/JIXihwYrc6a0oj6dG72f
cTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78tG9HgWqL59nfYPkKDLQK
wsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV6haK8RwQg+b3RltWa6YR
3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jGvs3fUCtAIKd/8qyQcBLc
EQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQE0SvQKmkSfl5uLBAR63c
8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SBEWAkdI2HRdN/8weB31d0
ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDqISQQYEQIACQUCTZDdygIbDAAKCRAB
802FLxZaneBsAKCMzxMAkxlKOiKPthzlI+3CmX1WMQCgne2RuHeq9CNkWU9BrXmY
W4ufwqw=
=B1vh
-----END PGP PUBLIC KEY BLOCK-----'));


SELECT username, pgp_key_id(cc) As keyweused
FROM testuserscards;



SELECT username, pgp_pub_decrypt(cc, keys.privkey, 'gptester') As ccdecrypt
FROM testuserscards 
    CROSS JOIN
    (SELECT dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

lQHhBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcopv4DAwJaXAvDPA1o
s2A0Encf5JVA2jILVqzm41ex3ceYOmf3xQZKkCCclD1dcuhsY7gX/XhOKBZOu5qA
mDHevbQhZ3B0ZXN0ZXIxICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAF
Ak2Q3ccCGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94
QEdKX2Un4m0yZo86xGXer1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2KdAmMETZDd
yhAIANXr5ArAFTm2iR6GWDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT
5xx4/g/bVZRiJX54oq2GeF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqw
mz9yari+14t8wnrbJMMgL92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q
1BY8SmmUtnluDO+crsGXF9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahp
usWFbmRvihYxdgZA4Km9m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/
JIXihwYrc6a0oj6dG72fcTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78
tG9HgWqL59nfYPkKDLQKwsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV
6haK8RwQg+b3RltWa6YR3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jG
vs3fUCtAIKd/8qyQcBLcEQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQ
E0SvQKmkSfl5uLBAR63c8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SB
EWAkdI2HRdN/8weB31d0ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDr+AwMCWlwL
wzwNaLNgWXkD0eFQXi8+67tcAeUhd0eB0BhDFLxLVAOWMqYuWiLh5kcsyr2gNcAc
qAewVfCCdNfXKM5AduTeiND+APSCaZO3iO+UQEIQPYhJBBgRAgAJBQJNkN3KAhsM
AAoJEAHzTYUvFlqd4GwAniL/PoAQ0rJeGM+x100PzEVmOgNSAKCftPbHq5spunYC
M8v8Ms4t5Zd3mQ==
=yhw+
-----END PGP PRIVATE KEY BLOCK-----'
) As privkey) As keys;


SELECT username, pgp_pub_decrypt(cc, keys.privkey, 'gptester', 'compress-algo=1, cipher-algo=aes256') As ccdecrypt
FROM testuserscards
    CROSS JOIN
    (SELECT dearmor('-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: GnuPG v1.4.5 (GNU/Linux)

lQHhBE2Q3ccRBAC0qp9RuHm0RPEagSXpT3mIjYaVG3xrprf52wXmI1jDiT3JdAiZ
sGBmvScmPr5xcT71AwhLa6bbw1GTRVU6cO2Fs6BRQI5u4MvDqQjmTRtZ/s551gPN
TLA3YPRPww9ju/PPN5YNYR2wEydfSbRF0/cU04EVUyRPF5Agvk2PN/595wCgrJXQ
toFnCMmmqdL1DqDNWRjTh3ED/ivAmz4vRBKSm+Ql11Qt3RqSffkIHR0+EVGBPB8o
A3brw/cCjhvdg2RlOOlewTEYX8GZbUlrv6NCW16/w+nq5IeqYe9o60ZuRZ//8TfN
pC2uKPJs7zXbQwGKlQIZvsoSfgKtUzCUtolMLtA7N6KGDCwoTa+AEz4IQbcl/9mP
RI8MA/4xIxi10zV/ny+O7Dc6E1bwAtLjvlx5+S5yWOdFTdUnTU+RdDfZYUmuygOH
MCy4QcGtXFXidPUNIcuVhToRRUSd19/gBEBvyPkTtdwLuP3aVqdeXUgjUrLUh+oU
SYCpodCh47gjk7Vy2iFhGyd261/yFlJSFtwKHiMP1mAC8hcopv4DAwJaXAvDPA1o
s2A0Encf5JVA2jILVqzm41ex3ceYOmf3xQZKkCCclD1dcuhsY7gX/XhOKBZOu5qA
mDHevbQhZ3B0ZXN0ZXIxICgxKSA8Z3B0ZXN0ZXIxQGVtYy5jb20+iGAEExECACAF
Ak2Q3ccCGwMGCwkIBwMCBBUCCAMEFgIDAQIeAQIXgAAKCRAB802FLxZanVpXAJ94
QEdKX2Un4m0yZo86xGXer1R75gCdEEFfTwxks19iwIvQ1MYZaF9OQ2KdAmMETZDd
yhAIANXr5ArAFTm2iR6GWDETRMZ9kAGUMEWiVV54z0ZFR4eJHTwO6w8Cm08neOfT
5xx4/g/bVZRiJX54oq2GeF8dW4NseBbEhdawWUdg+7hTqUAhn5l9ljPhE5LDDOqw
mz9yari+14t8wnrbJMMgL92+YJA01ktTaS/iu/E9kW2a8tDvZ/ejTf8HyMLhi10Q
1BY8SmmUtnluDO+crsGXF9TkB6ovFTtnkgBaNp6GA7YRg/cbf34Ya5AL2jWKvahp
usWFbmRvihYxdgZA4Km9m5KhtA3gBq26Pa0QHFxWr68uBZrkIvHd87qlOWTGDnb/
JIXihwYrc6a0oj6dG72fcTkESN8AAwUH/ik4Z4HgFrlR878GSjV8Qg7jk//Dce78
tG9HgWqL59nfYPkKDLQKwsPqdGJh73uXTO3Sih9x3MREyMNOmCJv1wISauDwm/YV
6haK8RwQg+b3RltWa6YR3oZS3k4q82n8Us1YL9RVlIY+m9QNDeC4FVhuXZgqX/jG
vs3fUCtAIKd/8qyQcBLcEQDlWvy2CVpcrirkNpdcRuO1gG/zqpXalP13JU5F6KzQ
E0SvQKmkSfl5uLBAR63c8N8PdOJKNXANRV98JTHqIZARkFBfpIDHM5P60lGA28SB
EWAkdI2HRdN/8weB31d0ujePemMUCG6tHgJQDnkYfv82+eGU5sOTXDr+AwMCWlwL
wzwNaLNgWXkD0eFQXi8+67tcAeUhd0eB0BhDFLxLVAOWMqYuWiLh5kcsyr2gNcAc
qAewVfCCdNfXKM5AduTeiND+APSCaZO3iO+UQEIQPYhJBBgRAgAJBQJNkN3KAhsM
AAoJEAHzTYUvFlqd4GwAniL/PoAQ0rJeGM+x100PzEVmOgNSAKCftPbHq5spunYC
M8v8Ms4t5Zd3mQ==
=yhw+
-----END PGP PRIVATE KEY BLOCK-----'
) As privkey) As keys;


-- encrypt_iv / decrypt_iv
select decrypt_iv( encrypt_iv(data.data, test.key, test.key, 'aes'),test.key, test.key, 'aes') from test, data;

