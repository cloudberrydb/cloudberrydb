-- start_ignore
-- end_ignore
-- @concurrency 10
-- @iterations 5
INSERT INTO TEST_AOCO_LOAD1 SELECT * FROM exttab_conc_1;
psql:/path/sql_file:1: NOTICE:  Found 10 data formatting errors (10 or more input rows). Rejected related input data.
INSERT 0 990
COPY TEST_AOCO_LOAD1 FROM '@data_dir@/data.tbl' WITH DELIMITER '|' SEGMENT REJECT LIMIT 100;
psql:/path/sql_file:1: NOTICE:  Found 10 data formatting errors (10 or more input rows). Rejected related input data.
COPY 990
SELECT duplicate_check_aoseg('pg_aoseg.pg_aocsseg_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_aoseg 
-----------------------
(0 rows)

SELECT duplicate_check_visimap('pg_aoseg.pg_aovisimap_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_visimap 
-------------------------
(0 rows)

COPY TEST_AOCO_LOAD1 FROM STDIN WITH DELIMITER '|';
BEGIN;
BEGIN
INSERT INTO TEST_AOCO_LOAD1 select i, 'test123' from generate_series(1, 10000)i;
INSERT 0 10000
ABORT;
ROLLBACK
INSERT INTO TEST_AOCO_LOAD1 VALUES (1, 'test');
INSERT 0 1
-- start_ignore
COPY TEST_AOCO_LOAD1 TO '@data_dir@/output.tbl' WITH DELIMITER '|';
COPY 70923
UPDATE TEST_AOCO_LOAD1 SET j = i || '_update' WHERE i > 103 and i < 545;
UPDATE 8700
-- end_ignore
SELECT duplicate_check_aoseg('pg_aoseg.pg_aocsseg_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_aoseg 
-----------------------
(0 rows)

SELECT duplicate_check_visimap('pg_aoseg.pg_aovisimap_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_visimap 
-------------------------
(0 rows)

INSERT INTO TEST_AOCO_LOAD1 select i, 'test456' from generate_series(10000, 20000)i;;
INSERT 0 10001
BEGIN;
BEGIN
COPY TEST_AOCO_LOAD1 FROM '@data_dir@/data.tbl' WITH DELIMITER '|' SEGMENT REJECT LIMIT 100;
psql:/path/sql_file:1: NOTICE:  Found 10 data formatting errors (10 or more input rows). Rejected related input data.
COPY 990
ABORT;
ROLLBACK
INSERT INTO TEST_AOCO_LOAD1 select i, 'test789' from generate_series(20000, 30000)i;;
INSERT 0 10001
-- start_ignore
COPY TEST_AOCO_LOAD1 TO '@data_dir@/output.tbl' WITH DELIMITER '|';
COPY 90925
UPDATE TEST_AOCO_LOAD1 SET j = i || '_update' WHERE i > 602 and i < 876;
UPDATE 5691
-- end_ignore
INSERT INTO TEST_AOCO_LOAD1 VALUES (1, 'test');
INSERT 0 1
COPY TEST_AOCO_LOAD1 FROM '@data_dir@/data.tbl' WITH DELIMITER '|' SEGMENT REJECT LIMIT 100;
psql:/path/sql_file:1: NOTICE:  Found 10 data formatting errors (10 or more input rows). Rejected related input data.
COPY 990
SELECT duplicate_check_aoseg('pg_aoseg.pg_aocsseg_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_aoseg 
-----------------------
(0 rows)

SELECT duplicate_check_visimap('pg_aoseg.pg_aovisimap_' || a.relfilenode) FROM 
(SELECT relfilenode FROM pg_class WHERE relname = 'TEST_AO_LOAD1')a;
 duplicate_check_visimap 
-------------------------
(0 rows)

