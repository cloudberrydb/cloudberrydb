\c tpch_heap
drop table if exists olap_customer;
NOTICE:  table "olap_customer" does not exist, skipping
drop table if exists olap_product;
NOTICE:  table "olap_product" does not exist, skipping
drop table if exists olap_vendor;
NOTICE:  table "olap_vendor" does not exist, skipping
drop table if exists olap_util;
NOTICE:  table "olap_util" does not exist, skipping
drop table if exists  olap_sale;
NOTICE:  table "olap_sale" does not exist, skipping
drop table if exists olap_sale_ord;
NOTICE:  table "olap_sale_ord" does not exist, skipping
create table olap_customer 
(
	cn int not null,
	cname text not null,
	cloc text,
	
	primary key (cn)
	
) distributed by (cn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_customer_pkey" for table "olap_customer"
create table olap_vendor 
(
	vn int not null,
	vname text not null,
	vloc text,
	
	primary key (vn)
	
) distributed by (vn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_vendor_pkey" for table "olap_vendor"
create table olap_product 
(
	pn int not null,
	pname text not null,
	pcolor text,
	
	primary key (pn)
	
) distributed by (pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_product_pkey" for table "olap_product"
create table olap_sale
(
	cn int not null,
	vn int not null,
	pn int not null,
	dt date not null,
	qty int not null,
	prc float not null,
	
	primary key (cn, vn, pn)
	
) distributed by (cn,vn,pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_sale_pkey" for table "olap_sale"
create table olap_sale_ord
(
        ord int not null,
	cn int not null,
	vn int not null,
	pn int not null,
	dt date not null,
	qty int not null,
	prc float not null,
	
	primary key (cn, vn, pn)
	
) distributed by (cn,vn,pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_sale_ord_pkey" for table "olap_sale_ord"
create table olap_util
(
	xn int not null,
	
	primary key (xn)
	
) distributed by (xn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "olap_util_pkey" for table "olap_util"
-- Customers
insert into olap_customer values 
  ( 1, 'Macbeth', 'Inverness'),
  ( 2, 'Duncan', 'Forres'),
  ( 3, 'Lady Macbeth', 'Inverness'),
  ( 4, 'Witches, Inc', 'Lonely Heath');
-- Vendors
insert into olap_vendor values 
  ( 10, 'Witches, Inc', 'Lonely Heath'),
  ( 20, 'Lady Macbeth', 'Inverness'),
  ( 30, 'Duncan', 'Forres'),
  ( 40, 'Macbeth', 'Inverness'),
  ( 50, 'Macduff', 'Fife');
-- Products
insert into olap_product values 
  ( 100, 'Sword', 'Black'),
  ( 200, 'Dream', 'Black'),
  ( 300, 'Castle', 'Grey'),
  ( 400, 'Justice', 'Clear'),
  ( 500, 'Donuts', 'Plain'),
  ( 600, 'Donuts', 'Chocolate'),
  ( 700, 'Hamburger', 'Grey'),
  ( 800, 'Fries', 'Grey');
-- Sales (transactions)
insert into olap_sale values 
  ( 2, 40, 100, '1401-1-1', 1100, 2400),
  ( 1, 10, 200, '1401-3-1', 1, 0),
  ( 3, 40, 200, '1401-4-1', 1, 0),
  ( 1, 20, 100, '1401-5-1', 1, 0),
  ( 1, 30, 300, '1401-5-2', 1, 0),
  ( 1, 50, 400, '1401-6-1', 1, 0),
  ( 2, 50, 400, '1401-6-1', 1, 0),
  ( 1, 30, 500, '1401-6-1', 12, 5),
  ( 3, 30, 500, '1401-6-1', 12, 5),
  ( 3, 30, 600, '1401-6-1', 12, 5),
  ( 4, 40, 700, '1401-6-1', 1, 1),
  ( 4, 40, 800, '1401-6-1', 1, 1);
-- Sales (ord transactions)
insert into olap_sale_ord values 
  ( 1,2, 40, 100, '1401-1-1', 1100, 2400),
  ( 2,1, 10, 200, '1401-3-1', 1, 0),
  ( 3,3, 40, 200, '1401-4-1', 1, 0),
  ( 4,1, 20, 100, '1401-5-1', 1, 0),
  ( 5,1, 30, 300, '1401-5-2', 1, 0),
  ( 6,1, 50, 400, '1401-6-1', 1, 0),
  ( 7,2, 50, 400, '1401-6-1', 1, 0),
  ( 8,1, 30, 500, '1401-6-1', 12, 5),
  ( 9,3, 30, 500, '1401-6-1', 12, 5),
  ( 10,3, 30, 600, '1401-6-1', 12, 5),
  ( 11,4, 40, 700, '1401-6-1', 1, 1),
  ( 12,4, 40, 800, '1401-6-1', 1, 1);
-- Util
insert into olap_util values 
  (1),
  (20),
  (300);
set enable_hashagg = off;
set enable_hashjoin = off;
set gp_enable_mk_sort = on;
select
	l_returnflag,
	l_linestatus,
	sum(l_quantity) as sum_qty,
	sum(l_extendedprice) as sum_base_price,
	sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,
	sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,
	avg(l_quantity) as avg_qty,
	avg(l_extendedprice) as avg_price,
	avg(l_discount) as avg_disc,
	count(*) as count_order
from
	lineitem
where
	l_shipdate <= date '1998-12-01' - interval '108 day'
group by
	l_returnflag,
	l_linestatus
order by
	l_returnflag,
	l_linestatus;
 l_returnflag | l_linestatus |  sum_qty  | sum_base_price | sum_disc_price |    sum_charge     |       avg_qty       |     avg_price      |        avg_disc        | count_order 
--------------+--------------+-----------+----------------+----------------+-------------------+---------------------+--------------------+------------------------+-------------
 A            | F            | 380456.00 |   532348211.65 | 505822441.4861 |  526165934.000839 | 25.5751546114546921 | 35785.709306937349 | 0.05008133906964237698 |       14876
 N            | F            |   8971.00 |    12384801.37 |  11798257.2080 |   12282485.056933 | 25.7787356321839080 | 35588.509683908046 | 0.04775862068965517241 |         348
 N            | O            | 733323.00 |  1028186527.78 | 977118238.4241 | 1016280268.835844 | 25.4466999791796794 | 35678.621964744257 | 0.04991255465334166146 |       28818
 R            | F            | 381449.00 |   534594445.35 | 507996454.4067 |  528524219.358903 | 25.5971681653469333 | 35874.006532680177 | 0.04982753992752650651 |       14902
(4 rows)

select
	s_acctbal,
	s_name,
	n_name,
	p_partkey,
	p_mfgr,
	s_address,
	s_phone,
	s_comment
from
	part,
	supplier,
	partsupp,
	nation,
	region
where
	p_partkey = ps_partkey
	and s_suppkey = ps_suppkey
	and p_size = 45
	and p_type like '%NICKEL'
	and s_nationkey = n_nationkey
	and n_regionkey = r_regionkey
	and r_name = 'EUROPE'
	and ps_supplycost = (
		select
			min(ps_supplycost)
		from
			partsupp,
			supplier,
			nation,
			region
		where
			p_partkey = ps_partkey
			and s_suppkey = ps_suppkey
			and s_nationkey = n_nationkey
			and n_regionkey = r_regionkey
			and r_name = 'EUROPE'
	)
order by
	s_acctbal desc,
	n_name,
	s_name,
	p_partkey;
 s_acctbal |          s_name           |          n_name           | p_partkey |          p_mfgr           |                s_address                 |     s_phone     |                             s_comment                             
-----------+---------------------------+---------------------------+-----------+---------------------------+------------------------------------------+-----------------+-------------------------------------------------------------------
   8564.12 | Supplier#000000033        | GERMANY                   |       532 | Manufacturer#1            | gfeKpYw3400L0SDywXA6Ya1Qmq1w6YB9f3R      | 17-138-897-9374 | n sauternes along the regular asymptotes are regularly along the 
   4186.95 | Supplier#000000077        | GERMANY                   |       645 | Manufacturer#4            | wVtcr0uH3CyrSiWMLsqnB09Syo,UuZxPMeBghlY  | 17-281-345-4863 | the slyly final asymptotes. blithely pending theodoli
   2455.98 | Supplier#000000066        | UNITED KINGDOM            |      1193 | Manufacturer#1            | qYdruFJQJYYiKvnNVmYfCVydVB8bcW,AW,U6SOV3 | 33-300-836-9529 | ar requests. express orbits de
(3 rows)

select 
	s.s_acctbal,
	s.s_name,
	n.n_name,
	p.p_partkey,
	p.p_mfgr,
	s.s_address,
	s.s_phone,
	s.s_comment 
from 
	supplier s, 
	partsupp ps, 
	nation n, 
	region r, 
	part p, 
	(select p_partkey, min(ps_supplycost) as min_ps_cost 
		from 
			part, 
			partsupp , 	
			supplier,
			nation, 
			region 
		where 
			p_partkey=ps_partkey 
			and s_suppkey = ps_suppkey 
			and s_nationkey = n_nationkey 
			and n_regionkey = r_regionkey 
			and r_name = 'EUROPE' 
		group by p_partkey ) g 
where 
	p.p_partkey = ps.ps_partkey 
	and g.p_partkey = p.p_partkey 
	and g. min_ps_cost = ps.ps_supplycost 
	and s.s_suppkey = ps.ps_suppkey 
	and p.p_size = 45 
	and p.p_type like '%NICKEL' 
	and s.s_nationkey = n.n_nationkey 
	and n.n_regionkey = r.r_regionkey 
	and r.r_name = 'EUROPE' 
order by 
	s.s_acctbal desc,
	n.n_name,
	s.s_name,
	p.p_partkey
LIMIT 100;
 s_acctbal |          s_name           |          n_name           | p_partkey |          p_mfgr           |                s_address                 |     s_phone     |                             s_comment                             
-----------+---------------------------+---------------------------+-----------+---------------------------+------------------------------------------+-----------------+-------------------------------------------------------------------
   8564.12 | Supplier#000000033        | GERMANY                   |       532 | Manufacturer#1            | gfeKpYw3400L0SDywXA6Ya1Qmq1w6YB9f3R      | 17-138-897-9374 | n sauternes along the regular asymptotes are regularly along the 
   4186.95 | Supplier#000000077        | GERMANY                   |       645 | Manufacturer#4            | wVtcr0uH3CyrSiWMLsqnB09Syo,UuZxPMeBghlY  | 17-281-345-4863 | the slyly final asymptotes. blithely pending theodoli
   2455.98 | Supplier#000000066        | UNITED KINGDOM            |      1193 | Manufacturer#1            | qYdruFJQJYYiKvnNVmYfCVydVB8bcW,AW,U6SOV3 | 33-300-836-9529 | ar requests. express orbits de
(3 rows)

select
	l_orderkey,
	sum(l_extendedprice * (1 - l_discount)) as revenue,
	o_orderdate,
	o_shippriority
from
	customer,
	orders,
	lineitem
where
	c_mktsegment = 'MACHINERY'
	and c_custkey = o_custkey
	and l_orderkey = o_orderkey
	and o_orderdate < date '1995-03-15'
	and l_shipdate > date '1995-03-15'
group by
	l_orderkey,
	o_orderdate,
	o_shippriority
order by
	revenue desc,
	o_orderdate
LIMIT 10;
 l_orderkey |   revenue   | o_orderdate | o_shippriority 
------------+-------------+-------------+----------------
      12641 | 222127.6271 | 02-23-1995  |              0
      39878 | 219714.3069 | 03-06-1995  |              0
      34243 | 214308.7196 | 02-12-1995  |              0
       7171 | 202398.1900 | 02-14-1995  |              0
      55271 | 195237.8000 | 03-12-1995  |              0
      50145 | 189500.1602 | 02-27-1995  |              0
      12867 | 185769.1004 | 03-12-1995  |              0
      12066 | 180776.3231 | 02-07-1995  |              0
      41926 | 180459.9518 | 02-06-1995  |              0
      46307 | 180383.2464 | 02-07-1995  |              0
(10 rows)

select
        o_orderpriority,
        count(*) as order_count
from
        orders
where
        o_orderdate >= date '1994-05-01'
        and o_orderdate < date '1994-05-01' + interval '3 month'
        and exists (
                select
                        *
                from
                        lineitem
                where
                        l_orderkey = o_orderkey
                        and l_commitdate < l_receiptdate
        )
group by
        o_orderpriority
order by
        o_orderpriority;
 o_orderpriority | order_count 
-----------------+-------------
 1-URGENT        |         108
 2-HIGH          |         117
 3-MEDIUM        |          95
 4-NOT SPECIFIED |         111
 5-LOW           |         116
(5 rows)

select
	sum(l_extendedprice * l_discount) as revenue
from
	lineitem
where
	l_shipdate >= date '1996-01-01'
	and l_shipdate < date '1996-01-01' + interval '1 year'
	and l_discount between 0.04 - 0.01 and 0.04 + 0.01
	and l_quantity < 24;
   revenue   
-------------
 740117.7050
(1 row)

select
	supp_nation,
	cust_nation,
	l_year,
	sum(volume) as revenue
from
	(
		select
			n1.n_name as supp_nation,
			n2.n_name as cust_nation,
			extract(year from l_shipdate) as l_year,
			l_extendedprice * (1 - l_discount) as volume
		from
			supplier,
			lineitem,
			orders,
			customer,
			nation n1,
			nation n2
		where
			s_suppkey = l_suppkey
			and o_orderkey = l_orderkey
			and c_custkey = o_custkey
			and s_nationkey = n1.n_nationkey
			and c_nationkey = n2.n_nationkey
			and (
				(n1.n_name = 'MOZAMBIQUE' and n2.n_name = 'GERMANY')
				or (n1.n_name = 'GERMANY' and n2.n_name = 'MOZAMBIQUE')
			)
			and l_shipdate between date '1995-01-01' and date '1996-12-31'
	) as shipping
group by
	cust_nation,
	l_year
order by
	supp_nation,
	cust_nation,
	l_year;
ERROR:  column "shipping.supp_nation" must appear in the GROUP BY clause or be used in an aggregate function
select
	o_year,
	sum(case
		when nation = 'PERU' then volume
		else 0
	end) / sum(volume) as mkt_share
from
	(
		select
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) as volume,
			n2.n_name as nation
		from
			part,
			supplier,
			lineitem,
			orders,
			customer,
			nation n1,
			nation n2,
			region
		where
			p_partkey = l_partkey
			and s_suppkey = l_suppkey
			and l_orderkey = o_orderkey
			and o_custkey = c_custkey
			and c_nationkey = n1.n_nationkey
			and n1.n_regionkey = r_regionkey
			and r_name = 'AMERICA'
			and s_nationkey = n2.n_nationkey
			and o_orderdate between date '1995-01-01' and date '1996-12-31'
			and p_type = 'MEDIUM POLISHED TIN'
	) as all_nations
group by
	o_year
order by
	o_year;
 o_year |         mkt_share          
--------+----------------------------
   1995 | 0.000000000000000000000000
   1996 |     0.17380660267693394854
(2 rows)

select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%tan%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year | sum_profit  
---------------------------+--------+-------------
 ALGERIA                   |   1998 | 203717.6183
 ALGERIA                   |   1997 | 277895.7940
 ALGERIA                   |   1996 | 285313.9627
 ALGERIA                   |   1995 | 309375.7934
 ALGERIA                   |   1994 | 288152.6449
 ALGERIA                   |   1993 | 321222.9401
 ALGERIA                   |   1992 | 436020.6807
 ARGENTINA                 |   1998 | 217919.0097
 ARGENTINA                 |   1997 |  47720.1989
 ARGENTINA                 |   1996 | 373086.6814
 ARGENTINA                 |   1995 | 256403.9057
 ARGENTINA                 |   1994 | 172411.8182
 ARGENTINA                 |   1993 | 414051.7103
 ARGENTINA                 |   1992 | 497745.7196
 BRAZIL                    |   1998 |   9402.1360
 BRAZIL                    |   1996 | 130680.4872
 BRAZIL                    |   1995 |  47629.8480
 BRAZIL                    |   1994 |  22440.1440
 BRAZIL                    |   1993 | 106237.4759
 BRAZIL                    |   1992 | 116994.4770
 CANADA                    |   1998 |  67660.5389
 CANADA                    |   1997 | 167179.5520
 CANADA                    |   1996 | 147802.3006
 CANADA                    |   1995 |  84817.9292
 CANADA                    |   1994 |  49027.1082
 CANADA                    |   1993 | 157886.0056
 CANADA                    |   1992 | 191231.3590
 CHINA                     |   1998 | 382876.9927
 CHINA                     |   1997 | 787527.2369
 CHINA                     |   1996 | 605901.5293
 CHINA                     |   1995 | 587705.6412
 CHINA                     |   1994 | 917527.5948
 CHINA                     |   1993 | 839365.4133
 CHINA                     |   1992 | 748324.7469
 EGYPT                     |   1998 | 220523.2078
 EGYPT                     |   1997 | 554962.2792
 EGYPT                     |   1996 | 526118.5876
 EGYPT                     |   1995 | 406448.9115
 EGYPT                     |   1994 | 404925.7193
 EGYPT                     |   1993 | 296691.1725
 EGYPT                     |   1992 | 449161.6055
 ETHIOPIA                  |   1998 | 178828.6942
 ETHIOPIA                  |   1997 | 322949.1543
 ETHIOPIA                  |   1996 | 179589.0062
 ETHIOPIA                  |   1995 | 215017.5362
 ETHIOPIA                  |   1994 | 509710.4645
 ETHIOPIA                  |   1993 | 251330.1758
 ETHIOPIA                  |   1992 | 225397.2384
 FRANCE                    |   1998 | 210901.9632
 FRANCE                    |   1997 | 234428.9324
 FRANCE                    |   1996 | 283026.6644
 FRANCE                    |   1995 | 428615.5897
 FRANCE                    |   1994 | 233410.4344
 FRANCE                    |   1993 | 420330.4447
 FRANCE                    |   1992 | 359496.0042
 GERMANY                   |   1998 | 229863.3768
 GERMANY                   |   1997 | 519160.2856
 GERMANY                   |   1996 | 533764.1221
 GERMANY                   |   1995 | 621744.7373
 GERMANY                   |   1994 | 340785.3795
 GERMANY                   |   1993 | 673651.1393
 GERMANY                   |   1992 | 524002.5977
 INDIA                     |   1998 | 334403.8655
 INDIA                     |   1997 | 156434.8865
 INDIA                     |   1996 | 265093.2063
 INDIA                     |   1995 | 137842.0462
 INDIA                     |   1994 | 262710.5074
 INDIA                     |   1993 | 328441.1285
 INDIA                     |   1992 | 199589.6727
 INDONESIA                 |   1998 | 155973.1013
 INDONESIA                 |   1997 | 316792.0784
 INDONESIA                 |   1996 | 422245.5263
 INDONESIA                 |   1995 | 235242.8814
 INDONESIA                 |   1994 | 326775.3396
 INDONESIA                 |   1993 | 327711.7699
 INDONESIA                 |   1992 | 243688.5923
 IRAN                      |   1998 |  27198.8568
 IRAN                      |   1997 | 174737.8001
 IRAN                      |   1996 |  50121.8822
 IRAN                      |   1995 |  70977.8022
 IRAN                      |   1994 | 104593.0442
 IRAN                      |   1993 |  25867.0544
 IRAN                      |   1992 |  82988.9337
 IRAQ                      |   1998 | 157348.1240
 IRAQ                      |   1997 | 227619.0410
 IRAQ                      |   1996 | 114431.2136
 IRAQ                      |   1995 |  83702.7028
 IRAQ                      |   1994 | 189246.3076
 IRAQ                      |   1993 | 172977.0040
 IRAQ                      |   1992 | 165679.6544
 JAPAN                     |   1998 | 301448.7416
 JAPAN                     |   1997 | 274224.7673
 JAPAN                     |   1996 | 365055.9942
 JAPAN                     |   1995 | 273486.9553
 JAPAN                     |   1994 | 306480.9939
 JAPAN                     |   1993 | 309841.9310
 JAPAN                     |   1992 | 257133.6723
 JORDAN                    |   1998 |  51101.6440
 JORDAN                    |   1996 |   6016.6285
 JORDAN                    |   1995 |  58278.1892
 JORDAN                    |   1994 |  59604.3204
 JORDAN                    |   1993 | 110544.8190
 KENYA                     |   1998 | 239097.5320
 KENYA                     |   1997 | 177292.9690
 KENYA                     |   1996 | 597636.7126
 KENYA                     |   1995 | 434837.8428
 KENYA                     |   1994 | 511118.7047
 KENYA                     |   1993 | 181482.4886
 KENYA                     |   1992 | 442814.6201
 MOROCCO                   |   1998 |  94153.7562
 MOROCCO                   |   1997 |   1952.7200
 MOROCCO                   |   1996 | 184609.4769
 MOROCCO                   |   1995 | 138773.7720
 MOROCCO                   |   1994 | 141735.9952
 MOROCCO                   |   1993 | 240971.4009
 MOROCCO                   |   1992 |  76485.6974
 MOZAMBIQUE                |   1998 | 315271.5330
 MOZAMBIQUE                |   1997 | 593511.8009
 MOZAMBIQUE                |   1996 | 463830.0035
 MOZAMBIQUE                |   1995 | 463982.1278
 MOZAMBIQUE                |   1994 | 402790.4493
 MOZAMBIQUE                |   1993 | 765203.5080
 MOZAMBIQUE                |   1992 | 552780.7126
 PERU                      |   1998 | 291043.9094
 PERU                      |   1997 | 332386.6526
 PERU                      |   1996 | 271308.8627
 PERU                      |   1995 | 136468.6570
 PERU                      |   1994 | 231696.8464
 PERU                      |   1993 | 319175.9000
 PERU                      |   1992 | 296178.1348
 ROMANIA                   |   1998 | 366693.1531
 ROMANIA                   |   1997 | 313915.6675
 ROMANIA                   |   1996 | 257449.7931
 ROMANIA                   |   1995 | 613689.1994
 ROMANIA                   |   1994 | 514683.8323
 ROMANIA                   |   1993 | 301818.9752
 ROMANIA                   |   1992 | 445559.9618
 RUSSIA                    |   1998 | 215635.7552
 RUSSIA                    |   1997 | 263377.9773
 RUSSIA                    |   1996 | 292798.2473
 RUSSIA                    |   1995 | 202559.9044
 RUSSIA                    |   1994 | 287175.8782
 RUSSIA                    |   1993 | 163995.8157
 RUSSIA                    |   1992 | 356477.2999
 SAUDI ARABIA              |   1998 |  22338.7375
 SAUDI ARABIA              |   1997 |  89352.2847
 SAUDI ARABIA              |   1996 | 172227.1252
 SAUDI ARABIA              |   1995 | 104670.1059
 SAUDI ARABIA              |   1994 |  39327.6690
 SAUDI ARABIA              |   1993 |  76176.8010
 SAUDI ARABIA              |   1992 |  71000.2760
 UNITED KINGDOM            |   1998 |  57011.9084
 UNITED KINGDOM            |   1997 |  86313.0141
 UNITED KINGDOM            |   1996 |  93430.0955
 UNITED KINGDOM            |   1995 | 105005.8744
 UNITED KINGDOM            |   1994 | 111953.2358
 UNITED KINGDOM            |   1993 | 161721.5622
 UNITED KINGDOM            |   1992 | 173519.0108
 UNITED STATES             |   1998 | 382856.8948
 UNITED STATES             |   1997 | 494438.3396
 UNITED STATES             |   1996 | 548337.7007
 UNITED STATES             |   1995 | 720764.4099
 UNITED STATES             |   1994 | 695834.7785
 UNITED STATES             |   1993 | 593012.3919
 UNITED STATES             |   1992 | 801814.0301
 VIETNAM                   |   1998 | 253199.9819
 VIETNAM                   |   1997 | 551578.3779
 VIETNAM                   |   1996 | 309940.0530
 VIETNAM                   |   1995 | 491467.2046
 VIETNAM                   |   1994 | 510626.2215
 VIETNAM                   |   1993 | 786734.2542
 VIETNAM                   |   1992 | 511062.6378
(172 rows)

select
	c_count,
	count(*) as custdist
from
	(
		select
			c_custkey,
			count(o_orderkey)
		from
			customer left outer join orders on
				c_custkey = o_custkey
				and o_comment not like '%express%deposits%'
		group by
			c_custkey
	) as c_orders (c_custkey, c_count)
group by
	c_count
order by
	custdist desc,
	c_count desc;
 c_count | custdist 
---------+----------
       0 |      500
      11 |       66
      10 |       64
       8 |       63
      12 |       61
       9 |       60
      20 |       58
      13 |       58
      14 |       53
      15 |       48
       7 |       47
      18 |       43
      17 |       40
      21 |       38
      16 |       38
      19 |       36
       6 |       35
      22 |       34
      24 |       32
      23 |       30
      25 |       22
      26 |       19
       5 |       13
      27 |       10
      28 |        9
       4 |        7
      32 |        4
      30 |        4
      29 |        3
       3 |        2
       2 |        2
      31 |        1
(32 rows)

create view revenue0 (supplier_no, total_revenue) as
	select
		l_suppkey,
		sum(l_extendedprice * (1 - l_discount))
	from
		lineitem
	where
		l_shipdate >= date '1993-01-01'
		and l_shipdate < date '1993-01-01' + interval '3 month'
	group by
		l_suppkey;
select
	s_suppkey,
	s_name,
	s_address,
	s_phone,
	total_revenue
from
	supplier,
	revenue0
where
	s_suppkey = supplier_no
	and total_revenue = (
		select
			max(total_revenue)
		from
			revenue0
	)
order by
	s_suppkey;
 s_suppkey |          s_name           |          s_address          |     s_phone     | total_revenue 
-----------+---------------------------+-----------------------------+-----------------+---------------
        84 | Supplier#000000084        | DcYjWMiZGQqEKOJi4wAmIV08ikx | 34-869-118-7803 |  1134618.0543
(1 row)

drop view revenue0;
select
	sum(l_extendedprice) / 7.0 as avg_yearly
from
	lineitem,
	part
where
	p_partkey = l_partkey
	and p_brand = 'Brand#32'
	and p_container = 'JUMBO PKG'
	and l_quantity < (
		select
			0.2 * avg(l_quantity)
		from
			lineitem
		where
			l_partkey = p_partkey
	);
 avg_yearly 
------------
           
(1 row)

select
      sum(l_extendedprice) / 7.0 as avg_yearly
from
      lineitem,
      (
          select
              p_partkey as x_partkey,
              0.2 * avg(l_quantity) as x_avg_20
          from
              part,
              lineitem
          where
              p_partkey = l_partkey
              and p_brand = 'Brand#32'
              and p_container = 'JUMBO PKG'
          group by
              p_partkey
      ) x
where
      x_partkey = l_partkey
and l_quantity < x_avg_20;
 avg_yearly 
------------
           
(1 row)

select
	sum(l_extendedprice* (1 - l_discount)) as revenue
from
	lineitem,
	part
where
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#23'
		and p_container in ('SM CASE', 'SM BOX', 'SM PACK', 'SM PKG')
		and l_quantity >= 3 and l_quantity <= 3 + 10
		and p_size between 1 and 5
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	)
	or
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#53'
		and p_container in ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK')
		and l_quantity >= 11 and l_quantity <= 11 + 10
		and p_size between 1 and 10
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	)
	or
	(
		p_partkey = l_partkey
		and p_brand = 'Brand#21'
		and p_container in ('LG CASE', 'LG BOX', 'LG PACK', 'LG PKG')
		and l_quantity >= 29 and l_quantity <= 29 + 10
		and p_size between 1 and 15
		and l_shipmode in ('AIR', 'AIR REG')
		and l_shipinstruct = 'DELIVER IN PERSON'
	);
 revenue 
---------
        
(1 row)

select
	cntrycode,
	count(*) as numcust,
	sum(c_acctbal) as totacctbal
from
	(
		select
			substring(c_phone from 1 for 2) as cntrycode,
			c_acctbal
		from
			customer
		where
			substring(c_phone from 1 for 2) in
				('11', '28', '21', '26', '19', '13', '22')
			and c_acctbal > (
				select
					avg(c_acctbal)
				from
					customer
				where
					c_acctbal > 0.00
					and substring(c_phone from 1 for 2) in
						('11', '28', '21', '26', '19', '13', '22')
			)
			and not exists (
				select
					*
				from
					orders
				where
					o_custkey = c_custkey
			)
	) as custsale
group by
	cntrycode
order by
	cntrycode
LIMIT -1;
 cntrycode | numcust | totacctbal 
-----------+---------+------------
(0 rows)

select 
	cntrycode, 
	count(*) as numcust, 
	sum(c_acctbal) as totacctbal 
from 
	( 
		select 
			substring(c_phone from 1 for 2) as cntrycode, 
			c_acctbal 
		from 
			customer left join orders 
				on c_custkey = o_custkey 
		where 
			substring(c_phone from 1 for 2) in 
				('11', '28', '21', '26', '19', '13', '22') 
			and c_acctbal > ( 
				select 
					avg(c_acctbal) 
				from 
					customer 
				where 
					c_acctbal > 0.00 
					and substring(c_phone from 1 for 2) in 
						('11', '28', '21', '26', '19', '13', '22') 
			) 
			and o_custkey is null 
	) as custsale 
group by 
	cntrycode 
order by 
	cntrycode;
 cntrycode | numcust | totacctbal 
-----------+---------+------------
 11        |      11 |   82845.34
 13        |      10 |   75359.29
 19        |      17 |  132118.07
 21        |       9 |   73087.05
 22        |       9 |   65544.55
 26        |       6 |   47747.11
 28        |      10 |   79310.33
(7 rows)

select count (*) from (select l_orderkey, l_partkey, l_comment,
count(l_tax) from lineitem group by 1, 2, 3) tmpt;
 count 
-------
 60175
(1 row)

create table gpsort_alltypes(col1 bigint, col2 bigserial, col3 bit, col4 bit varying(10), col5 bool, col6 char, col7 varchar(10), col8 cidr, col9 circle, col10 date, col11 numeric(5,2), col12 float8, col13 inet, col14 int4, col15 interval, col16 lseg, col17 macaddr, col18 money, col19 path, col20 point, col21 polygon, col22 float4, col23 serial4, col24 smallint, col25 text, col26 time, col27 timetz, col28 timestamp, col29 timestamptz) with oids;
NOTICE:  CREATE TABLE will create implicit sequence "gpsort_alltypes_col2_seq" for serial column "gpsort_alltypes.col2"
NOTICE:  CREATE TABLE will create implicit sequence "gpsort_alltypes_col23_seq" for serial column "gpsort_alltypes.col23"
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'col1' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
NOTICE:  OIDS=TRUE is not recommended for user-created tables. Use OIDS=FALSE to prevent wrap-around of the OID counter
insert into gpsort_alltypes values(1234567891011,13942492347494,'1','0001','yes', 'a', 'abcdefgh', '192.168.100.1', circle '((0,0),1)', '2007-01-01', 123.45, 12323423424.324, inet '192.168.1.1', 123123, interval '24 hours',lseg '((0,0),(1,1))', macaddr '12:34:56:78:90:ab', '$1000.00',  path '((0,0),(1,1),(2,2))', point '(0,0)',polygon '((0,0),(1,1))',213234.23,1,7123,'abcdsafasfasfasfasfdasfasfdasf2asdfhsadfsfs','04:00:00','04:00:00 EST','2007-01-01 04:00:00','2007-01-01 04:00:00 EST');
insert into gpsort_alltypes values(10987654321,212394723492342,'0','0010','y', 'b', 'xyz', '192.168.100.2', circle '((0,0),2)', '2007-02-01', 23.45, 1232324.324, inet '192.168.1.2', 123124, interval '12 hours',lseg '((0,0),(1,2))', macaddr '12:34:56:78:90:00', '$5000.00',  path '((0,0),(4,4),(3,3))', point '(0,1)',polygon '((-1,-2),(1,1))',213.23234,2,2343,'2342abcddfasfasf234234234','04:30:00','04:30:00 EST','2007-02-01 04:30:00','2007-02-01 04:30:00 EST');
insert into gpsort_alltypes values(99999999999999999,312394234,'1','0000','false', 'c', 'cde', '192.168.100.3', circle '((1,1),2)', '2007-02-02', 34.45, 122324.324, inet '192.168.1.5', 13124, interval '30 mins',lseg '((0,0),(5,6))', macaddr '12:34:56:78:90:cd', '$4321.00',  path '((0,0),(4,4),(3,3))', point '(1,1)',polygon '((1,0),(2,3))',2133459.23123,3,1323,'234234abcddasdflasjflasfjalf','14:30:00','14:30:00 PST','2007-02-01 14:30:00','2007-02-01 14:30:00 PST');
insert into gpsort_alltypes values(122223333333366,423402340240234,'1','0100','f', 'd', '1xyz', '192.168.100.10', circle '((2,1),2)', '2001-03-02', 34.45, 312324.324, inet '192.168.2.5', 1324, interval '10 secs',lseg '((1,1),(6,6))', macaddr '12:34:56:78:89:cd', '$1.50',  path '((0,0),(4,4),(3,3),(5,5))', point '(2,1)',polygon '((2,0),(2,1))',21312121.23,4,123,'abcd23423afasflasfasf','16:30:00','16:30:00 PST','2006-02-01 16:30:00','2006-02-01 16:30:00 PST');
insert gpsort_alltypes values(4666,434234242,'1','1001','f', 'e', 'xyz', '127.0.0.1', circle '((2,1),2)', '2008-03-02', 34.45, 12324.324, inet '127.0.0.1', 1344, interval '40 secs',lseg '((1,1),(6,6))', macaddr '12:34:56:78:89:cd', '$1.00',  path '((0,0),(4,4),(3,3),(5,5))', point '(3,3)',polygon '((2,-1),(2,1))',213123.23,4,12334,'abcd','23:30:00','16:30:00 EST','2006-02-01 16:30:00','2006-02-01 16:30:00 PST');
ERROR:  syntax error at or near "gpsort_alltypes"
LINE 1: insert gpsort_alltypes values(4666,434234242,'1','1001','f',...
               ^
select col1 from gpsort_alltypes order by col1 asc;
       col1        
-------------------
       10987654321
     1234567891011
   122223333333366
 99999999999999999
(4 rows)

select col1 from gpsort_alltypes order by col1 desc;
       col1        
-------------------
 99999999999999999
   122223333333366
     1234567891011
       10987654321
(4 rows)

select col2 from gpsort_alltypes order by col2 asc;
      col2       
-----------------
       312394234
  13942492347494
 212394723492342
 423402340240234
(4 rows)

select col2 from gpsort_alltypes order by col2 desc;
      col2       
-----------------
 423402340240234
 212394723492342
  13942492347494
       312394234
(4 rows)

select col3 from gpsort_alltypes order by col3 asc;
 col3 
------
 0
 1
 1
 1
(4 rows)

select col3 from gpsort_alltypes order by col3 desc;
 col3 
------
 1
 1
 1
 0
(4 rows)

select col4 from gpsort_alltypes order by col4 asc;
 col4 
------
 0000
 0001
 0010
 0100
(4 rows)

select col4 from gpsort_alltypes order by col4 desc;
 col4 
------
 0100
 0010
 0001
 0000
(4 rows)

select col5 from gpsort_alltypes order by col5 asc;
 col5 
------
 f
 f
 t
 t
(4 rows)

select col5 from gpsort_alltypes order by col5 desc;
 col5 
------
 t
 t
 f
 f
(4 rows)

select col6 from gpsort_alltypes order by col6 asc;
 col6 
------
 a
 b
 c
 d
(4 rows)

select col6 from gpsort_alltypes order by col6 desc;
 col6 
------
 d
 c
 b
 a
(4 rows)

select col7 from gpsort_alltypes order by col7 asc;
   col7   
----------
 1xyz
 abcdefgh
 cde
 xyz
(4 rows)

select col7 from gpsort_alltypes order by col7 desc;
   col7   
----------
 xyz
 cde
 abcdefgh
 1xyz
(4 rows)

select col8 from gpsort_alltypes order by col8 asc;
       col8        
-------------------
 192.168.100.1/32
 192.168.100.2/32
 192.168.100.3/32
 192.168.100.10/32
(4 rows)

select col8 from gpsort_alltypes order by col8 desc;
       col8        
-------------------
 192.168.100.10/32
 192.168.100.3/32
 192.168.100.2/32
 192.168.100.1/32
(4 rows)

select col9 from gpsort_alltypes order by col9 asc;
ERROR:  could not identify an ordering operator for type circle
LINE 1: select col9 from gpsort_alltypes order by col9 asc;
                                                  ^
HINT:  Use an explicit ordering operator or modify the query.
select col9 from gpsort_alltypes order by col9 desc;
ERROR:  could not identify an ordering operator for type circle
LINE 1: select col9 from gpsort_alltypes order by col9 desc;
                                                  ^
HINT:  Use an explicit ordering operator or modify the query.
select col10 from gpsort_alltypes order by col10 asc;
   col10    
------------
 03-02-2001
 01-01-2007
 02-01-2007
 02-02-2007
(4 rows)

select col10 from gpsort_alltypes order by col10 desc;
   col10    
------------
 02-02-2007
 02-01-2007
 01-01-2007
 03-02-2001
(4 rows)

select col11 from gpsort_alltypes order by col11 asc;
 col11  
--------
  23.45
  34.45
  34.45
 123.45
(4 rows)

select col11 from gpsort_alltypes order by col11 desc;
 col11  
--------
 123.45
  34.45
  34.45
  23.45
(4 rows)

select col12 from gpsort_alltypes order by col12 asc;
      col12      
-----------------
      122324.324
      312324.324
     1232324.324
 12323423424.324
(4 rows)

select col12 from gpsort_alltypes order by col12 desc;
      col12      
-----------------
 12323423424.324
     1232324.324
      312324.324
      122324.324
(4 rows)

select col13 from gpsort_alltypes order by col13 asc;
    col13    
-------------
 192.168.1.1
 192.168.1.2
 192.168.1.5
 192.168.2.5
(4 rows)

select col13 from gpsort_alltypes order by col13 desc;
    col13    
-------------
 192.168.2.5
 192.168.1.5
 192.168.1.2
 192.168.1.1
(4 rows)

select col14 from gpsort_alltypes order by col14 asc;
 col14  
--------
   1324
  13124
 123123
 123124
(4 rows)

select col14 from gpsort_alltypes order by col14 desc;
 col14  
--------
 123124
 123123
  13124
   1324
(4 rows)

select col15 from gpsort_alltypes order by col15 asc;
   col15    
------------
 @ 10 secs
 @ 30 mins
 @ 12 hours
 @ 24 hours
(4 rows)

select col15 from gpsort_alltypes order by col15 desc;
   col15    
------------
 @ 24 hours
 @ 12 hours
 @ 30 mins
 @ 10 secs
(4 rows)

select col16 from gpsort_alltypes order by col16 asc;
ERROR:  could not identify an ordering operator for type lseg
LINE 1: select col16 from gpsort_alltypes order by col16 asc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col16 from gpsort_alltypes order by col16 desc;
ERROR:  could not identify an ordering operator for type lseg
LINE 1: select col16 from gpsort_alltypes order by col16 desc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col17 from gpsort_alltypes order by col17 asc;
       col17       
-------------------
 12:34:56:78:89:cd
 12:34:56:78:90:00
 12:34:56:78:90:ab
 12:34:56:78:90:cd
(4 rows)

select col17 from gpsort_alltypes order by col17 desc;
       col17       
-------------------
 12:34:56:78:90:cd
 12:34:56:78:90:ab
 12:34:56:78:90:00
 12:34:56:78:89:cd
(4 rows)

select col18 from gpsort_alltypes order by col18 asc;
   col18   
-----------
     $1.50
 $1,000.00
 $4,321.00
 $5,000.00
(4 rows)

select col18 from gpsort_alltypes order by col18 desc;
   col18   
-----------
 $5,000.00
 $4,321.00
 $1,000.00
     $1.50
(4 rows)

select col19 from gpsort_alltypes order by col19 asc;
ERROR:  could not identify an ordering operator for type path
LINE 1: select col19 from gpsort_alltypes order by col19 asc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col19 from gpsort_alltypes order by col19 desc;
ERROR:  could not identify an ordering operator for type path
LINE 1: select col19 from gpsort_alltypes order by col19 desc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col20 from gpsort_alltypes order by col20 asc;
ERROR:  could not identify an ordering operator for type point
LINE 1: select col20 from gpsort_alltypes order by col20 asc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col20 from gpsort_alltypes order by col20 desc;
ERROR:  could not identify an ordering operator for type point
LINE 1: select col20 from gpsort_alltypes order by col20 desc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col21 from gpsort_alltypes order by col21 asc;
ERROR:  could not identify an ordering operator for type polygon
LINE 1: select col21 from gpsort_alltypes order by col21 asc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col21 from gpsort_alltypes order by col21 desc;
ERROR:  could not identify an ordering operator for type polygon
LINE 1: select col21 from gpsort_alltypes order by col21 desc;
                                                   ^
HINT:  Use an explicit ordering operator or modify the query.
select col22 from gpsort_alltypes order by col22 asc;
    col22    
-------------
     213.232
      213234
 2.13346e+06
 2.13121e+07
(4 rows)

select col22 from gpsort_alltypes order by col22 desc;
    col22    
-------------
 2.13121e+07
 2.13346e+06
      213234
     213.232
(4 rows)

select col23 from gpsort_alltypes order by col23 asc;
 col23 
-------
     1
     2
     3
     4
(4 rows)

select col23 from gpsort_alltypes order by col23 desc;
 col23 
-------
     4
     3
     2
     1
(4 rows)

select col24 from gpsort_alltypes order by col24 asc;
 col24 
-------
   123
  1323
  2343
  7123
(4 rows)

select col24 from gpsort_alltypes order by col24 desc;
 col24 
-------
  7123
  2343
  1323
   123
(4 rows)

select col25 from gpsort_alltypes order by col25 asc;
                    col25                    
---------------------------------------------
 234234abcddasdflasjflasfjalf
 2342abcddfasfasf234234234
 abcd23423afasflasfasf
 abcdsafasfasfasfasfdasfasfdasf2asdfhsadfsfs
(4 rows)

select col25 from gpsort_alltypes order by col25 desc;
                    col25                    
---------------------------------------------
 abcdsafasfasfasfasfdasfasfdasf2asdfhsadfsfs
 abcd23423afasflasfasf
 2342abcddfasfasf234234234
 234234abcddasdflasjflasfjalf
(4 rows)

select col26 from gpsort_alltypes order by col26 asc;
  col26   
----------
 04:00:00
 04:30:00
 14:30:00
 16:30:00
(4 rows)

select col26 from gpsort_alltypes order by col26 desc;
  col26   
----------
 16:30:00
 14:30:00
 04:30:00
 04:00:00
(4 rows)

select col27 from gpsort_alltypes order by col27 asc;
    col27    
-------------
 04:00:00-05
 04:30:00-05
 14:30:00-08
 16:30:00-08
(4 rows)

select col27 from gpsort_alltypes order by col27 desc;
    col27    
-------------
 16:30:00-08
 14:30:00-08
 04:30:00-05
 04:00:00-05
(4 rows)

select col28 from gpsort_alltypes order by col28 asc;
          col28           
--------------------------
 Wed Feb 01 16:30:00 2006
 Mon Jan 01 04:00:00 2007
 Thu Feb 01 04:30:00 2007
 Thu Feb 01 14:30:00 2007
(4 rows)

select col28 from gpsort_alltypes order by col28 desc;
          col28           
--------------------------
 Thu Feb 01 14:30:00 2007
 Thu Feb 01 04:30:00 2007
 Mon Jan 01 04:00:00 2007
 Wed Feb 01 16:30:00 2006
(4 rows)

select col29 from gpsort_alltypes order by col29 asc;
            col29             
------------------------------
 Wed Feb 01 16:30:00 2006 PST
 Mon Jan 01 01:00:00 2007 PST
 Thu Feb 01 01:30:00 2007 PST
 Thu Feb 01 14:30:00 2007 PST
(4 rows)

select col29 from gpsort_alltypes order by col29 desc;
            col29             
------------------------------
 Thu Feb 01 14:30:00 2007 PST
 Thu Feb 01 01:30:00 2007 PST
 Mon Jan 01 01:00:00 2007 PST
 Wed Feb 01 16:30:00 2006 PST
(4 rows)

drop table gpsort_alltypes;
SELECT CASE WHEN olap_sale.prc < 10 THEN 1 ELSE 2 END as newalias1,olap_sale.pn + olap_sale.prc as newalias2,olap_sale.qty as newalias3,GROUPING(olap_sale.qty,olap_sale.prc,olap_sale.prc),GROUP_ID(), TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.pn-olap_sale.cn)),0),'99999999.9999999') 
FROM olap_sale,olap_vendor
WHERE olap_sale.vn=olap_vendor.vn
GROUP BY GROUPING SETS(ROLLUP((olap_sale.vn),(newalias1,olap_sale.dt,olap_sale.qty),(olap_sale.qty,newalias2,newalias1,olap_sale.prc,olap_sale.pn),(olap_sale.dt),(newalias1,olap_sale.cn),(olap_sale.prc,olap_sale.pn,olap_sale.prc,olap_sale.prc),(olap_sale.vn,newalias3,olap_sale.pn,olap_sale.cn,newalias1),(olap_sale.cn,olap_sale.vn,newalias2),(olap_sale.pn,newalias2,newalias2))),CUBE((olap_sale.pn,olap_sale.cn,newalias2),(olap_sale.cn,newalias3,olap_sale.prc,olap_sale.cn),(olap_sale.vn,newalias1,newalias2),(newalias2,olap_sale.cn,newalias3,newalias3)),olap_sale.prc,olap_sale.pn,olap_sale.qty ORDER BY 1 asc,newalias2 asc,newalias2 desc,4,5; 
ERROR:  GROUPING SETS / ROLLUP / CUBE columns ambiguous.
SELECT CASE WHEN olap_sale.vn < 10 THEN 1 ELSE 2 END as newalias1,olap_sale.dt as newalias2,CASE WHEN olap_sale.dt < 10 THEN 1 ELSE 2 END as newalias3,CASE WHEN olap_sale.qty < 10 THEN 1 ELSE 2 END as newalias4,CASE WHEN olap_sale.pn < 10 THEN 1 ELSE 2 END as newalias5,CASE WHEN olap_sale.cn < 10 THEN 1 ELSE 2 END as newalias6,GROUPING(olap_sale.dt,olap_sale.dt,olap_sale.dt,olap_sale.dt,olap_sale.qty,olap_sale.qty),GROUP_ID(), TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.cn/olap_sale.pn)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.qty-olap_sale.vn)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.pn+olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(SUM(DISTINCT floor(olap_sale.pn+olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.prc-olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.vn)),0),'99999999.9999999') 
FROM olap_sale,olap_customer,olap_product
WHERE olap_sale.cn=olap_customer.cn AND olap_sale.pn=olap_product.pn
GROUP BY ROLLUP((olap_sale.qty),(olap_sale.pn,olap_sale.cn,newalias2,olap_sale.dt),(newalias3,olap_sale.vn,olap_sale.qty,newalias2),(olap_sale.prc,newalias1,olap_sale.prc,olap_sale.qty),(olap_sale.vn),(newalias1,olap_sale.pn,newalias3,newalias1,olap_sale.pn)),olap_sale.vn,olap_sale.dt,olap_sale.qty,olap_sale.pn,olap_sale.cn
SELECT CASE WHEN olap_sale.pn < 10 THEN 1 ELSE 2 END as newalias1,GROUPING(olap_sale.pn), TO_CHAR(COALESCE(STDDEV(DISTINCT floor(olap_sale.qty+olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.qty-olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(SUM(DISTINCT floor(olap_sale.qty*olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.vn)),0),'99999999.9999999'),TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(STDDEV(DISTINCT floor(olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(SUM(DISTINCT floor(olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.cn-olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.pn)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.cn)),0),'99999999.9999999') 
FROM olap_sale
GROUP BY (),olap_sale.pn ORDER BY newalias1 desc; -- order 1
ERROR:  syntax error at or near "SELECT"
LINE 5: SELECT CASE WHEN olap_sale.pn < 10 THEN 1 ELSE 2 END as newa...
        ^
SELECT olap_sale.qty*2 as newalias1,olap_sale.cn + olap_sale.cn as newalias2,olap_sale.cn + olap_sale.cn as newalias3, TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.pn)),0),'99999999.9999999'),TO_CHAR(COALESCE(STDDEV(DISTINCT floor(olap_sale.pn-olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.pn)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.pn+olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.prc/olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.vn*olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.pn-olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.prc*olap_sale.vn)),0),'99999999.9999999'),TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(COUNT(DISTINCT floor(olap_sale.pn-olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(MIN(DISTINCT floor(olap_sale.qty-olap_sale.qty)),0),'99999999.9999999') 
FROM olap_sale,olap_product
WHERE olap_sale.pn=olap_product.pn
GROUP BY (),GROUPING SETS(()),ROLLUP((olap_sale.prc,olap_sale.cn,olap_sale.prc),(olap_sale.cn),(newalias2),(olap_sale.pn),(olap_sale.cn,newalias1),(newalias1,newalias1,olap_sale.prc),(olap_sale.cn,olap_sale.dt,olap_sale.prc),(newalias2,newalias2)),olap_sale.qty,olap_sale.cn ORDER BY newalias3 desc,newalias2 desc,7 asc; -- order 3,2,7
 newalias1 | newalias2 | newalias3 |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      |      to_char      
-----------+-----------+-----------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------+-------------------
           |           |           |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
           |           |           |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |           |           |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |           |           |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
           |           |           |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
           |           |           |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |           |           |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |           |           |       800.0000000 |        70.7106781 |       800.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       746.0000000 |          .0000000 |         1.0000000 |         2.0000000 |          .0000000
           |           |           |       800.0000000 |        70.7106781 |       800.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       746.0000000 |          .0000000 |         1.0000000 |         2.0000000 |          .0000000
           |           |           |       800.0000000 |        70.7106781 |       800.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       746.0000000 |          .0000000 |         1.0000000 |         2.0000000 |          .0000000
           |           |           |       600.0000000 |        70.7106781 |       600.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       547.0000000 |          .0000000 |         5.0000000 |         2.0000000 |          .0000000
           |           |           |       600.0000000 |        70.7106781 |       600.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       547.0000000 |          .0000000 |         5.0000000 |         2.0000000 |          .0000000
           |           |           |       600.0000000 |        70.7106781 |       600.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       547.0000000 |          .0000000 |         5.0000000 |         2.0000000 |          .0000000
           |           |           |       400.0000000 |       129.0994449 |       400.0000000 |         4.0000000 |         1.0000000 |         4.0000000 |       249.0000000 |          .0000000 |          .0000000 |         4.0000000 |          .0000000
           |           |           |       400.0000000 |       129.0994449 |       400.0000000 |         4.0000000 |         1.0000000 |         4.0000000 |       249.0000000 |          .0000000 |          .0000000 |         4.0000000 |          .0000000
           |           |           |       400.0000000 |       129.0994449 |       400.0000000 |         4.0000000 |         1.0000000 |         4.0000000 |       249.0000000 |          .0000000 |          .0000000 |         4.0000000 |          .0000000
         2 |         8 |         8 |       800.0000000 |          .0000000 |       800.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       796.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       800.0000000 |          .0000000 |       800.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       796.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       800.0000000 |          .0000000 |       800.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       796.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       700.0000000 |          .0000000 |       700.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       696.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       700.0000000 |          .0000000 |       700.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       696.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
           |         8 |         8 |       800.0000000 |          .0000000 |       800.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       796.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
           |         8 |         8 |       700.0000000 |          .0000000 |       700.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       696.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       700.0000000 |          .0000000 |       700.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       696.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       700.0000000 |          .0000000 |       700.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       696.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
         2 |         8 |         8 |       800.0000000 |          .0000000 |       800.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       796.0000000 |          .0000000 |         1.0000000 |         1.0000000 |          .0000000
           |         8 |         8 |       800.0000000 |        70.7106781 |       800.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       746.0000000 |          .0000000 |         1.0000000 |         2.0000000 |          .0000000
         2 |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       600.0000000 |          .0000000 |       600.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       597.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       600.0000000 |          .0000000 |       600.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       597.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       497.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       497.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
         2 |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       497.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         6 |         6 |       600.0000000 |          .0000000 |       600.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       597.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |         6 |         6 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       497.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |         6 |         6 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       197.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       600.0000000 |          .0000000 |       600.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       597.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       600.0000000 |          .0000000 |       600.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       597.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         6 |         6 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       497.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |         6 |         6 |       600.0000000 |        70.7106781 |       600.0000000 |         2.0000000 |         1.0000000 |         1.0000000 |       547.0000000 |          .0000000 |         5.0000000 |         2.0000000 |          .0000000
      2200 |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
      2200 |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
         2 |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
           |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
      2200 |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
      2200 |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
           |         4 |         4 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        98.0000000 |          .0000000 |      2400.0000000 |         1.0000000 |          .0000000
         2 |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         4 |         4 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       398.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       399.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       300.0000000 |          .0000000 |       300.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       299.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       300.0000000 |          .0000000 |       300.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       299.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       199.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       199.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        99.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        99.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
        24 |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        99.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       300.0000000 |          .0000000 |       300.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       299.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       399.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       399.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
        24 |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
        24 |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        99.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       399.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       100.0000000 |          .0000000 |       100.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |        99.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       199.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       199.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       200.0000000 |          .0000000 |       200.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       199.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       500.0000000 |          .0000000 |       500.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       499.0000000 |          .0000000 |         5.0000000 |         1.0000000 |          .0000000
         2 |         2 |         2 |       300.0000000 |          .0000000 |       300.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       299.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       400.0000000 |          .0000000 |       400.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       399.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       300.0000000 |          .0000000 |       300.0000000 |         1.0000000 |         1.0000000 |         1.0000000 |       299.0000000 |          .0000000 |          .0000000 |         1.0000000 |          .0000000
           |         2 |         2 |       400.0000000 |       129.0994449 |       400.0000000 |         4.0000000 |         1.0000000 |         4.0000000 |       249.0000000 |          .0000000 |          .0000000 |         4.0000000 |          .0000000
(88 rows)

SELECT olap_sale.qty*2 as newalias1,olap_sale.pn*2 as newalias2,olap_sale.cn as newalias3,olap_sale.cn*2 as newalias4,GROUP_ID(), TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(AVG(DISTINCT floor(olap_sale.qty+olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.vn+olap_sale.vn)),0),'99999999.9999999'),TO_CHAR(COALESCE(MIN(DISTINCT floor(olap_sale.cn)),0),'99999999.9999999'),TO_CHAR(COALESCE(STDDEV(DISTINCT floor(olap_sale.pn)),0),'99999999.9999999'),TO_CHAR(COALESCE(MIN(DISTINCT floor(olap_sale.qty)),0),'99999999.9999999'),TO_CHAR(COALESCE(MAX(DISTINCT floor(olap_sale.cn+olap_sale.prc)),0),'99999999.9999999'),TO_CHAR(COALESCE(VARIANCE(DISTINCT floor(olap_sale.pn)),0),'99999999.9999999') 
FROM olap_sale
GROUP BY GROUPING SETS(CUBE((olap_sale.dt,olap_sale.prc,newalias2,olap_sale.dt),(olap_sale.pn,newalias4,olap_sale.vn),(olap_sale.cn,olap_sale.cn,olap_sale.qty,olap_sale.cn,olap_sale.vn),(olap_sale.pn)),(olap_sale.cn),(olap_sale.cn),()),olap_sale.qty,olap_sale.pn,olap_sale.cn ORDER BY newalias1 desc,11 desc,newalias2 asc,newalias4 asc; -- order 1,11,2,4
ERROR:  GROUPING SETS / ROLLUP / CUBE columns ambiguous.
