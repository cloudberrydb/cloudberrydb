--
-- Set up
--
drop table if exists x;
drop table if exists y;
drop table if exists z;
NOTICE:  table "z" does not exist, skipping
drop table if exists t;
NOTICE:  table "t" does not exist, skipping
create table x (a int, b int, c int);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into x values (generate_series(1,10), generate_series(1,10), generate_series(1,10));
create table y (a int, b int, c int);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into y (select * from x);
CREATE FUNCTION func_x(x int) RETURNS int AS $$
BEGIN
RETURN $1 +1;
END
$$ LANGUAGE plpgsql;
create table z(x int) distributed by (x);
CREATE TABLE bfv_joins_foo AS SELECT i as a, i+1 as b from generate_series(1,10)i;
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause. Creating a NULL policy entry.
CREATE TABLE bfv_joins_bar AS SELECT i as c, i+1 as d from generate_series(1,10)i;
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause. Creating a NULL policy entry.
CREATE TABLE t AS SELECT bfv_joins_foo.a,bfv_joins_foo.b,bfv_joins_bar.d FROM bfv_joins_foo,bfv_joins_bar WHERE bfv_joins_foo.a = bfv_joins_bar.d;
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause. Creating a NULL policy entry.
CREATE FUNCTION my_equality(a int, b int) RETURNS BOOL
    AS $$ SELECT $1 < $2 $$
    LANGUAGE SQL;
create table x_non_part (a int, b int, c int);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'a' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into x_non_part select i%3, i, i from generate_series(1,10) i;
create table x_part (e int, f int, g int) partition by range(e) (start(1) end(5) every(1), default partition extra);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'e' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
NOTICE:  CREATE TABLE will create partition "x_part_1_prt_extra" for table "x_part"
NOTICE:  CREATE TABLE will create partition "x_part_1_prt_2" for table "x_part"
NOTICE:  CREATE TABLE will create partition "x_part_1_prt_3" for table "x_part"
NOTICE:  CREATE TABLE will create partition "x_part_1_prt_4" for table "x_part"
NOTICE:  CREATE TABLE will create partition "x_part_1_prt_5" for table "x_part"
insert into x_part select generate_series(1,10), generate_series(1,10) * 3, generate_series(1,10)%6;
analyze x_non_part;
analyze x_part;
--
-- Test with more null-filtering conditions for LOJ transformation in Orca
--
SELECT * from x left join y on True where y.a > 0;
 a  | b  | c  | a  | b  | c  
----+----+----+----+----+----
  1 |  1 |  1 |  8 |  8 |  8
  2 |  2 |  2 |  8 |  8 |  8
  1 |  1 |  1 |  9 |  9 |  9
  2 |  2 |  2 |  9 |  9 |  9
  1 |  1 |  1 | 10 | 10 | 10
  2 |  2 |  2 | 10 | 10 | 10
  1 |  1 |  1 |  1 |  1 |  1
  2 |  2 |  2 |  1 |  1 |  1
  1 |  1 |  1 |  2 |  2 |  2
  2 |  2 |  2 |  2 |  2 |  2
  1 |  1 |  1 |  3 |  3 |  3
  2 |  2 |  2 |  3 |  3 |  3
  1 |  1 |  1 |  4 |  4 |  4
  2 |  2 |  2 |  4 |  4 |  4
  1 |  1 |  1 |  5 |  5 |  5
  2 |  2 |  2 |  5 |  5 |  5
  1 |  1 |  1 |  6 |  6 |  6
  2 |  2 |  2 |  6 |  6 |  6
  1 |  1 |  1 |  7 |  7 |  7
  2 |  2 |  2 |  7 |  7 |  7
  3 |  3 |  3 |  1 |  1 |  1
  4 |  4 |  4 |  1 |  1 |  1
  5 |  5 |  5 |  1 |  1 |  1
  6 |  6 |  6 |  1 |  1 |  1
  7 |  7 |  7 |  1 |  1 |  1
  3 |  3 |  3 |  2 |  2 |  2
  4 |  4 |  4 |  2 |  2 |  2
  5 |  5 |  5 |  2 |  2 |  2
  6 |  6 |  6 |  2 |  2 |  2
  7 |  7 |  7 |  2 |  2 |  2
  3 |  3 |  3 |  3 |  3 |  3
  4 |  4 |  4 |  3 |  3 |  3
  5 |  5 |  5 |  3 |  3 |  3
  6 |  6 |  6 |  3 |  3 |  3
  7 |  7 |  7 |  3 |  3 |  3
  3 |  3 |  3 |  4 |  4 |  4
  4 |  4 |  4 |  4 |  4 |  4
  5 |  5 |  5 |  4 |  4 |  4
  6 |  6 |  6 |  4 |  4 |  4
  7 |  7 |  7 |  4 |  4 |  4
  3 |  3 |  3 |  5 |  5 |  5
  4 |  4 |  4 |  5 |  5 |  5
  5 |  5 |  5 |  5 |  5 |  5
  6 |  6 |  6 |  5 |  5 |  5
  7 |  7 |  7 |  5 |  5 |  5
  3 |  3 |  3 |  6 |  6 |  6
  4 |  4 |  4 |  6 |  6 |  6
  5 |  5 |  5 |  6 |  6 |  6
  6 |  6 |  6 |  6 |  6 |  6
  7 |  7 |  7 |  6 |  6 |  6
  3 |  3 |  3 |  7 |  7 |  7
  4 |  4 |  4 |  7 |  7 |  7
  5 |  5 |  5 |  7 |  7 |  7
  6 |  6 |  6 |  7 |  7 |  7
  7 |  7 |  7 |  7 |  7 |  7
  3 |  3 |  3 |  8 |  8 |  8
  4 |  4 |  4 |  8 |  8 |  8
  5 |  5 |  5 |  8 |  8 |  8
  6 |  6 |  6 |  8 |  8 |  8
  7 |  7 |  7 |  8 |  8 |  8
  3 |  3 |  3 |  9 |  9 |  9
  4 |  4 |  4 |  9 |  9 |  9
  5 |  5 |  5 |  9 |  9 |  9
  6 |  6 |  6 |  9 |  9 |  9
  7 |  7 |  7 |  9 |  9 |  9
  3 |  3 |  3 | 10 | 10 | 10
  4 |  4 |  4 | 10 | 10 | 10
  5 |  5 |  5 | 10 | 10 | 10
  6 |  6 |  6 | 10 | 10 | 10
  7 |  7 |  7 | 10 | 10 | 10
  8 |  8 |  8 |  1 |  1 |  1
  9 |  9 |  9 |  1 |  1 |  1
 10 | 10 | 10 |  1 |  1 |  1
  8 |  8 |  8 |  2 |  2 |  2
  9 |  9 |  9 |  2 |  2 |  2
 10 | 10 | 10 |  2 |  2 |  2
  8 |  8 |  8 |  3 |  3 |  3
  9 |  9 |  9 |  3 |  3 |  3
 10 | 10 | 10 |  3 |  3 |  3
  8 |  8 |  8 |  4 |  4 |  4
  9 |  9 |  9 |  4 |  4 |  4
 10 | 10 | 10 |  4 |  4 |  4
  8 |  8 |  8 |  5 |  5 |  5
  9 |  9 |  9 |  5 |  5 |  5
 10 | 10 | 10 |  5 |  5 |  5
  8 |  8 |  8 |  6 |  6 |  6
  9 |  9 |  9 |  6 |  6 |  6
 10 | 10 | 10 |  6 |  6 |  6
  8 |  8 |  8 |  7 |  7 |  7
  9 |  9 |  9 |  7 |  7 |  7
 10 | 10 | 10 |  7 |  7 |  7
  8 |  8 |  8 |  8 |  8 |  8
  9 |  9 |  9 |  8 |  8 |  8
 10 | 10 | 10 |  8 |  8 |  8
  8 |  8 |  8 |  9 |  9 |  9
  9 |  9 |  9 |  9 |  9 |  9
 10 | 10 | 10 |  9 |  9 |  9
  8 |  8 |  8 | 10 | 10 | 10
  9 |  9 |  9 | 10 | 10 | 10
 10 | 10 | 10 | 10 | 10 | 10
(100 rows)

SELECT * from x left join y on True where y.a > 0 and y.b > 0;
 a  | b  | c  | a  | b  | c  
----+----+----+----+----+----
  8 |  8 |  8 |  8 |  8 |  8
  9 |  9 |  9 |  8 |  8 |  8
 10 | 10 | 10 |  8 |  8 |  8
  8 |  8 |  8 |  9 |  9 |  9
  9 |  9 |  9 |  9 |  9 |  9
 10 | 10 | 10 |  9 |  9 |  9
  8 |  8 |  8 | 10 | 10 | 10
  9 |  9 |  9 | 10 | 10 | 10
 10 | 10 | 10 | 10 | 10 | 10
  8 |  8 |  8 |  1 |  1 |  1
  9 |  9 |  9 |  1 |  1 |  1
 10 | 10 | 10 |  1 |  1 |  1
  8 |  8 |  8 |  2 |  2 |  2
  9 |  9 |  9 |  2 |  2 |  2
 10 | 10 | 10 |  2 |  2 |  2
  8 |  8 |  8 |  3 |  3 |  3
  9 |  9 |  9 |  3 |  3 |  3
 10 | 10 | 10 |  3 |  3 |  3
  8 |  8 |  8 |  4 |  4 |  4
  9 |  9 |  9 |  4 |  4 |  4
 10 | 10 | 10 |  4 |  4 |  4
  8 |  8 |  8 |  5 |  5 |  5
  9 |  9 |  9 |  5 |  5 |  5
 10 | 10 | 10 |  5 |  5 |  5
  8 |  8 |  8 |  6 |  6 |  6
  9 |  9 |  9 |  6 |  6 |  6
 10 | 10 | 10 |  6 |  6 |  6
  8 |  8 |  8 |  7 |  7 |  7
  9 |  9 |  9 |  7 |  7 |  7
 10 | 10 | 10 |  7 |  7 |  7
  1 |  1 |  1 |  8 |  8 |  8
  2 |  2 |  2 |  8 |  8 |  8
  1 |  1 |  1 |  9 |  9 |  9
  2 |  2 |  2 |  9 |  9 |  9
  1 |  1 |  1 | 10 | 10 | 10
  2 |  2 |  2 | 10 | 10 | 10
  1 |  1 |  1 |  1 |  1 |  1
  2 |  2 |  2 |  1 |  1 |  1
  1 |  1 |  1 |  2 |  2 |  2
  2 |  2 |  2 |  2 |  2 |  2
  1 |  1 |  1 |  3 |  3 |  3
  2 |  2 |  2 |  3 |  3 |  3
  1 |  1 |  1 |  4 |  4 |  4
  2 |  2 |  2 |  4 |  4 |  4
  1 |  1 |  1 |  5 |  5 |  5
  2 |  2 |  2 |  5 |  5 |  5
  1 |  1 |  1 |  6 |  6 |  6
  2 |  2 |  2 |  6 |  6 |  6
  1 |  1 |  1 |  7 |  7 |  7
  2 |  2 |  2 |  7 |  7 |  7
  3 |  3 |  3 |  8 |  8 |  8
  4 |  4 |  4 |  8 |  8 |  8
  5 |  5 |  5 |  8 |  8 |  8
  6 |  6 |  6 |  8 |  8 |  8
  7 |  7 |  7 |  8 |  8 |  8
  3 |  3 |  3 |  9 |  9 |  9
  4 |  4 |  4 |  9 |  9 |  9
  5 |  5 |  5 |  9 |  9 |  9
  6 |  6 |  6 |  9 |  9 |  9
  7 |  7 |  7 |  9 |  9 |  9
  3 |  3 |  3 | 10 | 10 | 10
  4 |  4 |  4 | 10 | 10 | 10
  5 |  5 |  5 | 10 | 10 | 10
  6 |  6 |  6 | 10 | 10 | 10
  7 |  7 |  7 | 10 | 10 | 10
  3 |  3 |  3 |  1 |  1 |  1
  4 |  4 |  4 |  1 |  1 |  1
  5 |  5 |  5 |  1 |  1 |  1
  6 |  6 |  6 |  1 |  1 |  1
  7 |  7 |  7 |  1 |  1 |  1
  3 |  3 |  3 |  2 |  2 |  2
  4 |  4 |  4 |  2 |  2 |  2
  5 |  5 |  5 |  2 |  2 |  2
  6 |  6 |  6 |  2 |  2 |  2
  7 |  7 |  7 |  2 |  2 |  2
  3 |  3 |  3 |  3 |  3 |  3
  4 |  4 |  4 |  3 |  3 |  3
  5 |  5 |  5 |  3 |  3 |  3
  6 |  6 |  6 |  3 |  3 |  3
  7 |  7 |  7 |  3 |  3 |  3
  3 |  3 |  3 |  4 |  4 |  4
  4 |  4 |  4 |  4 |  4 |  4
  5 |  5 |  5 |  4 |  4 |  4
  6 |  6 |  6 |  4 |  4 |  4
  7 |  7 |  7 |  4 |  4 |  4
  3 |  3 |  3 |  5 |  5 |  5
  4 |  4 |  4 |  5 |  5 |  5
  5 |  5 |  5 |  5 |  5 |  5
  6 |  6 |  6 |  5 |  5 |  5
  7 |  7 |  7 |  5 |  5 |  5
  3 |  3 |  3 |  6 |  6 |  6
  4 |  4 |  4 |  6 |  6 |  6
  5 |  5 |  5 |  6 |  6 |  6
  6 |  6 |  6 |  6 |  6 |  6
  7 |  7 |  7 |  6 |  6 |  6
  3 |  3 |  3 |  7 |  7 |  7
  4 |  4 |  4 |  7 |  7 |  7
  5 |  5 |  5 |  7 |  7 |  7
  6 |  6 |  6 |  7 |  7 |  7
  7 |  7 |  7 |  7 |  7 |  7
(100 rows)

SELECT * from x left join y on True where y.a in (1,2,3);
 a  | b  | c  | a | b | c 
----+----+----+---+---+---
  1 |  1 |  1 | 1 | 1 | 1
  2 |  2 |  2 | 1 | 1 | 1
  1 |  1 |  1 | 2 | 2 | 2
  2 |  2 |  2 | 2 | 2 | 2
  1 |  1 |  1 | 3 | 3 | 3
  2 |  2 |  2 | 3 | 3 | 3
  3 |  3 |  3 | 3 | 3 | 3
  4 |  4 |  4 | 3 | 3 | 3
  5 |  5 |  5 | 3 | 3 | 3
  6 |  6 |  6 | 3 | 3 | 3
  7 |  7 |  7 | 3 | 3 | 3
  3 |  3 |  3 | 1 | 1 | 1
  4 |  4 |  4 | 1 | 1 | 1
  5 |  5 |  5 | 1 | 1 | 1
  6 |  6 |  6 | 1 | 1 | 1
  7 |  7 |  7 | 1 | 1 | 1
  3 |  3 |  3 | 2 | 2 | 2
  4 |  4 |  4 | 2 | 2 | 2
  5 |  5 |  5 | 2 | 2 | 2
  6 |  6 |  6 | 2 | 2 | 2
  7 |  7 |  7 | 2 | 2 | 2
  8 |  8 |  8 | 3 | 3 | 3
  9 |  9 |  9 | 3 | 3 | 3
 10 | 10 | 10 | 3 | 3 | 3
  8 |  8 |  8 | 1 | 1 | 1
  9 |  9 |  9 | 1 | 1 | 1
 10 | 10 | 10 | 1 | 1 | 1
  8 |  8 |  8 | 2 | 2 | 2
  9 |  9 |  9 | 2 | 2 | 2
 10 | 10 | 10 | 2 | 2 | 2
(30 rows)

SELECT * from x left join y on True where y.a = y.b ;
 a  | b  | c  | a  | b  | c  
----+----+----+----+----+----
  1 |  1 |  1 |  1 |  1 |  1
  2 |  2 |  2 |  1 |  1 |  1
  1 |  1 |  1 |  2 |  2 |  2
  2 |  2 |  2 |  2 |  2 |  2
  1 |  1 |  1 |  3 |  3 |  3
  2 |  2 |  2 |  3 |  3 |  3
  1 |  1 |  1 |  4 |  4 |  4
  2 |  2 |  2 |  4 |  4 |  4
  1 |  1 |  1 |  5 |  5 |  5
  2 |  2 |  2 |  5 |  5 |  5
  1 |  1 |  1 |  6 |  6 |  6
  2 |  2 |  2 |  6 |  6 |  6
  1 |  1 |  1 |  7 |  7 |  7
  2 |  2 |  2 |  7 |  7 |  7
  1 |  1 |  1 |  8 |  8 |  8
  2 |  2 |  2 |  8 |  8 |  8
  1 |  1 |  1 |  9 |  9 |  9
  2 |  2 |  2 |  9 |  9 |  9
  1 |  1 |  1 | 10 | 10 | 10
  2 |  2 |  2 | 10 | 10 | 10
  3 |  3 |  3 |  1 |  1 |  1
  4 |  4 |  4 |  1 |  1 |  1
  5 |  5 |  5 |  1 |  1 |  1
  6 |  6 |  6 |  1 |  1 |  1
  7 |  7 |  7 |  1 |  1 |  1
  3 |  3 |  3 |  2 |  2 |  2
  4 |  4 |  4 |  2 |  2 |  2
  5 |  5 |  5 |  2 |  2 |  2
  6 |  6 |  6 |  2 |  2 |  2
  7 |  7 |  7 |  2 |  2 |  2
  3 |  3 |  3 |  3 |  3 |  3
  4 |  4 |  4 |  3 |  3 |  3
  5 |  5 |  5 |  3 |  3 |  3
  6 |  6 |  6 |  3 |  3 |  3
  7 |  7 |  7 |  3 |  3 |  3
  3 |  3 |  3 |  4 |  4 |  4
  4 |  4 |  4 |  4 |  4 |  4
  5 |  5 |  5 |  4 |  4 |  4
  6 |  6 |  6 |  4 |  4 |  4
  7 |  7 |  7 |  4 |  4 |  4
  3 |  3 |  3 |  5 |  5 |  5
  4 |  4 |  4 |  5 |  5 |  5
  5 |  5 |  5 |  5 |  5 |  5
  6 |  6 |  6 |  5 |  5 |  5
  7 |  7 |  7 |  5 |  5 |  5
  3 |  3 |  3 |  6 |  6 |  6
  4 |  4 |  4 |  6 |  6 |  6
  5 |  5 |  5 |  6 |  6 |  6
  6 |  6 |  6 |  6 |  6 |  6
  7 |  7 |  7 |  6 |  6 |  6
  3 |  3 |  3 |  7 |  7 |  7
  4 |  4 |  4 |  7 |  7 |  7
  5 |  5 |  5 |  7 |  7 |  7
  6 |  6 |  6 |  7 |  7 |  7
  7 |  7 |  7 |  7 |  7 |  7
  3 |  3 |  3 |  8 |  8 |  8
  4 |  4 |  4 |  8 |  8 |  8
  5 |  5 |  5 |  8 |  8 |  8
  6 |  6 |  6 |  8 |  8 |  8
  7 |  7 |  7 |  8 |  8 |  8
  3 |  3 |  3 |  9 |  9 |  9
  4 |  4 |  4 |  9 |  9 |  9
  5 |  5 |  5 |  9 |  9 |  9
  6 |  6 |  6 |  9 |  9 |  9
  7 |  7 |  7 |  9 |  9 |  9
  3 |  3 |  3 | 10 | 10 | 10
  4 |  4 |  4 | 10 | 10 | 10
  5 |  5 |  5 | 10 | 10 | 10
  6 |  6 |  6 | 10 | 10 | 10
  7 |  7 |  7 | 10 | 10 | 10
  8 |  8 |  8 |  1 |  1 |  1
  9 |  9 |  9 |  1 |  1 |  1
 10 | 10 | 10 |  1 |  1 |  1
  8 |  8 |  8 |  2 |  2 |  2
  9 |  9 |  9 |  2 |  2 |  2
 10 | 10 | 10 |  2 |  2 |  2
  8 |  8 |  8 |  3 |  3 |  3
  9 |  9 |  9 |  3 |  3 |  3
 10 | 10 | 10 |  3 |  3 |  3
  8 |  8 |  8 |  4 |  4 |  4
  9 |  9 |  9 |  4 |  4 |  4
 10 | 10 | 10 |  4 |  4 |  4
  8 |  8 |  8 |  5 |  5 |  5
  9 |  9 |  9 |  5 |  5 |  5
 10 | 10 | 10 |  5 |  5 |  5
  8 |  8 |  8 |  6 |  6 |  6
  9 |  9 |  9 |  6 |  6 |  6
 10 | 10 | 10 |  6 |  6 |  6
  8 |  8 |  8 |  7 |  7 |  7
  9 |  9 |  9 |  7 |  7 |  7
 10 | 10 | 10 |  7 |  7 |  7
  8 |  8 |  8 |  8 |  8 |  8
  9 |  9 |  9 |  8 |  8 |  8
 10 | 10 | 10 |  8 |  8 |  8
  8 |  8 |  8 |  9 |  9 |  9
  9 |  9 |  9 |  9 |  9 |  9
 10 | 10 | 10 |  9 |  9 |  9
  8 |  8 |  8 | 10 | 10 | 10
  9 |  9 |  9 | 10 | 10 | 10
 10 | 10 | 10 | 10 | 10 | 10
(100 rows)

SELECT * from x left join y on True where y.a is NULL;
 a | b | c | a | b | c 
---+---+---+---+---+---
(0 rows)

SELECT * from x left join y on True where y.a is NOT NULL;
 a  | b  | c  | a  | b  | c  
----+----+----+----+----+----
  1 |  1 |  1 |  1 |  1 |  1
  2 |  2 |  2 |  1 |  1 |  1
  1 |  1 |  1 |  2 |  2 |  2
  2 |  2 |  2 |  2 |  2 |  2
  1 |  1 |  1 |  3 |  3 |  3
  2 |  2 |  2 |  3 |  3 |  3
  1 |  1 |  1 |  4 |  4 |  4
  2 |  2 |  2 |  4 |  4 |  4
  1 |  1 |  1 |  5 |  5 |  5
  2 |  2 |  2 |  5 |  5 |  5
  1 |  1 |  1 |  6 |  6 |  6
  2 |  2 |  2 |  6 |  6 |  6
  1 |  1 |  1 |  7 |  7 |  7
  2 |  2 |  2 |  7 |  7 |  7
  1 |  1 |  1 |  8 |  8 |  8
  2 |  2 |  2 |  8 |  8 |  8
  1 |  1 |  1 |  9 |  9 |  9
  2 |  2 |  2 |  9 |  9 |  9
  1 |  1 |  1 | 10 | 10 | 10
  2 |  2 |  2 | 10 | 10 | 10
  3 |  3 |  3 |  1 |  1 |  1
  4 |  4 |  4 |  1 |  1 |  1
  5 |  5 |  5 |  1 |  1 |  1
  6 |  6 |  6 |  1 |  1 |  1
  7 |  7 |  7 |  1 |  1 |  1
  3 |  3 |  3 |  2 |  2 |  2
  4 |  4 |  4 |  2 |  2 |  2
  5 |  5 |  5 |  2 |  2 |  2
  6 |  6 |  6 |  2 |  2 |  2
  7 |  7 |  7 |  2 |  2 |  2
  3 |  3 |  3 |  3 |  3 |  3
  4 |  4 |  4 |  3 |  3 |  3
  5 |  5 |  5 |  3 |  3 |  3
  6 |  6 |  6 |  3 |  3 |  3
  7 |  7 |  7 |  3 |  3 |  3
  3 |  3 |  3 |  4 |  4 |  4
  4 |  4 |  4 |  4 |  4 |  4
  5 |  5 |  5 |  4 |  4 |  4
  6 |  6 |  6 |  4 |  4 |  4
  7 |  7 |  7 |  4 |  4 |  4
  3 |  3 |  3 |  5 |  5 |  5
  4 |  4 |  4 |  5 |  5 |  5
  5 |  5 |  5 |  5 |  5 |  5
  6 |  6 |  6 |  5 |  5 |  5
  7 |  7 |  7 |  5 |  5 |  5
  3 |  3 |  3 |  6 |  6 |  6
  4 |  4 |  4 |  6 |  6 |  6
  5 |  5 |  5 |  6 |  6 |  6
  6 |  6 |  6 |  6 |  6 |  6
  7 |  7 |  7 |  6 |  6 |  6
  3 |  3 |  3 |  7 |  7 |  7
  4 |  4 |  4 |  7 |  7 |  7
  5 |  5 |  5 |  7 |  7 |  7
  6 |  6 |  6 |  7 |  7 |  7
  7 |  7 |  7 |  7 |  7 |  7
  3 |  3 |  3 |  8 |  8 |  8
  4 |  4 |  4 |  8 |  8 |  8
  5 |  5 |  5 |  8 |  8 |  8
  6 |  6 |  6 |  8 |  8 |  8
  7 |  7 |  7 |  8 |  8 |  8
  3 |  3 |  3 |  9 |  9 |  9
  4 |  4 |  4 |  9 |  9 |  9
  5 |  5 |  5 |  9 |  9 |  9
  6 |  6 |  6 |  9 |  9 |  9
  7 |  7 |  7 |  9 |  9 |  9
  3 |  3 |  3 | 10 | 10 | 10
  4 |  4 |  4 | 10 | 10 | 10
  5 |  5 |  5 | 10 | 10 | 10
  6 |  6 |  6 | 10 | 10 | 10
  7 |  7 |  7 | 10 | 10 | 10
  8 |  8 |  8 |  1 |  1 |  1
  9 |  9 |  9 |  1 |  1 |  1
 10 | 10 | 10 |  1 |  1 |  1
  8 |  8 |  8 |  2 |  2 |  2
  9 |  9 |  9 |  2 |  2 |  2
 10 | 10 | 10 |  2 |  2 |  2
  8 |  8 |  8 |  3 |  3 |  3
  9 |  9 |  9 |  3 |  3 |  3
 10 | 10 | 10 |  3 |  3 |  3
  8 |  8 |  8 |  4 |  4 |  4
  9 |  9 |  9 |  4 |  4 |  4
 10 | 10 | 10 |  4 |  4 |  4
  8 |  8 |  8 |  5 |  5 |  5
  9 |  9 |  9 |  5 |  5 |  5
 10 | 10 | 10 |  5 |  5 |  5
  8 |  8 |  8 |  6 |  6 |  6
  9 |  9 |  9 |  6 |  6 |  6
 10 | 10 | 10 |  6 |  6 |  6
  8 |  8 |  8 |  7 |  7 |  7
  9 |  9 |  9 |  7 |  7 |  7
 10 | 10 | 10 |  7 |  7 |  7
  8 |  8 |  8 |  8 |  8 |  8
  9 |  9 |  9 |  8 |  8 |  8
 10 | 10 | 10 |  8 |  8 |  8
  8 |  8 |  8 |  9 |  9 |  9
  9 |  9 |  9 |  9 |  9 |  9
 10 | 10 | 10 |  9 |  9 |  9
  8 |  8 |  8 | 10 | 10 | 10
  9 |  9 |  9 | 10 | 10 | 10
 10 | 10 | 10 | 10 | 10 | 10
(100 rows)

SELECT * from x left join y on True where y.a is NULL and Y.b > 0;
 a | b | c | a | b | c 
---+---+---+---+---+---
(0 rows)

SELECT * from x left join y on True where func_x(y.a) > 0;
 a  | b  | c  | a  | b  | c  
----+----+----+----+----+----
  1 |  1 |  1 |  1 |  1 |  1
  1 |  1 |  1 |  2 |  2 |  2
  1 |  1 |  1 |  8 |  8 |  8
  1 |  1 |  1 |  9 |  9 |  9
  1 |  1 |  1 | 10 | 10 | 10
  1 |  1 |  1 |  3 |  3 |  3
  1 |  1 |  1 |  4 |  4 |  4
  1 |  1 |  1 |  5 |  5 |  5
  1 |  1 |  1 |  6 |  6 |  6
  1 |  1 |  1 |  7 |  7 |  7
  2 |  2 |  2 |  1 |  1 |  1
  2 |  2 |  2 |  2 |  2 |  2
  2 |  2 |  2 |  8 |  8 |  8
  2 |  2 |  2 |  9 |  9 |  9
  2 |  2 |  2 | 10 | 10 | 10
  2 |  2 |  2 |  3 |  3 |  3
  2 |  2 |  2 |  4 |  4 |  4
  2 |  2 |  2 |  5 |  5 |  5
  2 |  2 |  2 |  6 |  6 |  6
  2 |  2 |  2 |  7 |  7 |  7
  3 |  3 |  3 |  1 |  1 |  1
  3 |  3 |  3 |  2 |  2 |  2
  3 |  3 |  3 |  8 |  8 |  8
  3 |  3 |  3 |  9 |  9 |  9
  3 |  3 |  3 | 10 | 10 | 10
  3 |  3 |  3 |  3 |  3 |  3
  3 |  3 |  3 |  4 |  4 |  4
  3 |  3 |  3 |  5 |  5 |  5
  3 |  3 |  3 |  6 |  6 |  6
  3 |  3 |  3 |  7 |  7 |  7
  4 |  4 |  4 |  1 |  1 |  1
  4 |  4 |  4 |  2 |  2 |  2
  4 |  4 |  4 |  8 |  8 |  8
  4 |  4 |  4 |  9 |  9 |  9
  4 |  4 |  4 | 10 | 10 | 10
  4 |  4 |  4 |  3 |  3 |  3
  4 |  4 |  4 |  4 |  4 |  4
  4 |  4 |  4 |  5 |  5 |  5
  4 |  4 |  4 |  6 |  6 |  6
  4 |  4 |  4 |  7 |  7 |  7
  5 |  5 |  5 |  1 |  1 |  1
  5 |  5 |  5 |  2 |  2 |  2
  5 |  5 |  5 |  8 |  8 |  8
  5 |  5 |  5 |  9 |  9 |  9
  5 |  5 |  5 | 10 | 10 | 10
  5 |  5 |  5 |  3 |  3 |  3
  5 |  5 |  5 |  4 |  4 |  4
  5 |  5 |  5 |  5 |  5 |  5
  5 |  5 |  5 |  6 |  6 |  6
  5 |  5 |  5 |  7 |  7 |  7
  6 |  6 |  6 |  1 |  1 |  1
  6 |  6 |  6 |  2 |  2 |  2
  6 |  6 |  6 |  8 |  8 |  8
  6 |  6 |  6 |  9 |  9 |  9
  6 |  6 |  6 | 10 | 10 | 10
  6 |  6 |  6 |  3 |  3 |  3
  6 |  6 |  6 |  4 |  4 |  4
  6 |  6 |  6 |  5 |  5 |  5
  6 |  6 |  6 |  6 |  6 |  6
  6 |  6 |  6 |  7 |  7 |  7
  7 |  7 |  7 |  1 |  1 |  1
  7 |  7 |  7 |  2 |  2 |  2
  7 |  7 |  7 |  8 |  8 |  8
  7 |  7 |  7 |  9 |  9 |  9
  7 |  7 |  7 | 10 | 10 | 10
  7 |  7 |  7 |  3 |  3 |  3
  7 |  7 |  7 |  4 |  4 |  4
  7 |  7 |  7 |  5 |  5 |  5
  7 |  7 |  7 |  6 |  6 |  6
  7 |  7 |  7 |  7 |  7 |  7
  8 |  8 |  8 |  1 |  1 |  1
  8 |  8 |  8 |  2 |  2 |  2
  8 |  8 |  8 |  8 |  8 |  8
  8 |  8 |  8 |  9 |  9 |  9
  8 |  8 |  8 | 10 | 10 | 10
  8 |  8 |  8 |  3 |  3 |  3
  8 |  8 |  8 |  4 |  4 |  4
  8 |  8 |  8 |  5 |  5 |  5
  8 |  8 |  8 |  6 |  6 |  6
  8 |  8 |  8 |  7 |  7 |  7
  9 |  9 |  9 |  1 |  1 |  1
  9 |  9 |  9 |  2 |  2 |  2
  9 |  9 |  9 |  8 |  8 |  8
  9 |  9 |  9 |  9 |  9 |  9
  9 |  9 |  9 | 10 | 10 | 10
  9 |  9 |  9 |  3 |  3 |  3
  9 |  9 |  9 |  4 |  4 |  4
  9 |  9 |  9 |  5 |  5 |  5
  9 |  9 |  9 |  6 |  6 |  6
  9 |  9 |  9 |  7 |  7 |  7
 10 | 10 | 10 |  1 |  1 |  1
 10 | 10 | 10 |  2 |  2 |  2
 10 | 10 | 10 |  8 |  8 |  8
 10 | 10 | 10 |  9 |  9 |  9
 10 | 10 | 10 | 10 | 10 | 10
 10 | 10 | 10 |  3 |  3 |  3
 10 | 10 | 10 |  4 |  4 |  4
 10 | 10 | 10 |  5 |  5 |  5
 10 | 10 | 10 |  6 |  6 |  6
 10 | 10 | 10 |  7 |  7 |  7
(100 rows)

--
-- Test for unexpected NLJ qual
--
explain select 1 as mrs_t1 where 1 <= ALL (select x from z);
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Result  (cost=0.00..882688.07 rows=1 width=4)
   ->  Nested Loop Left Anti Semi Join (Not-In)  (cost=0.00..882688.07 rows=1 width=1)
         Join Filter: true
         ->  Result  (cost=0.00..0.00 rows=1 width=1)
         ->  Materialize  (cost=0.00..431.00 rows=1 width=1)
               ->  Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=1 width=1)
                     ->  Table Scan on z  (cost=0.00..431.00 rows=1 width=1)
                           Filter: 1 > x
 Settings:  optimizer=on
 Optimizer status: PQO version 1.621
(10 rows)

--
-- Test for wrong results in window functions under joins #1
--
select * from
(SELECT bfv_joins_bar.*, AVG(t.b) OVER(PARTITION BY t.a ORDER BY t.b desc) AS e FROM t,bfv_joins_bar) bfv_joins_foo, t
where e < 10
order by 1, 2, 3, 4, 5, 6;
 c  | d  | e | a  | b  | d  
----+----+---+----+----+----
  1 |  2 | 3 |  2 |  3 |  2
  1 |  2 | 3 |  3 |  4 |  3
  1 |  2 | 3 |  4 |  5 |  4
  1 |  2 | 3 |  5 |  6 |  5
  1 |  2 | 3 |  6 |  7 |  6
  1 |  2 | 3 |  7 |  8 |  7
  1 |  2 | 3 |  8 |  9 |  8
  1 |  2 | 3 |  9 | 10 |  9
  1 |  2 | 3 | 10 | 11 | 10
  1 |  2 | 4 |  2 |  3 |  2
  1 |  2 | 4 |  3 |  4 |  3
  1 |  2 | 4 |  4 |  5 |  4
  1 |  2 | 4 |  5 |  6 |  5
  1 |  2 | 4 |  6 |  7 |  6
  1 |  2 | 4 |  7 |  8 |  7
  1 |  2 | 4 |  8 |  9 |  8
  1 |  2 | 4 |  9 | 10 |  9
  1 |  2 | 4 | 10 | 11 | 10
  1 |  2 | 5 |  2 |  3 |  2
  1 |  2 | 5 |  3 |  4 |  3
  1 |  2 | 5 |  4 |  5 |  4
  1 |  2 | 5 |  5 |  6 |  5
  1 |  2 | 5 |  6 |  7 |  6
  1 |  2 | 5 |  7 |  8 |  7
  1 |  2 | 5 |  8 |  9 |  8
  1 |  2 | 5 |  9 | 10 |  9
  1 |  2 | 5 | 10 | 11 | 10
  1 |  2 | 6 |  2 |  3 |  2
  1 |  2 | 6 |  3 |  4 |  3
  1 |  2 | 6 |  4 |  5 |  4
  1 |  2 | 6 |  5 |  6 |  5
  1 |  2 | 6 |  6 |  7 |  6
  1 |  2 | 6 |  7 |  8 |  7
  1 |  2 | 6 |  8 |  9 |  8
  1 |  2 | 6 |  9 | 10 |  9
  1 |  2 | 6 | 10 | 11 | 10
  1 |  2 | 7 |  2 |  3 |  2
  1 |  2 | 7 |  3 |  4 |  3
  1 |  2 | 7 |  4 |  5 |  4
  1 |  2 | 7 |  5 |  6 |  5
  1 |  2 | 7 |  6 |  7 |  6
  1 |  2 | 7 |  7 |  8 |  7
  1 |  2 | 7 |  8 |  9 |  8
  1 |  2 | 7 |  9 | 10 |  9
  1 |  2 | 7 | 10 | 11 | 10
  1 |  2 | 8 |  2 |  3 |  2
  1 |  2 | 8 |  3 |  4 |  3
  1 |  2 | 8 |  4 |  5 |  4
  1 |  2 | 8 |  5 |  6 |  5
  1 |  2 | 8 |  6 |  7 |  6
  1 |  2 | 8 |  7 |  8 |  7
  1 |  2 | 8 |  8 |  9 |  8
  1 |  2 | 8 |  9 | 10 |  9
  1 |  2 | 8 | 10 | 11 | 10
  1 |  2 | 9 |  2 |  3 |  2
  1 |  2 | 9 |  3 |  4 |  3
  1 |  2 | 9 |  4 |  5 |  4
  1 |  2 | 9 |  5 |  6 |  5
  1 |  2 | 9 |  6 |  7 |  6
  1 |  2 | 9 |  7 |  8 |  7
  1 |  2 | 9 |  8 |  9 |  8
  1 |  2 | 9 |  9 | 10 |  9
  1 |  2 | 9 | 10 | 11 | 10
  2 |  3 | 3 |  2 |  3 |  2
  2 |  3 | 3 |  3 |  4 |  3
  2 |  3 | 3 |  4 |  5 |  4
  2 |  3 | 3 |  5 |  6 |  5
  2 |  3 | 3 |  6 |  7 |  6
  2 |  3 | 3 |  7 |  8 |  7
  2 |  3 | 3 |  8 |  9 |  8
  2 |  3 | 3 |  9 | 10 |  9
  2 |  3 | 3 | 10 | 11 | 10
  2 |  3 | 4 |  2 |  3 |  2
  2 |  3 | 4 |  3 |  4 |  3
  2 |  3 | 4 |  4 |  5 |  4
  2 |  3 | 4 |  5 |  6 |  5
  2 |  3 | 4 |  6 |  7 |  6
  2 |  3 | 4 |  7 |  8 |  7
  2 |  3 | 4 |  8 |  9 |  8
  2 |  3 | 4 |  9 | 10 |  9
  2 |  3 | 4 | 10 | 11 | 10
  2 |  3 | 5 |  2 |  3 |  2
  2 |  3 | 5 |  3 |  4 |  3
  2 |  3 | 5 |  4 |  5 |  4
  2 |  3 | 5 |  5 |  6 |  5
  2 |  3 | 5 |  6 |  7 |  6
  2 |  3 | 5 |  7 |  8 |  7
  2 |  3 | 5 |  8 |  9 |  8
  2 |  3 | 5 |  9 | 10 |  9
  2 |  3 | 5 | 10 | 11 | 10
  2 |  3 | 6 |  2 |  3 |  2
  2 |  3 | 6 |  3 |  4 |  3
  2 |  3 | 6 |  4 |  5 |  4
  2 |  3 | 6 |  5 |  6 |  5
  2 |  3 | 6 |  6 |  7 |  6
  2 |  3 | 6 |  7 |  8 |  7
  2 |  3 | 6 |  8 |  9 |  8
  2 |  3 | 6 |  9 | 10 |  9
  2 |  3 | 6 | 10 | 11 | 10
  2 |  3 | 7 |  2 |  3 |  2
  2 |  3 | 7 |  3 |  4 |  3
  2 |  3 | 7 |  4 |  5 |  4
  2 |  3 | 7 |  5 |  6 |  5
  2 |  3 | 7 |  6 |  7 |  6
  2 |  3 | 7 |  7 |  8 |  7
  2 |  3 | 7 |  8 |  9 |  8
  2 |  3 | 7 |  9 | 10 |  9
  2 |  3 | 7 | 10 | 11 | 10
  2 |  3 | 8 |  2 |  3 |  2
  2 |  3 | 8 |  3 |  4 |  3
  2 |  3 | 8 |  4 |  5 |  4
  2 |  3 | 8 |  5 |  6 |  5
  2 |  3 | 8 |  6 |  7 |  6
  2 |  3 | 8 |  7 |  8 |  7
  2 |  3 | 8 |  8 |  9 |  8
  2 |  3 | 8 |  9 | 10 |  9
  2 |  3 | 8 | 10 | 11 | 10
  2 |  3 | 9 |  2 |  3 |  2
  2 |  3 | 9 |  3 |  4 |  3
  2 |  3 | 9 |  4 |  5 |  4
  2 |  3 | 9 |  5 |  6 |  5
  2 |  3 | 9 |  6 |  7 |  6
  2 |  3 | 9 |  7 |  8 |  7
  2 |  3 | 9 |  8 |  9 |  8
  2 |  3 | 9 |  9 | 10 |  9
  2 |  3 | 9 | 10 | 11 | 10
  3 |  4 | 3 |  2 |  3 |  2
  3 |  4 | 3 |  3 |  4 |  3
  3 |  4 | 3 |  4 |  5 |  4
  3 |  4 | 3 |  5 |  6 |  5
  3 |  4 | 3 |  6 |  7 |  6
  3 |  4 | 3 |  7 |  8 |  7
  3 |  4 | 3 |  8 |  9 |  8
  3 |  4 | 3 |  9 | 10 |  9
  3 |  4 | 3 | 10 | 11 | 10
  3 |  4 | 4 |  2 |  3 |  2
  3 |  4 | 4 |  3 |  4 |  3
  3 |  4 | 4 |  4 |  5 |  4
  3 |  4 | 4 |  5 |  6 |  5
  3 |  4 | 4 |  6 |  7 |  6
  3 |  4 | 4 |  7 |  8 |  7
  3 |  4 | 4 |  8 |  9 |  8
  3 |  4 | 4 |  9 | 10 |  9
  3 |  4 | 4 | 10 | 11 | 10
  3 |  4 | 5 |  2 |  3 |  2
  3 |  4 | 5 |  3 |  4 |  3
  3 |  4 | 5 |  4 |  5 |  4
  3 |  4 | 5 |  5 |  6 |  5
  3 |  4 | 5 |  6 |  7 |  6
  3 |  4 | 5 |  7 |  8 |  7
  3 |  4 | 5 |  8 |  9 |  8
  3 |  4 | 5 |  9 | 10 |  9
  3 |  4 | 5 | 10 | 11 | 10
  3 |  4 | 6 |  2 |  3 |  2
  3 |  4 | 6 |  3 |  4 |  3
  3 |  4 | 6 |  4 |  5 |  4
  3 |  4 | 6 |  5 |  6 |  5
  3 |  4 | 6 |  6 |  7 |  6
  3 |  4 | 6 |  7 |  8 |  7
  3 |  4 | 6 |  8 |  9 |  8
  3 |  4 | 6 |  9 | 10 |  9
  3 |  4 | 6 | 10 | 11 | 10
  3 |  4 | 7 |  2 |  3 |  2
  3 |  4 | 7 |  3 |  4 |  3
  3 |  4 | 7 |  4 |  5 |  4
  3 |  4 | 7 |  5 |  6 |  5
  3 |  4 | 7 |  6 |  7 |  6
  3 |  4 | 7 |  7 |  8 |  7
  3 |  4 | 7 |  8 |  9 |  8
  3 |  4 | 7 |  9 | 10 |  9
  3 |  4 | 7 | 10 | 11 | 10
  3 |  4 | 8 |  2 |  3 |  2
  3 |  4 | 8 |  3 |  4 |  3
  3 |  4 | 8 |  4 |  5 |  4
  3 |  4 | 8 |  5 |  6 |  5
  3 |  4 | 8 |  6 |  7 |  6
  3 |  4 | 8 |  7 |  8 |  7
  3 |  4 | 8 |  8 |  9 |  8
  3 |  4 | 8 |  9 | 10 |  9
  3 |  4 | 8 | 10 | 11 | 10
  3 |  4 | 9 |  2 |  3 |  2
  3 |  4 | 9 |  3 |  4 |  3
  3 |  4 | 9 |  4 |  5 |  4
  3 |  4 | 9 |  5 |  6 |  5
  3 |  4 | 9 |  6 |  7 |  6
  3 |  4 | 9 |  7 |  8 |  7
  3 |  4 | 9 |  8 |  9 |  8
  3 |  4 | 9 |  9 | 10 |  9
  3 |  4 | 9 | 10 | 11 | 10
  4 |  5 | 3 |  2 |  3 |  2
  4 |  5 | 3 |  3 |  4 |  3
  4 |  5 | 3 |  4 |  5 |  4
  4 |  5 | 3 |  5 |  6 |  5
  4 |  5 | 3 |  6 |  7 |  6
  4 |  5 | 3 |  7 |  8 |  7
  4 |  5 | 3 |  8 |  9 |  8
  4 |  5 | 3 |  9 | 10 |  9
  4 |  5 | 3 | 10 | 11 | 10
  4 |  5 | 4 |  2 |  3 |  2
  4 |  5 | 4 |  3 |  4 |  3
  4 |  5 | 4 |  4 |  5 |  4
  4 |  5 | 4 |  5 |  6 |  5
  4 |  5 | 4 |  6 |  7 |  6
  4 |  5 | 4 |  7 |  8 |  7
  4 |  5 | 4 |  8 |  9 |  8
  4 |  5 | 4 |  9 | 10 |  9
  4 |  5 | 4 | 10 | 11 | 10
  4 |  5 | 5 |  2 |  3 |  2
  4 |  5 | 5 |  3 |  4 |  3
  4 |  5 | 5 |  4 |  5 |  4
  4 |  5 | 5 |  5 |  6 |  5
  4 |  5 | 5 |  6 |  7 |  6
  4 |  5 | 5 |  7 |  8 |  7
  4 |  5 | 5 |  8 |  9 |  8
  4 |  5 | 5 |  9 | 10 |  9
  4 |  5 | 5 | 10 | 11 | 10
  4 |  5 | 6 |  2 |  3 |  2
  4 |  5 | 6 |  3 |  4 |  3
  4 |  5 | 6 |  4 |  5 |  4
  4 |  5 | 6 |  5 |  6 |  5
  4 |  5 | 6 |  6 |  7 |  6
  4 |  5 | 6 |  7 |  8 |  7
  4 |  5 | 6 |  8 |  9 |  8
  4 |  5 | 6 |  9 | 10 |  9
  4 |  5 | 6 | 10 | 11 | 10
  4 |  5 | 7 |  2 |  3 |  2
  4 |  5 | 7 |  3 |  4 |  3
  4 |  5 | 7 |  4 |  5 |  4
  4 |  5 | 7 |  5 |  6 |  5
  4 |  5 | 7 |  6 |  7 |  6
  4 |  5 | 7 |  7 |  8 |  7
  4 |  5 | 7 |  8 |  9 |  8
  4 |  5 | 7 |  9 | 10 |  9
  4 |  5 | 7 | 10 | 11 | 10
  4 |  5 | 8 |  2 |  3 |  2
  4 |  5 | 8 |  3 |  4 |  3
  4 |  5 | 8 |  4 |  5 |  4
  4 |  5 | 8 |  5 |  6 |  5
  4 |  5 | 8 |  6 |  7 |  6
  4 |  5 | 8 |  7 |  8 |  7
  4 |  5 | 8 |  8 |  9 |  8
  4 |  5 | 8 |  9 | 10 |  9
  4 |  5 | 8 | 10 | 11 | 10
  4 |  5 | 9 |  2 |  3 |  2
  4 |  5 | 9 |  3 |  4 |  3
  4 |  5 | 9 |  4 |  5 |  4
  4 |  5 | 9 |  5 |  6 |  5
  4 |  5 | 9 |  6 |  7 |  6
  4 |  5 | 9 |  7 |  8 |  7
  4 |  5 | 9 |  8 |  9 |  8
  4 |  5 | 9 |  9 | 10 |  9
  4 |  5 | 9 | 10 | 11 | 10
  5 |  6 | 3 |  2 |  3 |  2
  5 |  6 | 3 |  3 |  4 |  3
  5 |  6 | 3 |  4 |  5 |  4
  5 |  6 | 3 |  5 |  6 |  5
  5 |  6 | 3 |  6 |  7 |  6
  5 |  6 | 3 |  7 |  8 |  7
  5 |  6 | 3 |  8 |  9 |  8
  5 |  6 | 3 |  9 | 10 |  9
  5 |  6 | 3 | 10 | 11 | 10
  5 |  6 | 4 |  2 |  3 |  2
  5 |  6 | 4 |  3 |  4 |  3
  5 |  6 | 4 |  4 |  5 |  4
  5 |  6 | 4 |  5 |  6 |  5
  5 |  6 | 4 |  6 |  7 |  6
  5 |  6 | 4 |  7 |  8 |  7
  5 |  6 | 4 |  8 |  9 |  8
  5 |  6 | 4 |  9 | 10 |  9
  5 |  6 | 4 | 10 | 11 | 10
  5 |  6 | 5 |  2 |  3 |  2
  5 |  6 | 5 |  3 |  4 |  3
  5 |  6 | 5 |  4 |  5 |  4
  5 |  6 | 5 |  5 |  6 |  5
  5 |  6 | 5 |  6 |  7 |  6
  5 |  6 | 5 |  7 |  8 |  7
  5 |  6 | 5 |  8 |  9 |  8
  5 |  6 | 5 |  9 | 10 |  9
  5 |  6 | 5 | 10 | 11 | 10
  5 |  6 | 6 |  2 |  3 |  2
  5 |  6 | 6 |  3 |  4 |  3
  5 |  6 | 6 |  4 |  5 |  4
  5 |  6 | 6 |  5 |  6 |  5
  5 |  6 | 6 |  6 |  7 |  6
  5 |  6 | 6 |  7 |  8 |  7
  5 |  6 | 6 |  8 |  9 |  8
  5 |  6 | 6 |  9 | 10 |  9
  5 |  6 | 6 | 10 | 11 | 10
  5 |  6 | 7 |  2 |  3 |  2
  5 |  6 | 7 |  3 |  4 |  3
  5 |  6 | 7 |  4 |  5 |  4
  5 |  6 | 7 |  5 |  6 |  5
  5 |  6 | 7 |  6 |  7 |  6
  5 |  6 | 7 |  7 |  8 |  7
  5 |  6 | 7 |  8 |  9 |  8
  5 |  6 | 7 |  9 | 10 |  9
  5 |  6 | 7 | 10 | 11 | 10
  5 |  6 | 8 |  2 |  3 |  2
  5 |  6 | 8 |  3 |  4 |  3
  5 |  6 | 8 |  4 |  5 |  4
  5 |  6 | 8 |  5 |  6 |  5
  5 |  6 | 8 |  6 |  7 |  6
  5 |  6 | 8 |  7 |  8 |  7
  5 |  6 | 8 |  8 |  9 |  8
  5 |  6 | 8 |  9 | 10 |  9
  5 |  6 | 8 | 10 | 11 | 10
  5 |  6 | 9 |  2 |  3 |  2
  5 |  6 | 9 |  3 |  4 |  3
  5 |  6 | 9 |  4 |  5 |  4
  5 |  6 | 9 |  5 |  6 |  5
  5 |  6 | 9 |  6 |  7 |  6
  5 |  6 | 9 |  7 |  8 |  7
  5 |  6 | 9 |  8 |  9 |  8
  5 |  6 | 9 |  9 | 10 |  9
  5 |  6 | 9 | 10 | 11 | 10
  6 |  7 | 3 |  2 |  3 |  2
  6 |  7 | 3 |  3 |  4 |  3
  6 |  7 | 3 |  4 |  5 |  4
  6 |  7 | 3 |  5 |  6 |  5
  6 |  7 | 3 |  6 |  7 |  6
  6 |  7 | 3 |  7 |  8 |  7
  6 |  7 | 3 |  8 |  9 |  8
  6 |  7 | 3 |  9 | 10 |  9
  6 |  7 | 3 | 10 | 11 | 10
  6 |  7 | 4 |  2 |  3 |  2
  6 |  7 | 4 |  3 |  4 |  3
  6 |  7 | 4 |  4 |  5 |  4
  6 |  7 | 4 |  5 |  6 |  5
  6 |  7 | 4 |  6 |  7 |  6
  6 |  7 | 4 |  7 |  8 |  7
  6 |  7 | 4 |  8 |  9 |  8
  6 |  7 | 4 |  9 | 10 |  9
  6 |  7 | 4 | 10 | 11 | 10
  6 |  7 | 5 |  2 |  3 |  2
  6 |  7 | 5 |  3 |  4 |  3
  6 |  7 | 5 |  4 |  5 |  4
  6 |  7 | 5 |  5 |  6 |  5
  6 |  7 | 5 |  6 |  7 |  6
  6 |  7 | 5 |  7 |  8 |  7
  6 |  7 | 5 |  8 |  9 |  8
  6 |  7 | 5 |  9 | 10 |  9
  6 |  7 | 5 | 10 | 11 | 10
  6 |  7 | 6 |  2 |  3 |  2
  6 |  7 | 6 |  3 |  4 |  3
  6 |  7 | 6 |  4 |  5 |  4
  6 |  7 | 6 |  5 |  6 |  5
  6 |  7 | 6 |  6 |  7 |  6
  6 |  7 | 6 |  7 |  8 |  7
  6 |  7 | 6 |  8 |  9 |  8
  6 |  7 | 6 |  9 | 10 |  9
  6 |  7 | 6 | 10 | 11 | 10
  6 |  7 | 7 |  2 |  3 |  2
  6 |  7 | 7 |  3 |  4 |  3
  6 |  7 | 7 |  4 |  5 |  4
  6 |  7 | 7 |  5 |  6 |  5
  6 |  7 | 7 |  6 |  7 |  6
  6 |  7 | 7 |  7 |  8 |  7
  6 |  7 | 7 |  8 |  9 |  8
  6 |  7 | 7 |  9 | 10 |  9
  6 |  7 | 7 | 10 | 11 | 10
  6 |  7 | 8 |  2 |  3 |  2
  6 |  7 | 8 |  3 |  4 |  3
  6 |  7 | 8 |  4 |  5 |  4
  6 |  7 | 8 |  5 |  6 |  5
  6 |  7 | 8 |  6 |  7 |  6
  6 |  7 | 8 |  7 |  8 |  7
  6 |  7 | 8 |  8 |  9 |  8
  6 |  7 | 8 |  9 | 10 |  9
  6 |  7 | 8 | 10 | 11 | 10
  6 |  7 | 9 |  2 |  3 |  2
  6 |  7 | 9 |  3 |  4 |  3
  6 |  7 | 9 |  4 |  5 |  4
  6 |  7 | 9 |  5 |  6 |  5
  6 |  7 | 9 |  6 |  7 |  6
  6 |  7 | 9 |  7 |  8 |  7
  6 |  7 | 9 |  8 |  9 |  8
  6 |  7 | 9 |  9 | 10 |  9
  6 |  7 | 9 | 10 | 11 | 10
  7 |  8 | 3 |  2 |  3 |  2
  7 |  8 | 3 |  3 |  4 |  3
  7 |  8 | 3 |  4 |  5 |  4
  7 |  8 | 3 |  5 |  6 |  5
  7 |  8 | 3 |  6 |  7 |  6
  7 |  8 | 3 |  7 |  8 |  7
  7 |  8 | 3 |  8 |  9 |  8
  7 |  8 | 3 |  9 | 10 |  9
  7 |  8 | 3 | 10 | 11 | 10
  7 |  8 | 4 |  2 |  3 |  2
  7 |  8 | 4 |  3 |  4 |  3
  7 |  8 | 4 |  4 |  5 |  4
  7 |  8 | 4 |  5 |  6 |  5
  7 |  8 | 4 |  6 |  7 |  6
  7 |  8 | 4 |  7 |  8 |  7
  7 |  8 | 4 |  8 |  9 |  8
  7 |  8 | 4 |  9 | 10 |  9
  7 |  8 | 4 | 10 | 11 | 10
  7 |  8 | 5 |  2 |  3 |  2
  7 |  8 | 5 |  3 |  4 |  3
  7 |  8 | 5 |  4 |  5 |  4
  7 |  8 | 5 |  5 |  6 |  5
  7 |  8 | 5 |  6 |  7 |  6
  7 |  8 | 5 |  7 |  8 |  7
  7 |  8 | 5 |  8 |  9 |  8
  7 |  8 | 5 |  9 | 10 |  9
  7 |  8 | 5 | 10 | 11 | 10
  7 |  8 | 6 |  2 |  3 |  2
  7 |  8 | 6 |  3 |  4 |  3
  7 |  8 | 6 |  4 |  5 |  4
  7 |  8 | 6 |  5 |  6 |  5
  7 |  8 | 6 |  6 |  7 |  6
  7 |  8 | 6 |  7 |  8 |  7
  7 |  8 | 6 |  8 |  9 |  8
  7 |  8 | 6 |  9 | 10 |  9
  7 |  8 | 6 | 10 | 11 | 10
  7 |  8 | 7 |  2 |  3 |  2
  7 |  8 | 7 |  3 |  4 |  3
  7 |  8 | 7 |  4 |  5 |  4
  7 |  8 | 7 |  5 |  6 |  5
  7 |  8 | 7 |  6 |  7 |  6
  7 |  8 | 7 |  7 |  8 |  7
  7 |  8 | 7 |  8 |  9 |  8
  7 |  8 | 7 |  9 | 10 |  9
  7 |  8 | 7 | 10 | 11 | 10
  7 |  8 | 8 |  2 |  3 |  2
  7 |  8 | 8 |  3 |  4 |  3
  7 |  8 | 8 |  4 |  5 |  4
  7 |  8 | 8 |  5 |  6 |  5
  7 |  8 | 8 |  6 |  7 |  6
  7 |  8 | 8 |  7 |  8 |  7
  7 |  8 | 8 |  8 |  9 |  8
  7 |  8 | 8 |  9 | 10 |  9
  7 |  8 | 8 | 10 | 11 | 10
  7 |  8 | 9 |  2 |  3 |  2
  7 |  8 | 9 |  3 |  4 |  3
  7 |  8 | 9 |  4 |  5 |  4
  7 |  8 | 9 |  5 |  6 |  5
  7 |  8 | 9 |  6 |  7 |  6
  7 |  8 | 9 |  7 |  8 |  7
  7 |  8 | 9 |  8 |  9 |  8
  7 |  8 | 9 |  9 | 10 |  9
  7 |  8 | 9 | 10 | 11 | 10
  8 |  9 | 3 |  2 |  3 |  2
  8 |  9 | 3 |  3 |  4 |  3
  8 |  9 | 3 |  4 |  5 |  4
  8 |  9 | 3 |  5 |  6 |  5
  8 |  9 | 3 |  6 |  7 |  6
  8 |  9 | 3 |  7 |  8 |  7
  8 |  9 | 3 |  8 |  9 |  8
  8 |  9 | 3 |  9 | 10 |  9
  8 |  9 | 3 | 10 | 11 | 10
  8 |  9 | 4 |  2 |  3 |  2
  8 |  9 | 4 |  3 |  4 |  3
  8 |  9 | 4 |  4 |  5 |  4
  8 |  9 | 4 |  5 |  6 |  5
  8 |  9 | 4 |  6 |  7 |  6
  8 |  9 | 4 |  7 |  8 |  7
  8 |  9 | 4 |  8 |  9 |  8
  8 |  9 | 4 |  9 | 10 |  9
  8 |  9 | 4 | 10 | 11 | 10
  8 |  9 | 5 |  2 |  3 |  2
  8 |  9 | 5 |  3 |  4 |  3
  8 |  9 | 5 |  4 |  5 |  4
  8 |  9 | 5 |  5 |  6 |  5
  8 |  9 | 5 |  6 |  7 |  6
  8 |  9 | 5 |  7 |  8 |  7
  8 |  9 | 5 |  8 |  9 |  8
  8 |  9 | 5 |  9 | 10 |  9
  8 |  9 | 5 | 10 | 11 | 10
  8 |  9 | 6 |  2 |  3 |  2
  8 |  9 | 6 |  3 |  4 |  3
  8 |  9 | 6 |  4 |  5 |  4
  8 |  9 | 6 |  5 |  6 |  5
  8 |  9 | 6 |  6 |  7 |  6
  8 |  9 | 6 |  7 |  8 |  7
  8 |  9 | 6 |  8 |  9 |  8
  8 |  9 | 6 |  9 | 10 |  9
  8 |  9 | 6 | 10 | 11 | 10
  8 |  9 | 7 |  2 |  3 |  2
  8 |  9 | 7 |  3 |  4 |  3
  8 |  9 | 7 |  4 |  5 |  4
  8 |  9 | 7 |  5 |  6 |  5
  8 |  9 | 7 |  6 |  7 |  6
  8 |  9 | 7 |  7 |  8 |  7
  8 |  9 | 7 |  8 |  9 |  8
  8 |  9 | 7 |  9 | 10 |  9
  8 |  9 | 7 | 10 | 11 | 10
  8 |  9 | 8 |  2 |  3 |  2
  8 |  9 | 8 |  3 |  4 |  3
  8 |  9 | 8 |  4 |  5 |  4
  8 |  9 | 8 |  5 |  6 |  5
  8 |  9 | 8 |  6 |  7 |  6
  8 |  9 | 8 |  7 |  8 |  7
  8 |  9 | 8 |  8 |  9 |  8
  8 |  9 | 8 |  9 | 10 |  9
  8 |  9 | 8 | 10 | 11 | 10
  8 |  9 | 9 |  2 |  3 |  2
  8 |  9 | 9 |  3 |  4 |  3
  8 |  9 | 9 |  4 |  5 |  4
  8 |  9 | 9 |  5 |  6 |  5
  8 |  9 | 9 |  6 |  7 |  6
  8 |  9 | 9 |  7 |  8 |  7
  8 |  9 | 9 |  8 |  9 |  8
  8 |  9 | 9 |  9 | 10 |  9
  8 |  9 | 9 | 10 | 11 | 10
  9 | 10 | 3 |  2 |  3 |  2
  9 | 10 | 3 |  3 |  4 |  3
  9 | 10 | 3 |  4 |  5 |  4
  9 | 10 | 3 |  5 |  6 |  5
  9 | 10 | 3 |  6 |  7 |  6
  9 | 10 | 3 |  7 |  8 |  7
  9 | 10 | 3 |  8 |  9 |  8
  9 | 10 | 3 |  9 | 10 |  9
  9 | 10 | 3 | 10 | 11 | 10
  9 | 10 | 4 |  2 |  3 |  2
  9 | 10 | 4 |  3 |  4 |  3
  9 | 10 | 4 |  4 |  5 |  4
  9 | 10 | 4 |  5 |  6 |  5
  9 | 10 | 4 |  6 |  7 |  6
  9 | 10 | 4 |  7 |  8 |  7
  9 | 10 | 4 |  8 |  9 |  8
  9 | 10 | 4 |  9 | 10 |  9
  9 | 10 | 4 | 10 | 11 | 10
  9 | 10 | 5 |  2 |  3 |  2
  9 | 10 | 5 |  3 |  4 |  3
  9 | 10 | 5 |  4 |  5 |  4
  9 | 10 | 5 |  5 |  6 |  5
  9 | 10 | 5 |  6 |  7 |  6
  9 | 10 | 5 |  7 |  8 |  7
  9 | 10 | 5 |  8 |  9 |  8
  9 | 10 | 5 |  9 | 10 |  9
  9 | 10 | 5 | 10 | 11 | 10
  9 | 10 | 6 |  2 |  3 |  2
  9 | 10 | 6 |  3 |  4 |  3
  9 | 10 | 6 |  4 |  5 |  4
  9 | 10 | 6 |  5 |  6 |  5
  9 | 10 | 6 |  6 |  7 |  6
  9 | 10 | 6 |  7 |  8 |  7
  9 | 10 | 6 |  8 |  9 |  8
  9 | 10 | 6 |  9 | 10 |  9
  9 | 10 | 6 | 10 | 11 | 10
  9 | 10 | 7 |  2 |  3 |  2
  9 | 10 | 7 |  3 |  4 |  3
  9 | 10 | 7 |  4 |  5 |  4
  9 | 10 | 7 |  5 |  6 |  5
  9 | 10 | 7 |  6 |  7 |  6
  9 | 10 | 7 |  7 |  8 |  7
  9 | 10 | 7 |  8 |  9 |  8
  9 | 10 | 7 |  9 | 10 |  9
  9 | 10 | 7 | 10 | 11 | 10
  9 | 10 | 8 |  2 |  3 |  2
  9 | 10 | 8 |  3 |  4 |  3
  9 | 10 | 8 |  4 |  5 |  4
  9 | 10 | 8 |  5 |  6 |  5
  9 | 10 | 8 |  6 |  7 |  6
  9 | 10 | 8 |  7 |  8 |  7
  9 | 10 | 8 |  8 |  9 |  8
  9 | 10 | 8 |  9 | 10 |  9
  9 | 10 | 8 | 10 | 11 | 10
  9 | 10 | 9 |  2 |  3 |  2
  9 | 10 | 9 |  3 |  4 |  3
  9 | 10 | 9 |  4 |  5 |  4
  9 | 10 | 9 |  5 |  6 |  5
  9 | 10 | 9 |  6 |  7 |  6
  9 | 10 | 9 |  7 |  8 |  7
  9 | 10 | 9 |  8 |  9 |  8
  9 | 10 | 9 |  9 | 10 |  9
  9 | 10 | 9 | 10 | 11 | 10
 10 | 11 | 3 |  2 |  3 |  2
 10 | 11 | 3 |  3 |  4 |  3
 10 | 11 | 3 |  4 |  5 |  4
 10 | 11 | 3 |  5 |  6 |  5
 10 | 11 | 3 |  6 |  7 |  6
 10 | 11 | 3 |  7 |  8 |  7
 10 | 11 | 3 |  8 |  9 |  8
 10 | 11 | 3 |  9 | 10 |  9
 10 | 11 | 3 | 10 | 11 | 10
 10 | 11 | 4 |  2 |  3 |  2
 10 | 11 | 4 |  3 |  4 |  3
 10 | 11 | 4 |  4 |  5 |  4
 10 | 11 | 4 |  5 |  6 |  5
 10 | 11 | 4 |  6 |  7 |  6
 10 | 11 | 4 |  7 |  8 |  7
 10 | 11 | 4 |  8 |  9 |  8
 10 | 11 | 4 |  9 | 10 |  9
 10 | 11 | 4 | 10 | 11 | 10
 10 | 11 | 5 |  2 |  3 |  2
 10 | 11 | 5 |  3 |  4 |  3
 10 | 11 | 5 |  4 |  5 |  4
 10 | 11 | 5 |  5 |  6 |  5
 10 | 11 | 5 |  6 |  7 |  6
 10 | 11 | 5 |  7 |  8 |  7
 10 | 11 | 5 |  8 |  9 |  8
 10 | 11 | 5 |  9 | 10 |  9
 10 | 11 | 5 | 10 | 11 | 10
 10 | 11 | 6 |  2 |  3 |  2
 10 | 11 | 6 |  3 |  4 |  3
 10 | 11 | 6 |  4 |  5 |  4
 10 | 11 | 6 |  5 |  6 |  5
 10 | 11 | 6 |  6 |  7 |  6
 10 | 11 | 6 |  7 |  8 |  7
 10 | 11 | 6 |  8 |  9 |  8
 10 | 11 | 6 |  9 | 10 |  9
 10 | 11 | 6 | 10 | 11 | 10
 10 | 11 | 7 |  2 |  3 |  2
 10 | 11 | 7 |  3 |  4 |  3
 10 | 11 | 7 |  4 |  5 |  4
 10 | 11 | 7 |  5 |  6 |  5
 10 | 11 | 7 |  6 |  7 |  6
 10 | 11 | 7 |  7 |  8 |  7
 10 | 11 | 7 |  8 |  9 |  8
 10 | 11 | 7 |  9 | 10 |  9
 10 | 11 | 7 | 10 | 11 | 10
 10 | 11 | 8 |  2 |  3 |  2
 10 | 11 | 8 |  3 |  4 |  3
 10 | 11 | 8 |  4 |  5 |  4
 10 | 11 | 8 |  5 |  6 |  5
 10 | 11 | 8 |  6 |  7 |  6
 10 | 11 | 8 |  7 |  8 |  7
 10 | 11 | 8 |  8 |  9 |  8
 10 | 11 | 8 |  9 | 10 |  9
 10 | 11 | 8 | 10 | 11 | 10
 10 | 11 | 9 |  2 |  3 |  2
 10 | 11 | 9 |  3 |  4 |  3
 10 | 11 | 9 |  4 |  5 |  4
 10 | 11 | 9 |  5 |  6 |  5
 10 | 11 | 9 |  6 |  7 |  6
 10 | 11 | 9 |  7 |  8 |  7
 10 | 11 | 9 |  8 |  9 |  8
 10 | 11 | 9 |  9 | 10 |  9
 10 | 11 | 9 | 10 | 11 | 10
(630 rows)

--
-- Test for wrong results in window functions under joins #2
--
select * from (
SELECT cup.*, SUM(t.d) OVER(PARTITION BY t.b) FROM (
	SELECT bfv_joins_bar.*, AVG(t.b) OVER(PARTITION BY t.a ORDER BY t.b desc) AS e FROM t,bfv_joins_bar
) AS cup,
t WHERE cup.e < 10
GROUP BY cup.c,cup.d, cup.e ,t.d, t.b) i
order by 1, 2, 3, 4;
 c  | d  | e | sum 
----+----+---+-----
  1 |  2 | 3 | 140
  1 |  2 | 3 | 210
  1 |  2 | 3 | 280
  1 |  2 | 3 | 350
  1 |  2 | 3 | 420
  1 |  2 | 3 | 490
  1 |  2 | 3 | 560
  1 |  2 | 3 | 630
  1 |  2 | 3 | 700
  1 |  2 | 4 | 140
  1 |  2 | 4 | 210
  1 |  2 | 4 | 280
  1 |  2 | 4 | 350
  1 |  2 | 4 | 420
  1 |  2 | 4 | 490
  1 |  2 | 4 | 560
  1 |  2 | 4 | 630
  1 |  2 | 4 | 700
  1 |  2 | 5 | 140
  1 |  2 | 5 | 210
  1 |  2 | 5 | 280
  1 |  2 | 5 | 350
  1 |  2 | 5 | 420
  1 |  2 | 5 | 490
  1 |  2 | 5 | 560
  1 |  2 | 5 | 630
  1 |  2 | 5 | 700
  1 |  2 | 6 | 140
  1 |  2 | 6 | 210
  1 |  2 | 6 | 280
  1 |  2 | 6 | 350
  1 |  2 | 6 | 420
  1 |  2 | 6 | 490
  1 |  2 | 6 | 560
  1 |  2 | 6 | 630
  1 |  2 | 6 | 700
  1 |  2 | 7 | 140
  1 |  2 | 7 | 210
  1 |  2 | 7 | 280
  1 |  2 | 7 | 350
  1 |  2 | 7 | 420
  1 |  2 | 7 | 490
  1 |  2 | 7 | 560
  1 |  2 | 7 | 630
  1 |  2 | 7 | 700
  1 |  2 | 8 | 140
  1 |  2 | 8 | 210
  1 |  2 | 8 | 280
  1 |  2 | 8 | 350
  1 |  2 | 8 | 420
  1 |  2 | 8 | 490
  1 |  2 | 8 | 560
  1 |  2 | 8 | 630
  1 |  2 | 8 | 700
  1 |  2 | 9 | 140
  1 |  2 | 9 | 210
  1 |  2 | 9 | 280
  1 |  2 | 9 | 350
  1 |  2 | 9 | 420
  1 |  2 | 9 | 490
  1 |  2 | 9 | 560
  1 |  2 | 9 | 630
  1 |  2 | 9 | 700
  2 |  3 | 3 | 140
  2 |  3 | 3 | 210
  2 |  3 | 3 | 280
  2 |  3 | 3 | 350
  2 |  3 | 3 | 420
  2 |  3 | 3 | 490
  2 |  3 | 3 | 560
  2 |  3 | 3 | 630
  2 |  3 | 3 | 700
  2 |  3 | 4 | 140
  2 |  3 | 4 | 210
  2 |  3 | 4 | 280
  2 |  3 | 4 | 350
  2 |  3 | 4 | 420
  2 |  3 | 4 | 490
  2 |  3 | 4 | 560
  2 |  3 | 4 | 630
  2 |  3 | 4 | 700
  2 |  3 | 5 | 140
  2 |  3 | 5 | 210
  2 |  3 | 5 | 280
  2 |  3 | 5 | 350
  2 |  3 | 5 | 420
  2 |  3 | 5 | 490
  2 |  3 | 5 | 560
  2 |  3 | 5 | 630
  2 |  3 | 5 | 700
  2 |  3 | 6 | 140
  2 |  3 | 6 | 210
  2 |  3 | 6 | 280
  2 |  3 | 6 | 350
  2 |  3 | 6 | 420
  2 |  3 | 6 | 490
  2 |  3 | 6 | 560
  2 |  3 | 6 | 630
  2 |  3 | 6 | 700
  2 |  3 | 7 | 140
  2 |  3 | 7 | 210
  2 |  3 | 7 | 280
  2 |  3 | 7 | 350
  2 |  3 | 7 | 420
  2 |  3 | 7 | 490
  2 |  3 | 7 | 560
  2 |  3 | 7 | 630
  2 |  3 | 7 | 700
  2 |  3 | 8 | 140
  2 |  3 | 8 | 210
  2 |  3 | 8 | 280
  2 |  3 | 8 | 350
  2 |  3 | 8 | 420
  2 |  3 | 8 | 490
  2 |  3 | 8 | 560
  2 |  3 | 8 | 630
  2 |  3 | 8 | 700
  2 |  3 | 9 | 140
  2 |  3 | 9 | 210
  2 |  3 | 9 | 280
  2 |  3 | 9 | 350
  2 |  3 | 9 | 420
  2 |  3 | 9 | 490
  2 |  3 | 9 | 560
  2 |  3 | 9 | 630
  2 |  3 | 9 | 700
  3 |  4 | 3 | 140
  3 |  4 | 3 | 210
  3 |  4 | 3 | 280
  3 |  4 | 3 | 350
  3 |  4 | 3 | 420
  3 |  4 | 3 | 490
  3 |  4 | 3 | 560
  3 |  4 | 3 | 630
  3 |  4 | 3 | 700
  3 |  4 | 4 | 140
  3 |  4 | 4 | 210
  3 |  4 | 4 | 280
  3 |  4 | 4 | 350
  3 |  4 | 4 | 420
  3 |  4 | 4 | 490
  3 |  4 | 4 | 560
  3 |  4 | 4 | 630
  3 |  4 | 4 | 700
  3 |  4 | 5 | 140
  3 |  4 | 5 | 210
  3 |  4 | 5 | 280
  3 |  4 | 5 | 350
  3 |  4 | 5 | 420
  3 |  4 | 5 | 490
  3 |  4 | 5 | 560
  3 |  4 | 5 | 630
  3 |  4 | 5 | 700
  3 |  4 | 6 | 140
  3 |  4 | 6 | 210
  3 |  4 | 6 | 280
  3 |  4 | 6 | 350
  3 |  4 | 6 | 420
  3 |  4 | 6 | 490
  3 |  4 | 6 | 560
  3 |  4 | 6 | 630
  3 |  4 | 6 | 700
  3 |  4 | 7 | 140
  3 |  4 | 7 | 210
  3 |  4 | 7 | 280
  3 |  4 | 7 | 350
  3 |  4 | 7 | 420
  3 |  4 | 7 | 490
  3 |  4 | 7 | 560
  3 |  4 | 7 | 630
  3 |  4 | 7 | 700
  3 |  4 | 8 | 140
  3 |  4 | 8 | 210
  3 |  4 | 8 | 280
  3 |  4 | 8 | 350
  3 |  4 | 8 | 420
  3 |  4 | 8 | 490
  3 |  4 | 8 | 560
  3 |  4 | 8 | 630
  3 |  4 | 8 | 700
  3 |  4 | 9 | 140
  3 |  4 | 9 | 210
  3 |  4 | 9 | 280
  3 |  4 | 9 | 350
  3 |  4 | 9 | 420
  3 |  4 | 9 | 490
  3 |  4 | 9 | 560
  3 |  4 | 9 | 630
  3 |  4 | 9 | 700
  4 |  5 | 3 | 140
  4 |  5 | 3 | 210
  4 |  5 | 3 | 280
  4 |  5 | 3 | 350
  4 |  5 | 3 | 420
  4 |  5 | 3 | 490
  4 |  5 | 3 | 560
  4 |  5 | 3 | 630
  4 |  5 | 3 | 700
  4 |  5 | 4 | 140
  4 |  5 | 4 | 210
  4 |  5 | 4 | 280
  4 |  5 | 4 | 350
  4 |  5 | 4 | 420
  4 |  5 | 4 | 490
  4 |  5 | 4 | 560
  4 |  5 | 4 | 630
  4 |  5 | 4 | 700
  4 |  5 | 5 | 140
  4 |  5 | 5 | 210
  4 |  5 | 5 | 280
  4 |  5 | 5 | 350
  4 |  5 | 5 | 420
  4 |  5 | 5 | 490
  4 |  5 | 5 | 560
  4 |  5 | 5 | 630
  4 |  5 | 5 | 700
  4 |  5 | 6 | 140
  4 |  5 | 6 | 210
  4 |  5 | 6 | 280
  4 |  5 | 6 | 350
  4 |  5 | 6 | 420
  4 |  5 | 6 | 490
  4 |  5 | 6 | 560
  4 |  5 | 6 | 630
  4 |  5 | 6 | 700
  4 |  5 | 7 | 140
  4 |  5 | 7 | 210
  4 |  5 | 7 | 280
  4 |  5 | 7 | 350
  4 |  5 | 7 | 420
  4 |  5 | 7 | 490
  4 |  5 | 7 | 560
  4 |  5 | 7 | 630
  4 |  5 | 7 | 700
  4 |  5 | 8 | 140
  4 |  5 | 8 | 210
  4 |  5 | 8 | 280
  4 |  5 | 8 | 350
  4 |  5 | 8 | 420
  4 |  5 | 8 | 490
  4 |  5 | 8 | 560
  4 |  5 | 8 | 630
  4 |  5 | 8 | 700
  4 |  5 | 9 | 140
  4 |  5 | 9 | 210
  4 |  5 | 9 | 280
  4 |  5 | 9 | 350
  4 |  5 | 9 | 420
  4 |  5 | 9 | 490
  4 |  5 | 9 | 560
  4 |  5 | 9 | 630
  4 |  5 | 9 | 700
  5 |  6 | 3 | 140
  5 |  6 | 3 | 210
  5 |  6 | 3 | 280
  5 |  6 | 3 | 350
  5 |  6 | 3 | 420
  5 |  6 | 3 | 490
  5 |  6 | 3 | 560
  5 |  6 | 3 | 630
  5 |  6 | 3 | 700
  5 |  6 | 4 | 140
  5 |  6 | 4 | 210
  5 |  6 | 4 | 280
  5 |  6 | 4 | 350
  5 |  6 | 4 | 420
  5 |  6 | 4 | 490
  5 |  6 | 4 | 560
  5 |  6 | 4 | 630
  5 |  6 | 4 | 700
  5 |  6 | 5 | 140
  5 |  6 | 5 | 210
  5 |  6 | 5 | 280
  5 |  6 | 5 | 350
  5 |  6 | 5 | 420
  5 |  6 | 5 | 490
  5 |  6 | 5 | 560
  5 |  6 | 5 | 630
  5 |  6 | 5 | 700
  5 |  6 | 6 | 140
  5 |  6 | 6 | 210
  5 |  6 | 6 | 280
  5 |  6 | 6 | 350
  5 |  6 | 6 | 420
  5 |  6 | 6 | 490
  5 |  6 | 6 | 560
  5 |  6 | 6 | 630
  5 |  6 | 6 | 700
  5 |  6 | 7 | 140
  5 |  6 | 7 | 210
  5 |  6 | 7 | 280
  5 |  6 | 7 | 350
  5 |  6 | 7 | 420
  5 |  6 | 7 | 490
  5 |  6 | 7 | 560
  5 |  6 | 7 | 630
  5 |  6 | 7 | 700
  5 |  6 | 8 | 140
  5 |  6 | 8 | 210
  5 |  6 | 8 | 280
  5 |  6 | 8 | 350
  5 |  6 | 8 | 420
  5 |  6 | 8 | 490
  5 |  6 | 8 | 560
  5 |  6 | 8 | 630
  5 |  6 | 8 | 700
  5 |  6 | 9 | 140
  5 |  6 | 9 | 210
  5 |  6 | 9 | 280
  5 |  6 | 9 | 350
  5 |  6 | 9 | 420
  5 |  6 | 9 | 490
  5 |  6 | 9 | 560
  5 |  6 | 9 | 630
  5 |  6 | 9 | 700
  6 |  7 | 3 | 140
  6 |  7 | 3 | 210
  6 |  7 | 3 | 280
  6 |  7 | 3 | 350
  6 |  7 | 3 | 420
  6 |  7 | 3 | 490
  6 |  7 | 3 | 560
  6 |  7 | 3 | 630
  6 |  7 | 3 | 700
  6 |  7 | 4 | 140
  6 |  7 | 4 | 210
  6 |  7 | 4 | 280
  6 |  7 | 4 | 350
  6 |  7 | 4 | 420
  6 |  7 | 4 | 490
  6 |  7 | 4 | 560
  6 |  7 | 4 | 630
  6 |  7 | 4 | 700
  6 |  7 | 5 | 140
  6 |  7 | 5 | 210
  6 |  7 | 5 | 280
  6 |  7 | 5 | 350
  6 |  7 | 5 | 420
  6 |  7 | 5 | 490
  6 |  7 | 5 | 560
  6 |  7 | 5 | 630
  6 |  7 | 5 | 700
  6 |  7 | 6 | 140
  6 |  7 | 6 | 210
  6 |  7 | 6 | 280
  6 |  7 | 6 | 350
  6 |  7 | 6 | 420
  6 |  7 | 6 | 490
  6 |  7 | 6 | 560
  6 |  7 | 6 | 630
  6 |  7 | 6 | 700
  6 |  7 | 7 | 140
  6 |  7 | 7 | 210
  6 |  7 | 7 | 280
  6 |  7 | 7 | 350
  6 |  7 | 7 | 420
  6 |  7 | 7 | 490
  6 |  7 | 7 | 560
  6 |  7 | 7 | 630
  6 |  7 | 7 | 700
  6 |  7 | 8 | 140
  6 |  7 | 8 | 210
  6 |  7 | 8 | 280
  6 |  7 | 8 | 350
  6 |  7 | 8 | 420
  6 |  7 | 8 | 490
  6 |  7 | 8 | 560
  6 |  7 | 8 | 630
  6 |  7 | 8 | 700
  6 |  7 | 9 | 140
  6 |  7 | 9 | 210
  6 |  7 | 9 | 280
  6 |  7 | 9 | 350
  6 |  7 | 9 | 420
  6 |  7 | 9 | 490
  6 |  7 | 9 | 560
  6 |  7 | 9 | 630
  6 |  7 | 9 | 700
  7 |  8 | 3 | 140
  7 |  8 | 3 | 210
  7 |  8 | 3 | 280
  7 |  8 | 3 | 350
  7 |  8 | 3 | 420
  7 |  8 | 3 | 490
  7 |  8 | 3 | 560
  7 |  8 | 3 | 630
  7 |  8 | 3 | 700
  7 |  8 | 4 | 140
  7 |  8 | 4 | 210
  7 |  8 | 4 | 280
  7 |  8 | 4 | 350
  7 |  8 | 4 | 420
  7 |  8 | 4 | 490
  7 |  8 | 4 | 560
  7 |  8 | 4 | 630
  7 |  8 | 4 | 700
  7 |  8 | 5 | 140
  7 |  8 | 5 | 210
  7 |  8 | 5 | 280
  7 |  8 | 5 | 350
  7 |  8 | 5 | 420
  7 |  8 | 5 | 490
  7 |  8 | 5 | 560
  7 |  8 | 5 | 630
  7 |  8 | 5 | 700
  7 |  8 | 6 | 140
  7 |  8 | 6 | 210
  7 |  8 | 6 | 280
  7 |  8 | 6 | 350
  7 |  8 | 6 | 420
  7 |  8 | 6 | 490
  7 |  8 | 6 | 560
  7 |  8 | 6 | 630
  7 |  8 | 6 | 700
  7 |  8 | 7 | 140
  7 |  8 | 7 | 210
  7 |  8 | 7 | 280
  7 |  8 | 7 | 350
  7 |  8 | 7 | 420
  7 |  8 | 7 | 490
  7 |  8 | 7 | 560
  7 |  8 | 7 | 630
  7 |  8 | 7 | 700
  7 |  8 | 8 | 140
  7 |  8 | 8 | 210
  7 |  8 | 8 | 280
  7 |  8 | 8 | 350
  7 |  8 | 8 | 420
  7 |  8 | 8 | 490
  7 |  8 | 8 | 560
  7 |  8 | 8 | 630
  7 |  8 | 8 | 700
  7 |  8 | 9 | 140
  7 |  8 | 9 | 210
  7 |  8 | 9 | 280
  7 |  8 | 9 | 350
  7 |  8 | 9 | 420
  7 |  8 | 9 | 490
  7 |  8 | 9 | 560
  7 |  8 | 9 | 630
  7 |  8 | 9 | 700
  8 |  9 | 3 | 140
  8 |  9 | 3 | 210
  8 |  9 | 3 | 280
  8 |  9 | 3 | 350
  8 |  9 | 3 | 420
  8 |  9 | 3 | 490
  8 |  9 | 3 | 560
  8 |  9 | 3 | 630
  8 |  9 | 3 | 700
  8 |  9 | 4 | 140
  8 |  9 | 4 | 210
  8 |  9 | 4 | 280
  8 |  9 | 4 | 350
  8 |  9 | 4 | 420
  8 |  9 | 4 | 490
  8 |  9 | 4 | 560
  8 |  9 | 4 | 630
  8 |  9 | 4 | 700
  8 |  9 | 5 | 140
  8 |  9 | 5 | 210
  8 |  9 | 5 | 280
  8 |  9 | 5 | 350
  8 |  9 | 5 | 420
  8 |  9 | 5 | 490
  8 |  9 | 5 | 560
  8 |  9 | 5 | 630
  8 |  9 | 5 | 700
  8 |  9 | 6 | 140
  8 |  9 | 6 | 210
  8 |  9 | 6 | 280
  8 |  9 | 6 | 350
  8 |  9 | 6 | 420
  8 |  9 | 6 | 490
  8 |  9 | 6 | 560
  8 |  9 | 6 | 630
  8 |  9 | 6 | 700
  8 |  9 | 7 | 140
  8 |  9 | 7 | 210
  8 |  9 | 7 | 280
  8 |  9 | 7 | 350
  8 |  9 | 7 | 420
  8 |  9 | 7 | 490
  8 |  9 | 7 | 560
  8 |  9 | 7 | 630
  8 |  9 | 7 | 700
  8 |  9 | 8 | 140
  8 |  9 | 8 | 210
  8 |  9 | 8 | 280
  8 |  9 | 8 | 350
  8 |  9 | 8 | 420
  8 |  9 | 8 | 490
  8 |  9 | 8 | 560
  8 |  9 | 8 | 630
  8 |  9 | 8 | 700
  8 |  9 | 9 | 140
  8 |  9 | 9 | 210
  8 |  9 | 9 | 280
  8 |  9 | 9 | 350
  8 |  9 | 9 | 420
  8 |  9 | 9 | 490
  8 |  9 | 9 | 560
  8 |  9 | 9 | 630
  8 |  9 | 9 | 700
  9 | 10 | 3 | 140
  9 | 10 | 3 | 210
  9 | 10 | 3 | 280
  9 | 10 | 3 | 350
  9 | 10 | 3 | 420
  9 | 10 | 3 | 490
  9 | 10 | 3 | 560
  9 | 10 | 3 | 630
  9 | 10 | 3 | 700
  9 | 10 | 4 | 140
  9 | 10 | 4 | 210
  9 | 10 | 4 | 280
  9 | 10 | 4 | 350
  9 | 10 | 4 | 420
  9 | 10 | 4 | 490
  9 | 10 | 4 | 560
  9 | 10 | 4 | 630
  9 | 10 | 4 | 700
  9 | 10 | 5 | 140
  9 | 10 | 5 | 210
  9 | 10 | 5 | 280
  9 | 10 | 5 | 350
  9 | 10 | 5 | 420
  9 | 10 | 5 | 490
  9 | 10 | 5 | 560
  9 | 10 | 5 | 630
  9 | 10 | 5 | 700
  9 | 10 | 6 | 140
  9 | 10 | 6 | 210
  9 | 10 | 6 | 280
  9 | 10 | 6 | 350
  9 | 10 | 6 | 420
  9 | 10 | 6 | 490
  9 | 10 | 6 | 560
  9 | 10 | 6 | 630
  9 | 10 | 6 | 700
  9 | 10 | 7 | 140
  9 | 10 | 7 | 210
  9 | 10 | 7 | 280
  9 | 10 | 7 | 350
  9 | 10 | 7 | 420
  9 | 10 | 7 | 490
  9 | 10 | 7 | 560
  9 | 10 | 7 | 630
  9 | 10 | 7 | 700
  9 | 10 | 8 | 140
  9 | 10 | 8 | 210
  9 | 10 | 8 | 280
  9 | 10 | 8 | 350
  9 | 10 | 8 | 420
  9 | 10 | 8 | 490
  9 | 10 | 8 | 560
  9 | 10 | 8 | 630
  9 | 10 | 8 | 700
  9 | 10 | 9 | 140
  9 | 10 | 9 | 210
  9 | 10 | 9 | 280
  9 | 10 | 9 | 350
  9 | 10 | 9 | 420
  9 | 10 | 9 | 490
  9 | 10 | 9 | 560
  9 | 10 | 9 | 630
  9 | 10 | 9 | 700
 10 | 11 | 3 | 140
 10 | 11 | 3 | 210
 10 | 11 | 3 | 280
 10 | 11 | 3 | 350
 10 | 11 | 3 | 420
 10 | 11 | 3 | 490
 10 | 11 | 3 | 560
 10 | 11 | 3 | 630
 10 | 11 | 3 | 700
 10 | 11 | 4 | 140
 10 | 11 | 4 | 210
 10 | 11 | 4 | 280
 10 | 11 | 4 | 350
 10 | 11 | 4 | 420
 10 | 11 | 4 | 490
 10 | 11 | 4 | 560
 10 | 11 | 4 | 630
 10 | 11 | 4 | 700
 10 | 11 | 5 | 140
 10 | 11 | 5 | 210
 10 | 11 | 5 | 280
 10 | 11 | 5 | 350
 10 | 11 | 5 | 420
 10 | 11 | 5 | 490
 10 | 11 | 5 | 560
 10 | 11 | 5 | 630
 10 | 11 | 5 | 700
 10 | 11 | 6 | 140
 10 | 11 | 6 | 210
 10 | 11 | 6 | 280
 10 | 11 | 6 | 350
 10 | 11 | 6 | 420
 10 | 11 | 6 | 490
 10 | 11 | 6 | 560
 10 | 11 | 6 | 630
 10 | 11 | 6 | 700
 10 | 11 | 7 | 140
 10 | 11 | 7 | 210
 10 | 11 | 7 | 280
 10 | 11 | 7 | 350
 10 | 11 | 7 | 420
 10 | 11 | 7 | 490
 10 | 11 | 7 | 560
 10 | 11 | 7 | 630
 10 | 11 | 7 | 700
 10 | 11 | 8 | 140
 10 | 11 | 8 | 210
 10 | 11 | 8 | 280
 10 | 11 | 8 | 350
 10 | 11 | 8 | 420
 10 | 11 | 8 | 490
 10 | 11 | 8 | 560
 10 | 11 | 8 | 630
 10 | 11 | 8 | 700
 10 | 11 | 9 | 140
 10 | 11 | 9 | 210
 10 | 11 | 9 | 280
 10 | 11 | 9 | 350
 10 | 11 | 9 | 420
 10 | 11 | 9 | 490
 10 | 11 | 9 | 560
 10 | 11 | 9 | 630
 10 | 11 | 9 | 700
(630 rows)

--
-- Test for wrong results in window functions under joins #3
--
select * from (
WITH t(a,b,d) as (SELECT bfv_joins_foo.a,bfv_joins_foo.b,bfv_joins_bar.d FROM bfv_joins_foo,bfv_joins_bar WHERE bfv_joins_foo.a = bfv_joins_bar.d )
SELECT cup.*, SUM(t.d) OVER(PARTITION BY t.b) FROM (
	SELECT bfv_joins_bar.*, AVG(t.b) OVER(PARTITION BY t.a ORDER BY t.b desc) AS e FROM t,bfv_joins_bar
) as cup,
t WHERE cup.e < 10
GROUP BY cup.c,cup.d, cup.e ,t.d,t.b) i
order by 1, 2, 3, 4;
 c  | d  | e | sum 
----+----+---+-----
  1 |  2 | 3 | 140
  1 |  2 | 3 | 210
  1 |  2 | 3 | 280
  1 |  2 | 3 | 350
  1 |  2 | 3 | 420
  1 |  2 | 3 | 490
  1 |  2 | 3 | 560
  1 |  2 | 3 | 630
  1 |  2 | 3 | 700
  1 |  2 | 4 | 140
  1 |  2 | 4 | 210
  1 |  2 | 4 | 280
  1 |  2 | 4 | 350
  1 |  2 | 4 | 420
  1 |  2 | 4 | 490
  1 |  2 | 4 | 560
  1 |  2 | 4 | 630
  1 |  2 | 4 | 700
  1 |  2 | 5 | 140
  1 |  2 | 5 | 210
  1 |  2 | 5 | 280
  1 |  2 | 5 | 350
  1 |  2 | 5 | 420
  1 |  2 | 5 | 490
  1 |  2 | 5 | 560
  1 |  2 | 5 | 630
  1 |  2 | 5 | 700
  1 |  2 | 6 | 140
  1 |  2 | 6 | 210
  1 |  2 | 6 | 280
  1 |  2 | 6 | 350
  1 |  2 | 6 | 420
  1 |  2 | 6 | 490
  1 |  2 | 6 | 560
  1 |  2 | 6 | 630
  1 |  2 | 6 | 700
  1 |  2 | 7 | 140
  1 |  2 | 7 | 210
  1 |  2 | 7 | 280
  1 |  2 | 7 | 350
  1 |  2 | 7 | 420
  1 |  2 | 7 | 490
  1 |  2 | 7 | 560
  1 |  2 | 7 | 630
  1 |  2 | 7 | 700
  1 |  2 | 8 | 140
  1 |  2 | 8 | 210
  1 |  2 | 8 | 280
  1 |  2 | 8 | 350
  1 |  2 | 8 | 420
  1 |  2 | 8 | 490
  1 |  2 | 8 | 560
  1 |  2 | 8 | 630
  1 |  2 | 8 | 700
  1 |  2 | 9 | 140
  1 |  2 | 9 | 210
  1 |  2 | 9 | 280
  1 |  2 | 9 | 350
  1 |  2 | 9 | 420
  1 |  2 | 9 | 490
  1 |  2 | 9 | 560
  1 |  2 | 9 | 630
  1 |  2 | 9 | 700
  2 |  3 | 3 | 140
  2 |  3 | 3 | 210
  2 |  3 | 3 | 280
  2 |  3 | 3 | 350
  2 |  3 | 3 | 420
  2 |  3 | 3 | 490
  2 |  3 | 3 | 560
  2 |  3 | 3 | 630
  2 |  3 | 3 | 700
  2 |  3 | 4 | 140
  2 |  3 | 4 | 210
  2 |  3 | 4 | 280
  2 |  3 | 4 | 350
  2 |  3 | 4 | 420
  2 |  3 | 4 | 490
  2 |  3 | 4 | 560
  2 |  3 | 4 | 630
  2 |  3 | 4 | 700
  2 |  3 | 5 | 140
  2 |  3 | 5 | 210
  2 |  3 | 5 | 280
  2 |  3 | 5 | 350
  2 |  3 | 5 | 420
  2 |  3 | 5 | 490
  2 |  3 | 5 | 560
  2 |  3 | 5 | 630
  2 |  3 | 5 | 700
  2 |  3 | 6 | 140
  2 |  3 | 6 | 210
  2 |  3 | 6 | 280
  2 |  3 | 6 | 350
  2 |  3 | 6 | 420
  2 |  3 | 6 | 490
  2 |  3 | 6 | 560
  2 |  3 | 6 | 630
  2 |  3 | 6 | 700
  2 |  3 | 7 | 140
  2 |  3 | 7 | 210
  2 |  3 | 7 | 280
  2 |  3 | 7 | 350
  2 |  3 | 7 | 420
  2 |  3 | 7 | 490
  2 |  3 | 7 | 560
  2 |  3 | 7 | 630
  2 |  3 | 7 | 700
  2 |  3 | 8 | 140
  2 |  3 | 8 | 210
  2 |  3 | 8 | 280
  2 |  3 | 8 | 350
  2 |  3 | 8 | 420
  2 |  3 | 8 | 490
  2 |  3 | 8 | 560
  2 |  3 | 8 | 630
  2 |  3 | 8 | 700
  2 |  3 | 9 | 140
  2 |  3 | 9 | 210
  2 |  3 | 9 | 280
  2 |  3 | 9 | 350
  2 |  3 | 9 | 420
  2 |  3 | 9 | 490
  2 |  3 | 9 | 560
  2 |  3 | 9 | 630
  2 |  3 | 9 | 700
  3 |  4 | 3 | 140
  3 |  4 | 3 | 210
  3 |  4 | 3 | 280
  3 |  4 | 3 | 350
  3 |  4 | 3 | 420
  3 |  4 | 3 | 490
  3 |  4 | 3 | 560
  3 |  4 | 3 | 630
  3 |  4 | 3 | 700
  3 |  4 | 4 | 140
  3 |  4 | 4 | 210
  3 |  4 | 4 | 280
  3 |  4 | 4 | 350
  3 |  4 | 4 | 420
  3 |  4 | 4 | 490
  3 |  4 | 4 | 560
  3 |  4 | 4 | 630
  3 |  4 | 4 | 700
  3 |  4 | 5 | 140
  3 |  4 | 5 | 210
  3 |  4 | 5 | 280
  3 |  4 | 5 | 350
  3 |  4 | 5 | 420
  3 |  4 | 5 | 490
  3 |  4 | 5 | 560
  3 |  4 | 5 | 630
  3 |  4 | 5 | 700
  3 |  4 | 6 | 140
  3 |  4 | 6 | 210
  3 |  4 | 6 | 280
  3 |  4 | 6 | 350
  3 |  4 | 6 | 420
  3 |  4 | 6 | 490
  3 |  4 | 6 | 560
  3 |  4 | 6 | 630
  3 |  4 | 6 | 700
  3 |  4 | 7 | 140
  3 |  4 | 7 | 210
  3 |  4 | 7 | 280
  3 |  4 | 7 | 350
  3 |  4 | 7 | 420
  3 |  4 | 7 | 490
  3 |  4 | 7 | 560
  3 |  4 | 7 | 630
  3 |  4 | 7 | 700
  3 |  4 | 8 | 140
  3 |  4 | 8 | 210
  3 |  4 | 8 | 280
  3 |  4 | 8 | 350
  3 |  4 | 8 | 420
  3 |  4 | 8 | 490
  3 |  4 | 8 | 560
  3 |  4 | 8 | 630
  3 |  4 | 8 | 700
  3 |  4 | 9 | 140
  3 |  4 | 9 | 210
  3 |  4 | 9 | 280
  3 |  4 | 9 | 350
  3 |  4 | 9 | 420
  3 |  4 | 9 | 490
  3 |  4 | 9 | 560
  3 |  4 | 9 | 630
  3 |  4 | 9 | 700
  4 |  5 | 3 | 140
  4 |  5 | 3 | 210
  4 |  5 | 3 | 280
  4 |  5 | 3 | 350
  4 |  5 | 3 | 420
  4 |  5 | 3 | 490
  4 |  5 | 3 | 560
  4 |  5 | 3 | 630
  4 |  5 | 3 | 700
  4 |  5 | 4 | 140
  4 |  5 | 4 | 210
  4 |  5 | 4 | 280
  4 |  5 | 4 | 350
  4 |  5 | 4 | 420
  4 |  5 | 4 | 490
  4 |  5 | 4 | 560
  4 |  5 | 4 | 630
  4 |  5 | 4 | 700
  4 |  5 | 5 | 140
  4 |  5 | 5 | 210
  4 |  5 | 5 | 280
  4 |  5 | 5 | 350
  4 |  5 | 5 | 420
  4 |  5 | 5 | 490
  4 |  5 | 5 | 560
  4 |  5 | 5 | 630
  4 |  5 | 5 | 700
  4 |  5 | 6 | 140
  4 |  5 | 6 | 210
  4 |  5 | 6 | 280
  4 |  5 | 6 | 350
  4 |  5 | 6 | 420
  4 |  5 | 6 | 490
  4 |  5 | 6 | 560
  4 |  5 | 6 | 630
  4 |  5 | 6 | 700
  4 |  5 | 7 | 140
  4 |  5 | 7 | 210
  4 |  5 | 7 | 280
  4 |  5 | 7 | 350
  4 |  5 | 7 | 420
  4 |  5 | 7 | 490
  4 |  5 | 7 | 560
  4 |  5 | 7 | 630
  4 |  5 | 7 | 700
  4 |  5 | 8 | 140
  4 |  5 | 8 | 210
  4 |  5 | 8 | 280
  4 |  5 | 8 | 350
  4 |  5 | 8 | 420
  4 |  5 | 8 | 490
  4 |  5 | 8 | 560
  4 |  5 | 8 | 630
  4 |  5 | 8 | 700
  4 |  5 | 9 | 140
  4 |  5 | 9 | 210
  4 |  5 | 9 | 280
  4 |  5 | 9 | 350
  4 |  5 | 9 | 420
  4 |  5 | 9 | 490
  4 |  5 | 9 | 560
  4 |  5 | 9 | 630
  4 |  5 | 9 | 700
  5 |  6 | 3 | 140
  5 |  6 | 3 | 210
  5 |  6 | 3 | 280
  5 |  6 | 3 | 350
  5 |  6 | 3 | 420
  5 |  6 | 3 | 490
  5 |  6 | 3 | 560
  5 |  6 | 3 | 630
  5 |  6 | 3 | 700
  5 |  6 | 4 | 140
  5 |  6 | 4 | 210
  5 |  6 | 4 | 280
  5 |  6 | 4 | 350
  5 |  6 | 4 | 420
  5 |  6 | 4 | 490
  5 |  6 | 4 | 560
  5 |  6 | 4 | 630
  5 |  6 | 4 | 700
  5 |  6 | 5 | 140
  5 |  6 | 5 | 210
  5 |  6 | 5 | 280
  5 |  6 | 5 | 350
  5 |  6 | 5 | 420
  5 |  6 | 5 | 490
  5 |  6 | 5 | 560
  5 |  6 | 5 | 630
  5 |  6 | 5 | 700
  5 |  6 | 6 | 140
  5 |  6 | 6 | 210
  5 |  6 | 6 | 280
  5 |  6 | 6 | 350
  5 |  6 | 6 | 420
  5 |  6 | 6 | 490
  5 |  6 | 6 | 560
  5 |  6 | 6 | 630
  5 |  6 | 6 | 700
  5 |  6 | 7 | 140
  5 |  6 | 7 | 210
  5 |  6 | 7 | 280
  5 |  6 | 7 | 350
  5 |  6 | 7 | 420
  5 |  6 | 7 | 490
  5 |  6 | 7 | 560
  5 |  6 | 7 | 630
  5 |  6 | 7 | 700
  5 |  6 | 8 | 140
  5 |  6 | 8 | 210
  5 |  6 | 8 | 280
  5 |  6 | 8 | 350
  5 |  6 | 8 | 420
  5 |  6 | 8 | 490
  5 |  6 | 8 | 560
  5 |  6 | 8 | 630
  5 |  6 | 8 | 700
  5 |  6 | 9 | 140
  5 |  6 | 9 | 210
  5 |  6 | 9 | 280
  5 |  6 | 9 | 350
  5 |  6 | 9 | 420
  5 |  6 | 9 | 490
  5 |  6 | 9 | 560
  5 |  6 | 9 | 630
  5 |  6 | 9 | 700
  6 |  7 | 3 | 140
  6 |  7 | 3 | 210
  6 |  7 | 3 | 280
  6 |  7 | 3 | 350
  6 |  7 | 3 | 420
  6 |  7 | 3 | 490
  6 |  7 | 3 | 560
  6 |  7 | 3 | 630
  6 |  7 | 3 | 700
  6 |  7 | 4 | 140
  6 |  7 | 4 | 210
  6 |  7 | 4 | 280
  6 |  7 | 4 | 350
  6 |  7 | 4 | 420
  6 |  7 | 4 | 490
  6 |  7 | 4 | 560
  6 |  7 | 4 | 630
  6 |  7 | 4 | 700
  6 |  7 | 5 | 140
  6 |  7 | 5 | 210
  6 |  7 | 5 | 280
  6 |  7 | 5 | 350
  6 |  7 | 5 | 420
  6 |  7 | 5 | 490
  6 |  7 | 5 | 560
  6 |  7 | 5 | 630
  6 |  7 | 5 | 700
  6 |  7 | 6 | 140
  6 |  7 | 6 | 210
  6 |  7 | 6 | 280
  6 |  7 | 6 | 350
  6 |  7 | 6 | 420
  6 |  7 | 6 | 490
  6 |  7 | 6 | 560
  6 |  7 | 6 | 630
  6 |  7 | 6 | 700
  6 |  7 | 7 | 140
  6 |  7 | 7 | 210
  6 |  7 | 7 | 280
  6 |  7 | 7 | 350
  6 |  7 | 7 | 420
  6 |  7 | 7 | 490
  6 |  7 | 7 | 560
  6 |  7 | 7 | 630
  6 |  7 | 7 | 700
  6 |  7 | 8 | 140
  6 |  7 | 8 | 210
  6 |  7 | 8 | 280
  6 |  7 | 8 | 350
  6 |  7 | 8 | 420
  6 |  7 | 8 | 490
  6 |  7 | 8 | 560
  6 |  7 | 8 | 630
  6 |  7 | 8 | 700
  6 |  7 | 9 | 140
  6 |  7 | 9 | 210
  6 |  7 | 9 | 280
  6 |  7 | 9 | 350
  6 |  7 | 9 | 420
  6 |  7 | 9 | 490
  6 |  7 | 9 | 560
  6 |  7 | 9 | 630
  6 |  7 | 9 | 700
  7 |  8 | 3 | 140
  7 |  8 | 3 | 210
  7 |  8 | 3 | 280
  7 |  8 | 3 | 350
  7 |  8 | 3 | 420
  7 |  8 | 3 | 490
  7 |  8 | 3 | 560
  7 |  8 | 3 | 630
  7 |  8 | 3 | 700
  7 |  8 | 4 | 140
  7 |  8 | 4 | 210
  7 |  8 | 4 | 280
  7 |  8 | 4 | 350
  7 |  8 | 4 | 420
  7 |  8 | 4 | 490
  7 |  8 | 4 | 560
  7 |  8 | 4 | 630
  7 |  8 | 4 | 700
  7 |  8 | 5 | 140
  7 |  8 | 5 | 210
  7 |  8 | 5 | 280
  7 |  8 | 5 | 350
  7 |  8 | 5 | 420
  7 |  8 | 5 | 490
  7 |  8 | 5 | 560
  7 |  8 | 5 | 630
  7 |  8 | 5 | 700
  7 |  8 | 6 | 140
  7 |  8 | 6 | 210
  7 |  8 | 6 | 280
  7 |  8 | 6 | 350
  7 |  8 | 6 | 420
  7 |  8 | 6 | 490
  7 |  8 | 6 | 560
  7 |  8 | 6 | 630
  7 |  8 | 6 | 700
  7 |  8 | 7 | 140
  7 |  8 | 7 | 210
  7 |  8 | 7 | 280
  7 |  8 | 7 | 350
  7 |  8 | 7 | 420
  7 |  8 | 7 | 490
  7 |  8 | 7 | 560
  7 |  8 | 7 | 630
  7 |  8 | 7 | 700
  7 |  8 | 8 | 140
  7 |  8 | 8 | 210
  7 |  8 | 8 | 280
  7 |  8 | 8 | 350
  7 |  8 | 8 | 420
  7 |  8 | 8 | 490
  7 |  8 | 8 | 560
  7 |  8 | 8 | 630
  7 |  8 | 8 | 700
  7 |  8 | 9 | 140
  7 |  8 | 9 | 210
  7 |  8 | 9 | 280
  7 |  8 | 9 | 350
  7 |  8 | 9 | 420
  7 |  8 | 9 | 490
  7 |  8 | 9 | 560
  7 |  8 | 9 | 630
  7 |  8 | 9 | 700
  8 |  9 | 3 | 140
  8 |  9 | 3 | 210
  8 |  9 | 3 | 280
  8 |  9 | 3 | 350
  8 |  9 | 3 | 420
  8 |  9 | 3 | 490
  8 |  9 | 3 | 560
  8 |  9 | 3 | 630
  8 |  9 | 3 | 700
  8 |  9 | 4 | 140
  8 |  9 | 4 | 210
  8 |  9 | 4 | 280
  8 |  9 | 4 | 350
  8 |  9 | 4 | 420
  8 |  9 | 4 | 490
  8 |  9 | 4 | 560
  8 |  9 | 4 | 630
  8 |  9 | 4 | 700
  8 |  9 | 5 | 140
  8 |  9 | 5 | 210
  8 |  9 | 5 | 280
  8 |  9 | 5 | 350
  8 |  9 | 5 | 420
  8 |  9 | 5 | 490
  8 |  9 | 5 | 560
  8 |  9 | 5 | 630
  8 |  9 | 5 | 700
  8 |  9 | 6 | 140
  8 |  9 | 6 | 210
  8 |  9 | 6 | 280
  8 |  9 | 6 | 350
  8 |  9 | 6 | 420
  8 |  9 | 6 | 490
  8 |  9 | 6 | 560
  8 |  9 | 6 | 630
  8 |  9 | 6 | 700
  8 |  9 | 7 | 140
  8 |  9 | 7 | 210
  8 |  9 | 7 | 280
  8 |  9 | 7 | 350
  8 |  9 | 7 | 420
  8 |  9 | 7 | 490
  8 |  9 | 7 | 560
  8 |  9 | 7 | 630
  8 |  9 | 7 | 700
  8 |  9 | 8 | 140
  8 |  9 | 8 | 210
  8 |  9 | 8 | 280
  8 |  9 | 8 | 350
  8 |  9 | 8 | 420
  8 |  9 | 8 | 490
  8 |  9 | 8 | 560
  8 |  9 | 8 | 630
  8 |  9 | 8 | 700
  8 |  9 | 9 | 140
  8 |  9 | 9 | 210
  8 |  9 | 9 | 280
  8 |  9 | 9 | 350
  8 |  9 | 9 | 420
  8 |  9 | 9 | 490
  8 |  9 | 9 | 560
  8 |  9 | 9 | 630
  8 |  9 | 9 | 700
  9 | 10 | 3 | 140
  9 | 10 | 3 | 210
  9 | 10 | 3 | 280
  9 | 10 | 3 | 350
  9 | 10 | 3 | 420
  9 | 10 | 3 | 490
  9 | 10 | 3 | 560
  9 | 10 | 3 | 630
  9 | 10 | 3 | 700
  9 | 10 | 4 | 140
  9 | 10 | 4 | 210
  9 | 10 | 4 | 280
  9 | 10 | 4 | 350
  9 | 10 | 4 | 420
  9 | 10 | 4 | 490
  9 | 10 | 4 | 560
  9 | 10 | 4 | 630
  9 | 10 | 4 | 700
  9 | 10 | 5 | 140
  9 | 10 | 5 | 210
  9 | 10 | 5 | 280
  9 | 10 | 5 | 350
  9 | 10 | 5 | 420
  9 | 10 | 5 | 490
  9 | 10 | 5 | 560
  9 | 10 | 5 | 630
  9 | 10 | 5 | 700
  9 | 10 | 6 | 140
  9 | 10 | 6 | 210
  9 | 10 | 6 | 280
  9 | 10 | 6 | 350
  9 | 10 | 6 | 420
  9 | 10 | 6 | 490
  9 | 10 | 6 | 560
  9 | 10 | 6 | 630
  9 | 10 | 6 | 700
  9 | 10 | 7 | 140
  9 | 10 | 7 | 210
  9 | 10 | 7 | 280
  9 | 10 | 7 | 350
  9 | 10 | 7 | 420
  9 | 10 | 7 | 490
  9 | 10 | 7 | 560
  9 | 10 | 7 | 630
  9 | 10 | 7 | 700
  9 | 10 | 8 | 140
  9 | 10 | 8 | 210
  9 | 10 | 8 | 280
  9 | 10 | 8 | 350
  9 | 10 | 8 | 420
  9 | 10 | 8 | 490
  9 | 10 | 8 | 560
  9 | 10 | 8 | 630
  9 | 10 | 8 | 700
  9 | 10 | 9 | 140
  9 | 10 | 9 | 210
  9 | 10 | 9 | 280
  9 | 10 | 9 | 350
  9 | 10 | 9 | 420
  9 | 10 | 9 | 490
  9 | 10 | 9 | 560
  9 | 10 | 9 | 630
  9 | 10 | 9 | 700
 10 | 11 | 3 | 140
 10 | 11 | 3 | 210
 10 | 11 | 3 | 280
 10 | 11 | 3 | 350
 10 | 11 | 3 | 420
 10 | 11 | 3 | 490
 10 | 11 | 3 | 560
 10 | 11 | 3 | 630
 10 | 11 | 3 | 700
 10 | 11 | 4 | 140
 10 | 11 | 4 | 210
 10 | 11 | 4 | 280
 10 | 11 | 4 | 350
 10 | 11 | 4 | 420
 10 | 11 | 4 | 490
 10 | 11 | 4 | 560
 10 | 11 | 4 | 630
 10 | 11 | 4 | 700
 10 | 11 | 5 | 140
 10 | 11 | 5 | 210
 10 | 11 | 5 | 280
 10 | 11 | 5 | 350
 10 | 11 | 5 | 420
 10 | 11 | 5 | 490
 10 | 11 | 5 | 560
 10 | 11 | 5 | 630
 10 | 11 | 5 | 700
 10 | 11 | 6 | 140
 10 | 11 | 6 | 210
 10 | 11 | 6 | 280
 10 | 11 | 6 | 350
 10 | 11 | 6 | 420
 10 | 11 | 6 | 490
 10 | 11 | 6 | 560
 10 | 11 | 6 | 630
 10 | 11 | 6 | 700
 10 | 11 | 7 | 140
 10 | 11 | 7 | 210
 10 | 11 | 7 | 280
 10 | 11 | 7 | 350
 10 | 11 | 7 | 420
 10 | 11 | 7 | 490
 10 | 11 | 7 | 560
 10 | 11 | 7 | 630
 10 | 11 | 7 | 700
 10 | 11 | 8 | 140
 10 | 11 | 8 | 210
 10 | 11 | 8 | 280
 10 | 11 | 8 | 350
 10 | 11 | 8 | 420
 10 | 11 | 8 | 490
 10 | 11 | 8 | 560
 10 | 11 | 8 | 630
 10 | 11 | 8 | 700
 10 | 11 | 9 | 140
 10 | 11 | 9 | 210
 10 | 11 | 9 | 280
 10 | 11 | 9 | 350
 10 | 11 | 9 | 420
 10 | 11 | 9 | 490
 10 | 11 | 9 | 560
 10 | 11 | 9 | 630
 10 | 11 | 9 | 700
(630 rows)

--
-- Query on partitioned table with range join predicate on part key causes fallback to planner
--
select * from x_part, x_non_part where a > e;
 e | f | g | a | b | c 
---+---+---+---+---+---
 1 | 3 | 1 | 2 | 2 | 2
 1 | 3 | 1 | 2 | 5 | 5
 1 | 3 | 1 | 2 | 8 | 8
(3 rows)

select * from x_part, x_non_part where a <> e;
 e  | f  | g | a | b  | c  
----+----+---+---+----+----
  1 |  3 | 1 | 2 |  2 |  2
  1 |  3 | 1 | 0 |  3 |  3
  1 |  3 | 1 | 2 |  5 |  5
  1 |  3 | 1 | 0 |  6 |  6
  1 |  3 | 1 | 2 |  8 |  8
  1 |  3 | 1 | 0 |  9 |  9
  2 |  6 | 2 | 1 |  1 |  1
  2 |  6 | 2 | 0 |  3 |  3
  2 |  6 | 2 | 1 |  4 |  4
  2 |  6 | 2 | 0 |  6 |  6
  2 |  6 | 2 | 1 |  7 |  7
  2 |  6 | 2 | 0 |  9 |  9
  2 |  6 | 2 | 1 | 10 | 10
  8 | 24 | 2 | 1 |  1 |  1
  8 | 24 | 2 | 2 |  2 |  2
  8 | 24 | 2 | 0 |  3 |  3
  8 | 24 | 2 | 1 |  4 |  4
  8 | 24 | 2 | 2 |  5 |  5
  8 | 24 | 2 | 0 |  6 |  6
  8 | 24 | 2 | 1 |  7 |  7
  8 | 24 | 2 | 2 |  8 |  8
  8 | 24 | 2 | 0 |  9 |  9
  8 | 24 | 2 | 1 | 10 | 10
  9 | 27 | 3 | 1 |  1 |  1
  9 | 27 | 3 | 2 |  2 |  2
  9 | 27 | 3 | 0 |  3 |  3
  9 | 27 | 3 | 1 |  4 |  4
  9 | 27 | 3 | 2 |  5 |  5
  9 | 27 | 3 | 0 |  6 |  6
  9 | 27 | 3 | 1 |  7 |  7
  9 | 27 | 3 | 2 |  8 |  8
  9 | 27 | 3 | 0 |  9 |  9
  9 | 27 | 3 | 1 | 10 | 10
 10 | 30 | 4 | 1 |  1 |  1
 10 | 30 | 4 | 2 |  2 |  2
 10 | 30 | 4 | 0 |  3 |  3
 10 | 30 | 4 | 1 |  4 |  4
 10 | 30 | 4 | 2 |  5 |  5
 10 | 30 | 4 | 0 |  6 |  6
 10 | 30 | 4 | 1 |  7 |  7
 10 | 30 | 4 | 2 |  8 |  8
 10 | 30 | 4 | 0 |  9 |  9
 10 | 30 | 4 | 1 | 10 | 10
  5 | 15 | 5 | 1 |  1 |  1
  5 | 15 | 5 | 2 |  2 |  2
  5 | 15 | 5 | 0 |  3 |  3
  5 | 15 | 5 | 1 |  4 |  4
  5 | 15 | 5 | 2 |  5 |  5
  5 | 15 | 5 | 0 |  6 |  6
  5 | 15 | 5 | 1 |  7 |  7
  5 | 15 | 5 | 2 |  8 |  8
  5 | 15 | 5 | 0 |  9 |  9
  5 | 15 | 5 | 1 | 10 | 10
  6 | 18 | 0 | 1 |  1 |  1
  6 | 18 | 0 | 2 |  2 |  2
  6 | 18 | 0 | 0 |  3 |  3
  6 | 18 | 0 | 1 |  4 |  4
  6 | 18 | 0 | 2 |  5 |  5
  6 | 18 | 0 | 0 |  6 |  6
  6 | 18 | 0 | 1 |  7 |  7
  6 | 18 | 0 | 2 |  8 |  8
  6 | 18 | 0 | 0 |  9 |  9
  6 | 18 | 0 | 1 | 10 | 10
  7 | 21 | 1 | 1 |  1 |  1
  7 | 21 | 1 | 2 |  2 |  2
  7 | 21 | 1 | 0 |  3 |  3
  7 | 21 | 1 | 1 |  4 |  4
  7 | 21 | 1 | 2 |  5 |  5
  7 | 21 | 1 | 0 |  6 |  6
  7 | 21 | 1 | 1 |  7 |  7
  7 | 21 | 1 | 2 |  8 |  8
  7 | 21 | 1 | 0 |  9 |  9
  7 | 21 | 1 | 1 | 10 | 10
  3 |  9 | 3 | 1 |  1 |  1
  3 |  9 | 3 | 2 |  2 |  2
  3 |  9 | 3 | 0 |  3 |  3
  3 |  9 | 3 | 1 |  4 |  4
  3 |  9 | 3 | 2 |  5 |  5
  3 |  9 | 3 | 0 |  6 |  6
  3 |  9 | 3 | 1 |  7 |  7
  3 |  9 | 3 | 2 |  8 |  8
  3 |  9 | 3 | 0 |  9 |  9
  3 |  9 | 3 | 1 | 10 | 10
  4 | 12 | 4 | 1 |  1 |  1
  4 | 12 | 4 | 2 |  2 |  2
  4 | 12 | 4 | 0 |  3 |  3
  4 | 12 | 4 | 1 |  4 |  4
  4 | 12 | 4 | 2 |  5 |  5
  4 | 12 | 4 | 0 |  6 |  6
  4 | 12 | 4 | 1 |  7 |  7
  4 | 12 | 4 | 2 |  8 |  8
  4 | 12 | 4 | 0 |  9 |  9
  4 | 12 | 4 | 1 | 10 | 10
(93 rows)

select * from x_part, x_non_part where a <= e;
 e  | f  | g | a | b  | c  
----+----+---+---+----+----
  1 |  3 | 1 | 1 |  1 |  1
  1 |  3 | 1 | 0 |  3 |  3
  1 |  3 | 1 | 1 |  4 |  4
  1 |  3 | 1 | 0 |  6 |  6
  1 |  3 | 1 | 1 |  7 |  7
  1 |  3 | 1 | 0 |  9 |  9
  1 |  3 | 1 | 1 | 10 | 10
  2 |  6 | 2 | 1 |  1 |  1
  2 |  6 | 2 | 2 |  2 |  2
  2 |  6 | 2 | 0 |  3 |  3
  2 |  6 | 2 | 1 |  4 |  4
  2 |  6 | 2 | 2 |  5 |  5
  2 |  6 | 2 | 0 |  6 |  6
  2 |  6 | 2 | 1 |  7 |  7
  2 |  6 | 2 | 2 |  8 |  8
  2 |  6 | 2 | 0 |  9 |  9
  2 |  6 | 2 | 1 | 10 | 10
  5 | 15 | 5 | 1 |  1 |  1
  5 | 15 | 5 | 2 |  2 |  2
  5 | 15 | 5 | 0 |  3 |  3
  5 | 15 | 5 | 1 |  4 |  4
  5 | 15 | 5 | 2 |  5 |  5
  5 | 15 | 5 | 0 |  6 |  6
  5 | 15 | 5 | 1 |  7 |  7
  5 | 15 | 5 | 2 |  8 |  8
  5 | 15 | 5 | 0 |  9 |  9
  5 | 15 | 5 | 1 | 10 | 10
  6 | 18 | 0 | 1 |  1 |  1
  6 | 18 | 0 | 2 |  2 |  2
  6 | 18 | 0 | 0 |  3 |  3
  6 | 18 | 0 | 1 |  4 |  4
  6 | 18 | 0 | 2 |  5 |  5
  6 | 18 | 0 | 0 |  6 |  6
  6 | 18 | 0 | 1 |  7 |  7
  6 | 18 | 0 | 2 |  8 |  8
  6 | 18 | 0 | 0 |  9 |  9
  6 | 18 | 0 | 1 | 10 | 10
  7 | 21 | 1 | 1 |  1 |  1
  7 | 21 | 1 | 2 |  2 |  2
  7 | 21 | 1 | 0 |  3 |  3
  7 | 21 | 1 | 1 |  4 |  4
  7 | 21 | 1 | 2 |  5 |  5
  7 | 21 | 1 | 0 |  6 |  6
  7 | 21 | 1 | 1 |  7 |  7
  7 | 21 | 1 | 2 |  8 |  8
  7 | 21 | 1 | 0 |  9 |  9
  7 | 21 | 1 | 1 | 10 | 10
  3 |  9 | 3 | 1 |  1 |  1
  3 |  9 | 3 | 2 |  2 |  2
  3 |  9 | 3 | 0 |  3 |  3
  3 |  9 | 3 | 1 |  4 |  4
  3 |  9 | 3 | 2 |  5 |  5
  3 |  9 | 3 | 0 |  6 |  6
  3 |  9 | 3 | 1 |  7 |  7
  3 |  9 | 3 | 2 |  8 |  8
  3 |  9 | 3 | 0 |  9 |  9
  3 |  9 | 3 | 1 | 10 | 10
  4 | 12 | 4 | 1 |  1 |  1
  4 | 12 | 4 | 2 |  2 |  2
  4 | 12 | 4 | 0 |  3 |  3
  4 | 12 | 4 | 1 |  4 |  4
  4 | 12 | 4 | 2 |  5 |  5
  4 | 12 | 4 | 0 |  6 |  6
  4 | 12 | 4 | 1 |  7 |  7
  4 | 12 | 4 | 2 |  8 |  8
  4 | 12 | 4 | 0 |  9 |  9
  4 | 12 | 4 | 1 | 10 | 10
  8 | 24 | 2 | 1 |  1 |  1
  8 | 24 | 2 | 2 |  2 |  2
  8 | 24 | 2 | 0 |  3 |  3
  8 | 24 | 2 | 1 |  4 |  4
  8 | 24 | 2 | 2 |  5 |  5
  8 | 24 | 2 | 0 |  6 |  6
  8 | 24 | 2 | 1 |  7 |  7
  8 | 24 | 2 | 2 |  8 |  8
  8 | 24 | 2 | 0 |  9 |  9
  8 | 24 | 2 | 1 | 10 | 10
  9 | 27 | 3 | 1 |  1 |  1
  9 | 27 | 3 | 2 |  2 |  2
  9 | 27 | 3 | 0 |  3 |  3
  9 | 27 | 3 | 1 |  4 |  4
  9 | 27 | 3 | 2 |  5 |  5
  9 | 27 | 3 | 0 |  6 |  6
  9 | 27 | 3 | 1 |  7 |  7
  9 | 27 | 3 | 2 |  8 |  8
  9 | 27 | 3 | 0 |  9 |  9
  9 | 27 | 3 | 1 | 10 | 10
 10 | 30 | 4 | 1 |  1 |  1
 10 | 30 | 4 | 2 |  2 |  2
 10 | 30 | 4 | 0 |  3 |  3
 10 | 30 | 4 | 1 |  4 |  4
 10 | 30 | 4 | 2 |  5 |  5
 10 | 30 | 4 | 0 |  6 |  6
 10 | 30 | 4 | 1 |  7 |  7
 10 | 30 | 4 | 2 |  8 |  8
 10 | 30 | 4 | 0 |  9 |  9
 10 | 30 | 4 | 1 | 10 | 10
(97 rows)

select * from x_part left join x_non_part on (a > e);
 e  | f  | g | a | b | c 
----+----+---+---+---+---
  8 | 24 | 2 |   |   |  
  9 | 27 | 3 |   |   |  
 10 | 30 | 4 |   |   |  
  1 |  3 | 1 | 2 | 2 | 2
  1 |  3 | 1 | 2 | 5 | 5
  1 |  3 | 1 | 2 | 8 | 8
  2 |  6 | 2 |   |   |  
  5 | 15 | 5 |   |   |  
  6 | 18 | 0 |   |   |  
  7 | 21 | 1 |   |   |  
  3 |  9 | 3 |   |   |  
  4 | 12 | 4 |   |   |  
(12 rows)

select * from x_part right join x_non_part on (a > e);
 e | f | g | a | b  | c  
---+---+---+---+----+----
   |   |   | 1 |  1 |  1
 1 | 3 | 1 | 2 |  2 |  2
   |   |   | 0 |  3 |  3
   |   |   | 1 |  4 |  4
 1 | 3 | 1 | 2 |  5 |  5
   |   |   | 0 |  6 |  6
   |   |   | 1 |  7 |  7
 1 | 3 | 1 | 2 |  8 |  8
   |   |   | 0 |  9 |  9
   |   |   | 1 | 10 | 10
(10 rows)

select * from x_part join x_non_part on (my_equality(a,e));
 e  | f  | g | a | b  | c  
----+----+---+---+----+----
  1 |  3 | 1 | 0 |  3 |  3
  1 |  3 | 1 | 0 |  6 |  6
  1 |  3 | 1 | 0 |  9 |  9
  2 |  6 | 2 | 1 |  1 |  1
  2 |  6 | 2 | 0 |  3 |  3
  2 |  6 | 2 | 1 |  4 |  4
  2 |  6 | 2 | 0 |  6 |  6
  2 |  6 | 2 | 1 |  7 |  7
  2 |  6 | 2 | 0 |  9 |  9
  2 |  6 | 2 | 1 | 10 | 10
  5 | 15 | 5 | 1 |  1 |  1
  5 | 15 | 5 | 2 |  2 |  2
  5 | 15 | 5 | 0 |  3 |  3
  5 | 15 | 5 | 1 |  4 |  4
  5 | 15 | 5 | 2 |  5 |  5
  5 | 15 | 5 | 0 |  6 |  6
  5 | 15 | 5 | 1 |  7 |  7
  5 | 15 | 5 | 2 |  8 |  8
  5 | 15 | 5 | 0 |  9 |  9
  5 | 15 | 5 | 1 | 10 | 10
  6 | 18 | 0 | 1 |  1 |  1
  6 | 18 | 0 | 2 |  2 |  2
  6 | 18 | 0 | 0 |  3 |  3
  6 | 18 | 0 | 1 |  4 |  4
  6 | 18 | 0 | 2 |  5 |  5
  6 | 18 | 0 | 0 |  6 |  6
  6 | 18 | 0 | 1 |  7 |  7
  6 | 18 | 0 | 2 |  8 |  8
  6 | 18 | 0 | 0 |  9 |  9
  6 | 18 | 0 | 1 | 10 | 10
  7 | 21 | 1 | 1 |  1 |  1
  7 | 21 | 1 | 2 |  2 |  2
  7 | 21 | 1 | 0 |  3 |  3
  7 | 21 | 1 | 1 |  4 |  4
  7 | 21 | 1 | 2 |  5 |  5
  7 | 21 | 1 | 0 |  6 |  6
  7 | 21 | 1 | 1 |  7 |  7
  7 | 21 | 1 | 2 |  8 |  8
  7 | 21 | 1 | 0 |  9 |  9
  7 | 21 | 1 | 1 | 10 | 10
  3 |  9 | 3 | 1 |  1 |  1
  3 |  9 | 3 | 2 |  2 |  2
  3 |  9 | 3 | 0 |  3 |  3
  3 |  9 | 3 | 1 |  4 |  4
  3 |  9 | 3 | 2 |  5 |  5
  3 |  9 | 3 | 0 |  6 |  6
  3 |  9 | 3 | 1 |  7 |  7
  3 |  9 | 3 | 2 |  8 |  8
  3 |  9 | 3 | 0 |  9 |  9
  3 |  9 | 3 | 1 | 10 | 10
  4 | 12 | 4 | 1 |  1 |  1
  4 | 12 | 4 | 2 |  2 |  2
  4 | 12 | 4 | 0 |  3 |  3
  4 | 12 | 4 | 1 |  4 |  4
  4 | 12 | 4 | 2 |  5 |  5
  4 | 12 | 4 | 0 |  6 |  6
  4 | 12 | 4 | 1 |  7 |  7
  4 | 12 | 4 | 2 |  8 |  8
  4 | 12 | 4 | 0 |  9 |  9
  4 | 12 | 4 | 1 | 10 | 10
  8 | 24 | 2 | 1 |  1 |  1
  8 | 24 | 2 | 2 |  2 |  2
  8 | 24 | 2 | 0 |  3 |  3
  8 | 24 | 2 | 1 |  4 |  4
  8 | 24 | 2 | 2 |  5 |  5
  8 | 24 | 2 | 0 |  6 |  6
  8 | 24 | 2 | 1 |  7 |  7
  8 | 24 | 2 | 2 |  8 |  8
  8 | 24 | 2 | 0 |  9 |  9
  8 | 24 | 2 | 1 | 10 | 10
  9 | 27 | 3 | 1 |  1 |  1
  9 | 27 | 3 | 2 |  2 |  2
  9 | 27 | 3 | 0 |  3 |  3
  9 | 27 | 3 | 1 |  4 |  4
  9 | 27 | 3 | 2 |  5 |  5
  9 | 27 | 3 | 0 |  6 |  6
  9 | 27 | 3 | 1 |  7 |  7
  9 | 27 | 3 | 2 |  8 |  8
  9 | 27 | 3 | 0 |  9 |  9
  9 | 27 | 3 | 1 | 10 | 10
 10 | 30 | 4 | 1 |  1 |  1
 10 | 30 | 4 | 2 |  2 |  2
 10 | 30 | 4 | 0 |  3 |  3
 10 | 30 | 4 | 1 |  4 |  4
 10 | 30 | 4 | 2 |  5 |  5
 10 | 30 | 4 | 0 |  6 |  6
 10 | 30 | 4 | 1 |  7 |  7
 10 | 30 | 4 | 2 |  8 |  8
 10 | 30 | 4 | 0 |  9 |  9
 10 | 30 | 4 | 1 | 10 | 10
(90 rows)

--
-- Clean up
--
drop table if exists x;
drop table if exists y;
drop function func_x(int);
drop table if exists z;
drop table if exists bfv_joins_foo;
drop table if exists bfv_joins_bar;
drop table if exists t;
drop table if exists x_non_part;
drop table if exists x_part;
drop function my_equality(int, int);
-- Bug-fix verification for MPP-25537: PANIC when bitmap index used in ORCA select
CREATE TABLE mpp25537_facttable1 (
  col1 integer,
  wk_id smallint,
  id integer
)
with (appendonly=true, orientation=column, compresstype=zlib, compresslevel=5)
partition by range (wk_id) (
  start (1::smallint) END (20::smallint) inclusive every (1),
  default partition dflt
);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'col1' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_dflt" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_2" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_3" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_4" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_5" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_6" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_7" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_8" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_9" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_10" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_11" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_12" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_13" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_14" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_15" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_16" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_17" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_18" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_19" for table "mpp25537_facttable1"
NOTICE:  CREATE TABLE will create partition "mpp25537_facttable1_1_prt_20" for table "mpp25537_facttable1"
insert into mpp25537_facttable1 select col1, col1, col1 from (select generate_series(1,20) col1)a;
CREATE TABLE mpp25537_dimdate (
  wk_id smallint,
  col2 date
);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'wk_id' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into mpp25537_dimdate select col1, current_date - col1 from (select generate_series(1,20,2) col1)a;
CREATE TABLE mpp25537_dimtabl1 (
  id integer,
  col2 integer
);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'id' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
insert into mpp25537_dimtabl1 select col1, col1 from (select generate_series(1,20,3) col1)a;
CREATE INDEX idx_mpp25537_facttable1 on mpp25537_facttable1 (id);
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_dflt"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_2"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_3"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_4"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_5"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_6"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_7"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_8"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_9"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_10"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_11"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_12"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_13"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_14"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_15"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_16"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_17"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_18"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_19"
NOTICE:  building index for child partition "mpp25537_facttable1_1_prt_20"
set optimizer_analyze_root_partition to on;
ANALYZE mpp25537_facttable1;
ANALYZE mpp25537_dimdate;
ANALYZE mpp25537_dimtabl1;
SELECT count(*)
FROM mpp25537_facttable1 ft, mpp25537_dimdate dt, mpp25537_dimtabl1 dt1
WHERE ft.wk_id = dt.wk_id
AND ft.id = dt1.id;
 count 
-------
     4
(1 row)

--
-- This threw an error at one point:
-- ERROR: FULL JOIN is only supported with merge-joinable join conditions
--
create table fjtest_a (aid oid);
create table fjtest_b (bid oid);
create table fjtest_c (cid oid);
insert into fjtest_a values (0), (1), (2);
insert into fjtest_b values (0), (2), (3);
insert into fjtest_c values (0), (3), (4);
select * from
(
  select * from fjtest_a a, fjtest_b b where (aid = bid)
) s
full outer join fjtest_c on (s.aid = cid);
 aid | bid | cid 
-----+-----+-----
   0 |   0 |   0
   2 |   2 |    
     |     |   3
     |     |   4
(4 rows)

